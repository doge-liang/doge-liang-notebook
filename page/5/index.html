<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.22.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/5/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/5/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/5/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Hexo</title>
  







<link 
  rel="stylesheet" 
  href="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.css"
>
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Hexo</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">204</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">78</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">77</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/12/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/python/backtrader/backtrader%20%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/12/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/python/backtrader/backtrader%20%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">backtrader 基础</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-12 00:00:00" itemprop="dateCreated datePublished" datetime="2021-04-12T00:00:00+08:00">2021-04-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-02-01 01:54:09" itemprop="dateModified" datetime="2025-02-01T01:54:09+08:00">2025-02-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/" itemprop="url" rel="index"><span itemprop="name">article</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">计算机</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">程序设计语言</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/python/backtrader/" itemprop="url" rel="index"><span itemprop="name">backtrader</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="backtrader-基础">backtrader 基础</h2>
<ul>
<li><a href="#backtrader-%E5%9F%BA%E7%A1%80">backtrader 基础</a>
<ul>
<li><a href="#%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E7%A7%BB%E5%8A%A8%E5%B9%B3%E5%9D%87%E7%BA%BF%E7%AD%96%E7%95%A5">实现一个简单的移动平均线策略</a></li>
<li><a href="#%E4%B8%80%E4%B8%AA%E5%8C%85%E5%90%AB%E9%80%89%E8%82%A1%E5%92%8C%E6%8B%A9%E6%97%B6%E7%9A%84-rsi-%E7%AD%96%E7%95%A5">一个包含选股和择时的 RSI 策略</a></li>
</ul>
</li>
</ul>
<h3 id="实现一个简单的移动平均线策略">实现一个简单的移动平均线策略</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> (absolute_import, division, print_function, unicode_literals)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入 backtrader</span></span><br><span class="line"><span class="keyword">import</span> backtrader <span class="keyword">as</span> bt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入其他包</span></span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> os.path</span><br><span class="line"><span class="keyword">import</span> sys  <span class="comment"># 找出脚本名称 (in argv[0])</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建策策略</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestStrategy</span>(bt.Strategy):</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 自定义一些参数</span></span><br><span class="line">    params = (</span><br><span class="line">        (<span class="string">&#x27;maperiod&#x27;</span>, <span class="number">25</span>),</span><br><span class="line">        (<span class="string">&#x27;printlog&#x27;</span>, <span class="literal">True</span>),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">log</span>(<span class="params">self, txt, dt=<span class="literal">None</span>, doprint=<span class="literal">False</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; Logging function fot this strategy&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.p.printlog <span class="keyword">or</span> doprint:</span><br><span class="line">            dt = dt <span class="keyword">or</span> <span class="variable language_">self</span>.datas[<span class="number">0</span>].datetime.date(<span class="number">0</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;%s, %s&#x27;</span> % (dt.isoformat(), txt))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 从 self.datas 中能访问到 cerebro.adddata(data) 中的数据</span></span><br><span class="line">        <span class="comment"># self.datas[0] 即是加载的第一条价格数据，它被框架默认使用。</span></span><br><span class="line">        <span class="comment"># 引用 data [0] 数据序列中“收盘价”行</span></span><br><span class="line">        <span class="variable language_">self</span>.dataclose = <span class="variable language_">self</span>.datas[<span class="number">0</span>].close</span><br><span class="line">        <span class="variable language_">self</span>.dataopen = <span class="variable language_">self</span>.datas[<span class="number">0</span>].<span class="built_in">open</span></span><br><span class="line">        <span class="variable language_">self</span>.bar_executed = <span class="built_in">len</span>(<span class="variable language_">self</span>)</span><br><span class="line">        <span class="comment"># 跟踪挂单</span></span><br><span class="line">        <span class="variable language_">self</span>.order = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.buyprice = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.buycomm = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 添加移动平均线指标</span></span><br><span class="line">        <span class="variable language_">self</span>.sma = bt.indicators.SMA(<span class="variable language_">self</span>.datas[<span class="number">0</span>], period=<span class="variable language_">self</span>.p.maperiod)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">notify_order</span>(<span class="params">self, order</span>):</span><br><span class="line">        <span class="keyword">if</span> order.status <span class="keyword">in</span> [order.Submitted, order.Accepted]:</span><br><span class="line">            <span class="comment"># 购买订单已提交给经纪人/接受经纪人的卖单 - 啥也不干</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 检查订单是否已完成</span></span><br><span class="line">        <span class="comment"># 注意：如果现金不足，经纪人可能会拒绝订单</span></span><br><span class="line">        <span class="keyword">if</span> order.status <span class="keyword">in</span> [order.Completed]:</span><br><span class="line">            <span class="keyword">if</span> order.isbuy():</span><br><span class="line">                <span class="variable language_">self</span>.log(<span class="string">&#x27;BUY EXECUTED, %.2f, Cost: %.2f, Comm: %.2f&#x27;</span> %</span><br><span class="line">                         (order.executed.price,</span><br><span class="line">                          order.executed.value,</span><br><span class="line">                          order.executed.comm))</span><br><span class="line"></span><br><span class="line">                <span class="variable language_">self</span>.buyprice = order.executed.price</span><br><span class="line">                <span class="variable language_">self</span>.buycomm = order.executed.comm</span><br><span class="line">            <span class="keyword">elif</span> order.issell():</span><br><span class="line">                <span class="variable language_">self</span>.log(<span class="string">&#x27;SELL EXECUTED, %.2f, Cost: %.2f, Comm: %.2f&#x27;</span> %</span><br><span class="line">                         (order.executed.price,</span><br><span class="line">                          order.executed.value,</span><br><span class="line">                          order.executed.comm))</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">self</span>.bar_executed = <span class="built_in">len</span>(<span class="variable language_">self</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> order.status <span class="keyword">in</span> [order.Canceled, order.Margin, order.Rejected]:</span><br><span class="line">            <span class="variable language_">self</span>.log(<span class="string">&#x27;Order Canceled/Margin/Rejected&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 写下：没有挂单</span></span><br><span class="line">        <span class="variable language_">self</span>.order = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">notify_trade</span>(<span class="params">self, trade</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> trade.isclosed:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.log(<span class="string">&#x27;OPERATION PROFIT, GROSS %.2f, NET %.2f&#x27;</span> %</span><br><span class="line">                 (trade.pnl, trade.pnlcomm))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 当经过一个K线柱的时候 next() 方法就会被调用一次。</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">next</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># Simply log the closing price of the series from the reference</span></span><br><span class="line">        <span class="comment"># 只需从引用中打印该收盘价序列</span></span><br><span class="line">        <span class="variable language_">self</span>.log(<span class="string">&#x27;Open: %.2f, Close, %.2f&#x27;</span> % (<span class="variable language_">self</span>.dataopen[<span class="number">0</span>], <span class="variable language_">self</span>.dataclose[<span class="number">0</span>]))</span><br><span class="line">        <span class="comment"># 检查我们是否入市</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.position:</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 尚未入市...如果...的话，我们可能会买</span></span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.dataclose[<span class="number">0</span>] &gt; <span class="variable language_">self</span>.sma[<span class="number">0</span>]:</span><br><span class="line">                <span class="comment"># 当前收盘价小于之前的收盘价</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> <span class="variable language_">self</span>.dataclose[-<span class="number">1</span>] &lt; <span class="variable language_">self</span>.dataclose[-<span class="number">2</span>]:</span><br><span class="line">                    <span class="comment"># 前一个收盘价小于再前一个收盘价</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment"># 买，买，买！！！ (with all possible default parameters)</span></span><br><span class="line">                    <span class="variable language_">self</span>.log(<span class="string">&#x27;BUY CREATE, %.2f&#x27;</span> % <span class="variable language_">self</span>.dataclose[<span class="number">0</span>])</span><br><span class="line">                    <span class="variable language_">self</span>.buy()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 已经入市...我们可能会出售</span></span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.dataclose[<span class="number">0</span>] &lt; <span class="variable language_">self</span>.sma[<span class="number">0</span>]:</span><br><span class="line">                <span class="comment"># 卖，卖，卖！！！ (with all possible default parameters)</span></span><br><span class="line">                <span class="variable language_">self</span>.log(<span class="string">&#x27;SELL CREATE, %.2f&#x27;</span> % <span class="variable language_">self</span>.dataclose[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 跟踪创建的订单以避免第二订单</span></span><br><span class="line">                <span class="variable language_">self</span>.order = <span class="variable language_">self</span>.sell()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">stop</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.log(<span class="string">&#x27;(MA Period %2d) Ending Value %.2f&#x27;</span> %</span><br><span class="line">                 (<span class="variable language_">self</span>.p.maperiod, <span class="variable language_">self</span>.broker.getvalue()), doprint=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if__name__== <span class="string">&#x27;&quot;___main__&quot;:__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 实例化 Cerebro 引擎</span></span><br><span class="line">    cerebro = bt.Cerebro()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 添加一个策略</span></span><br><span class="line">    cerebro.addstrategy(TestStrategy)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 参数调优</span></span><br><span class="line">    <span class="comment"># strats = cerebro.optstrategy(</span></span><br><span class="line">    <span class="comment">#     TestStrategy,</span></span><br><span class="line">    <span class="comment">#     maperiod=range(10, 31))</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 数据在样本的子文件夹中。</span></span><br><span class="line">    <span class="comment"># 需要查找脚本的位置，因为它可以从任何地方调用</span></span><br><span class="line">    modpath = os.path.dirname(os.path.abspath(sys.argv[<span class="number">0</span>]))</span><br><span class="line">    datapath = os.path.join(modpath, <span class="string">&#x27;../../datas/orcl-1995-2014.txt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建一个数据文件</span></span><br><span class="line">    data = bt.feeds.YahooFinanceCSVData(</span><br><span class="line">        dataname=datapath,</span><br><span class="line">        <span class="comment"># 在此日期之前不要传递值</span></span><br><span class="line">        fromdate=datetime.datetime(<span class="number">2000</span>, <span class="number">1</span>, <span class="number">1</span>),</span><br><span class="line">        <span class="comment"># 在此日期之后不要传递值</span></span><br><span class="line">        <span class="comment"># 这里有一个问题，把所有的净收益 Net 即落入口袋的钱，加起来会发现和最后的余额增加不一致</span></span><br><span class="line">        <span class="comment"># sum(Net) = 12.09</span></span><br><span class="line">        <span class="comment"># Starting Portfolio - Final Portfolio = 13.13</span></span><br><span class="line">        <span class="comment"># 观察输出会发现，在 2000-12-29 创建了一笔交易，但还没有执行这笔交易，所以 Net 是少了一单的</span></span><br><span class="line">        <span class="comment"># 而且，最后输出的余额是拿了卖单挂单的那天，即 2000-12-29 那天的收盘价来加的，实际上应该是拿 2001-01-02 那天的开盘价来算的</span></span><br><span class="line">        <span class="comment"># 在两重误差下，最后的余额肯定是不对的</span></span><br><span class="line">        <span class="comment"># 拓展交易日后，加上 2001-01-2 卖出去的那单的收益，并且最终余额也调整了后，就对了</span></span><br><span class="line">        <span class="comment"># sum(Net) = 12.09 + 1.41 = 13.50</span></span><br><span class="line">        <span class="comment"># Starting Portfolio - Final Portfolio = 13.50</span></span><br><span class="line">        <span class="comment"># close(2000-12-29) - open(2001-01-02) = 25.85 - 23.46 = 2.39</span></span><br><span class="line">        todate=datetime.datetime(<span class="number">2001</span>, <span class="number">1</span>, <span class="number">3</span>),</span><br><span class="line">        <span class="comment"># todate=datetime.datetime(2000, 12, 31),</span></span><br><span class="line">        reverse=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将数据添加到 Cerebro</span></span><br><span class="line">    cerebro.adddata(data)</span><br><span class="line">    <span class="comment"># 设定我们想要的初始金额</span></span><br><span class="line">    cerebro.broker.setcash(<span class="number">1000.0</span>)</span><br><span class="line">    <span class="comment"># 增加10倍的持仓大小</span></span><br><span class="line">    cerebro.addsizer(bt.sizers.FixedSize, stake=<span class="number">10</span>)</span><br><span class="line">    <span class="comment"># 设定手续费，国内一般是是0.0003</span></span><br><span class="line">    cerebro.broker.setcommission(<span class="number">0.003</span>)</span><br><span class="line">    <span class="comment"># 打印出初始金额</span></span><br><span class="line">    <span class="comment"># print(&#x27;Starting Portfolio Value: %.2f&#x27; % cerebro.broker.getvalue())</span></span><br><span class="line">    <span class="comment"># 跑起来！！！</span></span><br><span class="line">    cerebro.run()</span><br><span class="line">    <span class="comment"># 打印出最终结果</span></span><br><span class="line">    <span class="comment"># print(&#x27;Final Portfolio Value: %.2f&#x27; % cerebro.broker.getvalue())</span></span><br><span class="line">    <span class="comment"># 绘图</span></span><br><span class="line">    <span class="comment"># cerebro.plot()</span></span><br></pre></td></tr></table></figure>
<h3 id="一个包含选股和择时的-RSI-策略">一个包含选股和择时的 RSI 策略</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> (absolute_import, division, print_function, unicode_literals)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入 backtrader</span></span><br><span class="line"><span class="keyword">import</span> backtrader <span class="keyword">as</span> bt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入其他包</span></span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> os.path</span><br><span class="line"><span class="keyword">import</span> sys  <span class="comment"># 找出脚本名称 (in argv[0])</span></span><br><span class="line"><span class="keyword">from</span> app.data_source.api.tushare_api <span class="keyword">import</span> Stock</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">import</span> matplotlib.pylab <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建策策略</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestStrategy</span>(bt.Strategy):</span><br><span class="line">    <span class="comment"># 自定义一些参数</span></span><br><span class="line">    params = (</span><br><span class="line">        (<span class="string">&#x27;maperiod&#x27;</span>, <span class="number">25</span>),</span><br><span class="line">        (<span class="string">&#x27;printlog&#x27;</span>, <span class="literal">False</span>),</span><br><span class="line">        (<span class="string">&#x27;stake&#x27;</span>, <span class="number">1000</span>),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">log</span>(<span class="params">self, txt, dt=<span class="literal">None</span>, doprint=<span class="literal">False</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; Logging function fot this strategy&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.p.printlog <span class="keyword">or</span> doprint:</span><br><span class="line">            dt = dt <span class="keyword">or</span> <span class="variable language_">self</span>.datas[<span class="number">0</span>].datetime.date(<span class="number">0</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;%s, %s&#x27;</span> % (dt.isoformat(), txt))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 从 self.data_source 中能访问到 cerebro.adddata(data) 中的数据</span></span><br><span class="line">        <span class="comment"># self.data_source[0] 即是加载的第一条价格数据，它被框架默认使用。</span></span><br><span class="line">        <span class="comment"># 引用 data [0] 数据序列中“收盘价”行</span></span><br><span class="line">        <span class="variable language_">self</span>.bar_executed = <span class="built_in">len</span>(<span class="variable language_">self</span>)</span><br><span class="line">        <span class="variable language_">self</span>.mas = &#123;stock: bt.ind.MovingAverageSimple(stock.close, period=<span class="variable language_">self</span>.p.maperiod) <span class="keyword">for</span> stock <span class="keyword">in</span> <span class="variable language_">self</span>.datas&#125;</span><br><span class="line">        <span class="comment"># 跟踪挂单</span></span><br><span class="line">        <span class="variable language_">self</span>.orderlist = []</span><br><span class="line">        <span class="variable language_">self</span>.buyprice = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.comms = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">notify_order</span>(<span class="params">self, order</span>):</span><br><span class="line">        <span class="comment"># print(order.created)</span></span><br><span class="line">        <span class="keyword">for</span> order <span class="keyword">in</span> <span class="variable language_">self</span>.orderlist:</span><br><span class="line">            <span class="keyword">if</span> order.status <span class="keyword">in</span> [order.Submitted, order.Accepted]:</span><br><span class="line">                <span class="comment"># 购买订单已提交给经纪人/经纪人接受卖单 - 啥也不干</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 检查订单是否已完成</span></span><br><span class="line">            <span class="comment"># 注意：如果现金不足，经纪人可能会拒绝订单</span></span><br><span class="line">            <span class="keyword">if</span> order.status <span class="keyword">in</span> [order.Completed]:</span><br><span class="line">                <span class="keyword">if</span> order.isbuy():</span><br><span class="line">                    <span class="variable language_">self</span>.log(<span class="string">&#x27;BUY EXECUTED, %.2f, Cost: %.2f, Comm: %.2f&#x27;</span> %</span><br><span class="line">                             (order.executed.price,</span><br><span class="line">                              order.executed.value,</span><br><span class="line">                              order.executed.comm),</span><br><span class="line">                             <span class="comment"># doprint=True</span></span><br><span class="line">                             )</span><br><span class="line"></span><br><span class="line">                    <span class="variable language_">self</span>.buyprice = order.executed.price</span><br><span class="line">                    <span class="variable language_">self</span>.comms.append(<span class="built_in">round</span>(order.executed.comm, <span class="number">2</span>))</span><br><span class="line">                <span class="keyword">elif</span> order.issell():</span><br><span class="line">                    <span class="variable language_">self</span>.log(<span class="string">&#x27;SELL EXECUTED, %.2f, Cost: %.2f, Comm: %.2f&#x27;</span> %</span><br><span class="line">                             (order.executed.price,</span><br><span class="line">                              order.executed.value,</span><br><span class="line">                              order.executed.comm),</span><br><span class="line">                             <span class="comment"># doprint=True</span></span><br><span class="line">                             )</span><br><span class="line"></span><br><span class="line">                    <span class="variable language_">self</span>.comms.append(<span class="built_in">round</span>(order.executed.comm, <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">                <span class="variable language_">self</span>.bar_executed = <span class="built_in">len</span>(<span class="variable language_">self</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">elif</span> order.status <span class="keyword">in</span> [order.Canceled, order.Margin, order.Rejected]:</span><br><span class="line">                <span class="comment"># print([order.Canceled, order.Margin, order.Rejected])</span></span><br><span class="line">                <span class="comment"># 5 7 8</span></span><br><span class="line">                <span class="variable language_">self</span>.log(<span class="string">&#x27;Order %s&#x27;</span> % <span class="built_in">str</span>(order.status))</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 订单终止</span></span><br><span class="line">            <span class="variable language_">self</span>.orderlist.remove(order)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">notify_trade</span>(<span class="params">self, trade</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> trade.isclosed:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.log(<span class="string">&#x27;OPERATION PROFIT, GROSS %.2f, NET %.2f&#x27;</span> %</span><br><span class="line">                 (trade.pnl, trade.pnlcomm))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 当经过一个K线柱的时候 next() 方法就会被调用一次。</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">next</span>(<span class="params">self</span>):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> o <span class="keyword">in</span> <span class="variable language_">self</span>.orderlist:</span><br><span class="line">            <span class="variable language_">self</span>.cancel(o)  <span class="comment"># 取消以往所有订单</span></span><br><span class="line">            <span class="variable language_">self</span>.orderlist = []  <span class="comment"># 置空</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> stock <span class="keyword">in</span> <span class="variable language_">self</span>.datas:</span><br><span class="line">            <span class="variable language_">self</span>.log(<span class="string">&#x27;%s, Open: %.2f, Close, %.2f&#x27;</span> % (stock._name, stock.<span class="built_in">open</span>[<span class="number">0</span>], stock.close[<span class="number">0</span>]))</span><br><span class="line">            <span class="comment"># 检查我们是否入市</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.getposition(stock):</span><br><span class="line">                <span class="comment"># 尚未入市...如果...的话，我们可能会买</span></span><br><span class="line">                <span class="keyword">if</span> stock.close[<span class="number">0</span>] &gt; <span class="variable language_">self</span>.mas[stock][<span class="number">0</span>]:</span><br><span class="line">                    <span class="comment"># 买，买，买！！！ (with all possible default parameters)</span></span><br><span class="line">                    <span class="variable language_">self</span>.log(<span class="string">&#x27;%s BUY CREATE, %.2f&#x27;</span> % (stock._name, stock.close[<span class="number">0</span>]))</span><br><span class="line">                    <span class="comment"># self.buy(data=data, size=self.p.stake)</span></span><br><span class="line">                    order = <span class="variable language_">self</span>.buy(data=stock, size=<span class="variable language_">self</span>.p.stake, exectype=bt.Order.Market, valid=bt.Order.DAY)</span><br><span class="line">                    <span class="variable language_">self</span>.orderlist.append(order)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 已经入市...我们可能会出售</span></span><br><span class="line">                <span class="keyword">if</span> stock.close[<span class="number">0</span>] &lt; <span class="variable language_">self</span>.mas[stock][<span class="number">0</span>]:</span><br><span class="line">                    <span class="comment"># 卖，卖，卖！！！ (with all possible default parameters)</span></span><br><span class="line">                    <span class="variable language_">self</span>.log(<span class="string">&#x27;%s SELL CREATE, %.2f&#x27;</span> % (stock._name, stock.close[<span class="number">0</span>]))</span><br><span class="line">                    order = <span class="variable language_">self</span>.sell(data=stock, size=<span class="variable language_">self</span>.p.stake, exectype=bt.Order.Market, valid=bt.Order.DAY)</span><br><span class="line">                    <span class="variable language_">self</span>.orderlist.append(order)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">stop</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;==================== Results ====================&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Starting Value - %.2f&#x27;</span> % <span class="variable language_">self</span>.broker.startingcash)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Ending   Value - %.2f&#x27;</span> % <span class="variable language_">self</span>.broker.getvalue())</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;=================================================&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;___main__&quot;</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 实例化 Cerebro 引擎</span></span><br><span class="line">    cerebro = bt.Cerebro(tradehistory=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 添加一个策略</span></span><br><span class="line">    cerebro.addstrategy(TestStrategy)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 参数调优</span></span><br><span class="line">    <span class="comment"># strats = cerebro.optstrategy(</span></span><br><span class="line">    <span class="comment">#     TestStrategy,</span></span><br><span class="line">    <span class="comment">#     maperiod=range(10, 31))</span></span><br><span class="line"></span><br><span class="line">    data_api = Stock(<span class="string">&quot;20210412&quot;</span>, <span class="number">365</span>, <span class="number">0</span>)</span><br><span class="line">    stock_pool = data_api.selectStockPoolByRSI()</span><br><span class="line">    <span class="keyword">for</span> code <span class="keyword">in</span> tqdm(stock_pool):</span><br><span class="line">        <span class="comment"># print(code)</span></span><br><span class="line">        now = data_api.now.strftime(data_api.TIME_STR)</span><br><span class="line">        OneYearBefore = (data_api.now - data_api.before).strftime(data_api.TIME_STR)</span><br><span class="line">        ohlc_data = data_api.getDailyKV(code, OneYearBefore, now)</span><br><span class="line">        ohlc_data = ohlc_data.iloc[::-<span class="number">1</span>]</span><br><span class="line">        <span class="comment"># print(ohlc_data)</span></span><br><span class="line">        stock = bt.feeds.PandasData(dataname=ohlc_data, nocase=<span class="literal">True</span>)</span><br><span class="line">        <span class="comment"># 将数据添加到 Cerebro</span></span><br><span class="line">        cerebro.adddata(stock, name=code)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 设定我们想要的初始金额</span></span><br><span class="line">    cerebro.broker.setcash(<span class="number">100000.0</span>)</span><br><span class="line">    <span class="comment"># 设定手续费，国内一般是是0.0003</span></span><br><span class="line">    cerebro.broker.setcommission(<span class="number">0.003</span>)</span><br><span class="line">    cerebro.addanalyzer(bt.analyzers.SharpeRatio, _name=<span class="string">&quot;SharpeRatio&quot;</span>)</span><br><span class="line">    cerebro.addanalyzer(bt.analyzers.AnnualReturn, _name=<span class="string">&quot;AannualReturn&quot;</span>)</span><br><span class="line">    cerebro.addanalyzer(bt.analyzers.DrawDown, _name=<span class="string">&quot;DrawDown&quot;</span>)</span><br><span class="line">    cerebro.addanalyzer(bt.analyzers.PyFolio)</span><br><span class="line">    strats = cerebro.run()</span><br><span class="line">    strat = strats[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">len</span>(strat.comms))</span><br><span class="line">    <span class="built_in">print</span>(strat.comms)</span><br><span class="line"></span><br><span class="line">    pyfolio = strat.analyzers.getbyname(<span class="string">&#x27;pyfolio&#x27;</span>)</span><br><span class="line">    returns, positions, transactions, gross_lev = pyfolio.get_pf_items()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># print(&#x27;Pyfolio:&#x27;, strat.analyzers.pyfolio.get_analysis())</span></span><br><span class="line">    sharpe_ratio = strat.analyzers.SharpeRatio.get_analysis()[<span class="string">&#x27;sharperatio&#x27;</span>]</span><br><span class="line">    max_drawdown = strat.analyzers.DrawDown.get_analysis()[<span class="string">&#x27;max&#x27;</span>][<span class="string">&#x27;drawdown&#x27;</span>]</span><br><span class="line">    annual_reaturn = strat.analyzers.AannualReturn.get_analysis()</span><br><span class="line">    transactions[<span class="string">&#x27;commision&#x27;</span>] = strat.comms</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;================== Performance ==================&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Sharpe Ratio:&#x27;</span>, sharpe_ratio)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Max DrawDown:&#x27;</span>, max_drawdown, <span class="string">&#x27;%&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> annual_reaturn.items():</span><br><span class="line">        v = <span class="built_in">round</span>(v, <span class="number">2</span>)</span><br><span class="line">        <span class="built_in">print</span>(k, <span class="string">&#x27;Aannual Return:&#x27;</span>, v)</span><br><span class="line">        annual_reaturn[k] = v</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;=================================================&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># print(&quot;================== returns ==================&quot;)</span></span><br><span class="line">    <span class="comment"># print(returns)</span></span><br><span class="line">    <span class="comment"># print(&quot;================== positions ==================&quot;)</span></span><br><span class="line">    <span class="comment"># print(positions)</span></span><br><span class="line">    <span class="comment"># print(&quot;================== transactions ==================&quot;)</span></span><br><span class="line">    <span class="comment"># print(transactions)</span></span><br><span class="line">    <span class="comment"># print(&quot;================== gross_lev ==================&quot;)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">round</span>(sharpe_ratio, <span class="number">2</span>), <span class="built_in">round</span>(max_drawdown, <span class="number">2</span>), annual_reaturn, transactions</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/11/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/%E6%AF%95%E8%AE%BE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/11/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/%E6%AF%95%E8%AE%BE/" class="post-title-link" itemprop="url">毕设</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-11 00:00:00" itemprop="dateCreated datePublished" datetime="2021-04-11T00:00:00+08:00">2021-04-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-02-01 01:54:07" itemprop="dateModified" datetime="2025-02-01T01:54:07+08:00">2025-02-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/" itemprop="url" rel="index"><span itemprop="name">article</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">计算机</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%8C%BA%E5%9D%97%E9%93%BE/" itemprop="url" rel="index"><span itemprop="name">区块链</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/" itemprop="url" rel="index"><span itemprop="name">Hyperledger Fabric</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="毕业设计">毕业设计</h2>
<p>基于区块链的智能投顾系统</p>
<h3 id="搭建网络">搭建网络</h3>
<p>要素：</p>
<ul>
<li>Org
<ul>
<li><a target="_blank" rel="noopener" href="http://provider.mynetwork.com">provider.mynetwork.com</a></li>
<li><a target="_blank" rel="noopener" href="http://subscriber.mynetwork.com">subscriber.mynetwork.com</a></li>
<li><a target="_blank" rel="noopener" href="http://regulator.mynetwork.com">regulator.mynetwork.com</a></li>
<li><a target="_blank" rel="noopener" href="http://orderer.mynetwork.com">orderer.mynetwork.com</a></li>
</ul>
</li>
<li>Peers
<ul>
<li><a target="_blank" rel="noopener" href="http://peer0.provider.mynetwork.com">peer0.provider.mynetwork.com</a>
<ul>
<li>PEER0_PROVIDER_ADDRESS=localhost:6001</li>
<li>CORE_PEER_CHAINCODEADDRESS=<a target="_blank" rel="noopener" href="http://peer0.provider.mynetwork.com:6002">peer0.provider.mynetwork.com:6002</a></li>
<li>couchdb0
<ul>
<li>10050:5984</li>
</ul>
</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="http://peer0.subscriber.mynetwork.com">peer0.subscriber.mynetwork.com</a>
<ul>
<li>PEER0_SUBSCRIBER_ADDRESS=localhost:6003</li>
<li>CORE_PEER_CHAINCODEADDRESS=<a target="_blank" rel="noopener" href="http://peer0.subscriber.mynetwork.com:6004">peer0.subscriber.mynetwork.com:6004</a></li>
<li>couchdb1
<ul>
<li>10051:5984</li>
</ul>
</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="http://peer0.regulator.mynetwork.com">peer0.regulator.mynetwork.com</a>
<ul>
<li>PEER0_REGULATOR_ADDRESS=localhost:6005</li>
<li>CORE_PEER_CHAINCODEADDRESS=<a target="_blank" rel="noopener" href="http://peer0.regulator.mynetwork.com:6006">peer0.regulator.mynetwork.com:6006</a></li>
<li>couchdb3
<ul>
<li>10052:5984</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Orderer
<ul>
<li>ORDERER_ADDRESS=localhost:6007</li>
</ul>
</li>
<li>CA
<ul>
<li>ca_provider
<ul>
<li>FABRIC_CA_SERVER_PORT=9201</li>
</ul>
</li>
<li>ca_subscriber
<ul>
<li>FABRIC_CA_SERVER_PORT=9202</li>
</ul>
</li>
<li>ca_regulator
<ul>
<li>FABRIC_CA_SERVER_PORT=9203</li>
</ul>
</li>
<li>ca_orderer
<ul>
<li>FABRIC_CA_SERVER_PORT=9204</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>调用流程：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">. ./rebuild.sh</span><br><span class="line">. ./scripts/deploy_chaincode.sh deploy v1.0 mycc</span><br><span class="line">. ./scripts/init_chaincode.sh mycc InitLedger Peer1.Subscriber</span><br><span class="line">. ./scripts/test_chaincode.sh mycc Peer1.Subscriber query GetAllAssets <span class="string">&quot;&quot;</span></span><br><span class="line">. ./scripts/test_chaincode.sh mycc Peer1.Subscriber invoke DeleteAsset asset6</span><br><span class="line">. ./scripts/test_chaincode.sh mycc Peer1.Subscriber invoke CreateAsset <span class="string">&#x27;&#123;\&quot;ID\&quot;:\&quot;asset7\&quot;,\&quot;color\&quot;:\&quot;white\&quot;,\&quot;size\&quot;:15,\&quot;Owner\&quot;:\&quot;Michel\&quot;,\&quot;appraisedValue\&quot;:800&#125;&#x27;</span></span><br><span class="line">. ./scripts/test_chaincode.sh mycc Peer1.Subscriber invoke CreateAsset <span class="string">&#x27;&#123;\&quot;ID\&quot;:\&quot;asset6\&quot;,\&quot;color\&quot;:\&quot;white\&quot;,\&quot;size\&quot;:15,\&quot;owner\&quot;:&#123;\&quot;name\&quot;:\&quot;Michel\&quot;,\&quot;age\&quot;:999&#125;,\&quot;appraisedValue\&quot;:800&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>com.graduationProject.mynetwork.EnrollAdmin<br>
com.graduationProject.entity.Admin</p>
<p>. ./scripts/deploy_chaincode.sh deploy v1.0 strategy</p>
<p>{<br>
“ID”: “asset7”,<br>
“color”: “white”,<br>
“size”: 15,<br>
“Owner”: “Michel”,<br>
“appraisedValue”: 800<br>
}</p>
<p>通过命令行传参需要压缩 json 对象，并转义引号才能正确传入。</p>
<p>{&quot;ID&quot;:&quot;asset6&quot;,&quot;Color&quot;:&quot;white&quot;,&quot;Size&quot;:15,&quot;Owner&quot;:{&quot;Name&quot;:&quot;Michel&quot;,&quot;Age&quot;:999},&quot;AppraisedValue&quot;:800}</p>
<p>通过 mycc 的 CreateAsset 函数，证明了结构体也可以正确传值，<br>
{&quot;ID&quot;:&quot;asset7&quot;,&quot;color&quot;:&quot;white&quot;,&quot;size&quot;:15,&quot;Owner&quot;:&quot;Michel&quot;,&quot;appraisedValue&quot;:800}</p>
<p>peer chaincode query -o localhost:7050 --ordererTLSHostnameOverride <a target="_blank" rel="noopener" href="http://orderer.example.com">orderer.example.com</a> --tls --cafile ${PWD}/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n private -c ‘{“function”:“ReadAssetPrivateDetails”,“Args”:[“Org2MSPPrivateCollection”,“asset1”]}’</p>
<p>peer chaincode query -C mychannel -n private -c ‘{“function”:“ReadAssetPrivateDetails”,“Args”:[“Org1MSPPrivateCollection”,“asset1”]}’</p>
<p>私有数据请求</p>
<p>peer chaincode query -o localhost:7050 --ordererTLSHostnameOverride <a target="_blank" rel="noopener" href="http://orderer.example.com">orderer.example.com</a> --tls --cafile ${PWD}/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n private -c ‘{“function”:“ReadAssetPrivateDetails”,“Args”:[“Org2MSPPrivateCollection”,“asset1”]}’</p>
<p>修改私有数据</p>
<p>peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride <a target="_blank" rel="noopener" href="http://orderer.example.com">orderer.example.com</a> --tls --cafile {PWD}/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n private -c '{"function":"AgreeToTransfer","Args":[]}' --transient "{\"asset_value\":\"ASSET_VALUE&quot;}&quot;</p>
<p>私有数据的传输要走 Transaction ，在 CLI 中要设置 --transient 通道，在 SDK 中可以通过 gateway 取得 Transient 对象进行传输，链码中通过 GetTransient() 取得 transientMap ，通过 transientMap 可以得到传进来的值；（其实就是私有数据，私有数据要保证隐私性所以不会通过通道直接传输；</p>
<p>我们的私有数据，<br>
用户 A<br>
用户 B<br>
提供者 C</p>
<p>策略 A 是公开策略，它可以放在 ABC 公共数据集中，<br>
策略 B 是私有策略，它放在收益放在 C 的公共数据集中，交易记录、持仓记录放在 C 的私有数据集中，订阅数据放在公共数据集中，不同用户对数据的访问控制通过 GetCreator() 来控制，这是基于链码的访问控制；</p>
<p>strategy_provide.go<br>
SaveStrategy()<br>
SaveStrategyPrivate()<br>
UpdateStrategy()<br>
SetStrategyPrivate()<br>
SetStrategyPublic()<br>
DeleteTrades()</p>
<p>strategy_queries.go<br>
GetAllStrategies()<br>
StrategyExists()<br>
ReadStrategy()<br>
ReadTrades()<br>
ReadPositions()</p>
<h3 id="资产数据结构">资产数据结构</h3>
<p>资产(Assets)也是世界状态，存储在每个节点的状态 DB 中，是可以增删改查的存在；<br>
交易(Transaction)是链上的区块数据，资产的状态发生变化时，就会产生交易数据，是只能增加的数据，不可篡改；</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SmartContract definition</span></span><br><span class="line"><span class="keyword">type</span> SmartContract <span class="keyword">struct</span> &#123;</span><br><span class="line">	contractapi.Contract</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Trade <span class="keyword">struct</span> &#123;</span><br><span class="line">	ID         <span class="type">string</span>    <span class="string">`json:&quot;ID&quot;`</span>         <span class="comment">// 交易id</span></span><br><span class="line">	StockID    <span class="type">string</span>    <span class="string">`json:&quot;stockID&quot;`</span>    <span class="comment">// 交易股票</span></span><br><span class="line">	Amount     <span class="type">float64</span>   <span class="string">`json:&quot;amount&quot;`</span>     <span class="comment">// 交易份额（买卖用正负来表示）</span></span><br><span class="line">	Commission <span class="type">float64</span>   <span class="string">`json:&quot;commission&quot;`</span> <span class="comment">// 交易佣金</span></span><br><span class="line">	DateTime   time.Time <span class="string">`json:&quot;dateTime&quot;`</span>   <span class="comment">// 交易时间</span></span><br><span class="line">	Price      <span class="type">float64</span>   <span class="string">`json:&quot;price&quot;`</span>      <span class="comment">// 成交价</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Position <span class="keyword">struct</span> &#123;</span><br><span class="line">	ID     <span class="type">string</span>  <span class="string">`json:&quot;ID&quot;`</span>     <span class="comment">// 股票代码</span></span><br><span class="line">	Price  <span class="type">float64</span> <span class="string">`json:&quot;Price&quot;`</span>  <span class="comment">// 现有股价</span></span><br><span class="line">	Amount <span class="type">float64</span> <span class="string">`json:&quot;amount&quot;`</span> <span class="comment">// 仓位</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Strategy <span class="keyword">struct</span> &#123;</span><br><span class="line">	ID           <span class="type">string</span>     <span class="string">`json:&quot;ID&quot;`</span>           <span class="comment">// 策略 ID</span></span><br><span class="line">	Name         <span class="type">string</span>     <span class="string">`json:&quot;name&quot;`</span>         <span class="comment">// 策略名</span></span><br><span class="line">	Provider     <span class="type">string</span>     <span class="string">`json:&quot;provider&quot;`</span>     <span class="comment">// 发布者</span></span><br><span class="line">	MaxDrawdown  <span class="type">float64</span>    <span class="string">`json:&quot;maxDrawdown&quot;`</span>  <span class="comment">// 最大回撤</span></span><br><span class="line">	AnnualReturn <span class="type">float64</span>    <span class="string">`json:&quot;annualReturn&quot;`</span> <span class="comment">// 年化收益率</span></span><br><span class="line">	Trades       []Trade    <span class="string">`json:&quot;trades&quot;`</span>       <span class="comment">// 交易记录</span></span><br><span class="line">	Positions    []Position <span class="string">`json:&quot;positions&quot;`</span>    <span class="comment">// 持仓</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="链码-chaincode">链码 chaincode</h3>
<p>链码安装脚本：deploy_chaincode.sh [-u]</p>
<p>为哪个组织安装链码,设置哪个组织环境变量：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">setupSubscriberPeerENV0</span><br><span class="line">setupSubscriberPeerENV1</span><br><span class="line">setupProviderPeerENV</span><br><span class="line">setupRegulatorPeerENV</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 链码名</span></span><br><span class="line"><span class="built_in">export</span> CC_NAME=strategy</span><br><span class="line"><span class="comment"># 链码版本</span></span><br><span class="line"><span class="built_in">export</span> CC_VERSION=v1.0</span><br><span class="line"><span class="comment"># 链码序列号</span></span><br><span class="line"><span class="built_in">export</span> CC_SEQ=1</span><br><span class="line"><span class="comment"># 链码策略</span></span><br><span class="line"><span class="comment"># export CC_POLICY=&quot;OR(&#x27;ProviderMSP.peer&#x27;, &#x27;SubscriberMSP.peer&#x27;, &#x27;RegulatorMSP.peer&#x27;)&quot;</span></span><br><span class="line"><span class="built_in">export</span> CC_POLICY=<span class="string">&quot;OR(&#x27;ProviderMSP.peer&#x27;)&quot;</span></span><br><span class="line"><span class="comment"># 可以不设置,自己用来过滤脚本用的</span></span><br><span class="line"><span class="built_in">export</span> CC_LIFECYCLE=<span class="string">&quot;DEPLOY&quot;</span></span><br><span class="line"><span class="built_in">export</span> CC_LABEL=<span class="variable">$&#123;CC_NAME&#125;</span>_<span class="variable">$&#123;CC_VERSION&#125;</span></span><br><span class="line"><span class="comment"># 设置 Go 链码的变量</span></span><br><span class="line">setGoCC</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查是否配置了私有数据集合配置文件</span></span><br><span class="line"><span class="keyword">if</span> [[ -f <span class="variable">$&#123;CC_PATH&#125;</span>/../../collections_config.json ]]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">export</span> PRIVATE_COLLECTION_DEF=<span class="string">&quot;--collections-config <span class="variable">$&#123;CC_PATH&#125;</span>/../../collections_config.json&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">pushd</span> <span class="variable">$CC_PATH</span></span><br><span class="line">./build.sh</span><br><span class="line"><span class="built_in">popd</span></span><br></pre></td></tr></table></figure>
<h4 id="链码打包">链码打包</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> -x</span><br><span class="line"><span class="keyword">if</span> [[ ! -f tmp/<span class="variable">$&#123;CC_LABEL&#125;</span>.tar.gz ]]; <span class="keyword">then</span></span><br><span class="line">    peer lifecycle chaincode package tmp/<span class="variable">$&#123;CC_LABEL&#125;</span>.tar.gz --path <span class="variable">$&#123;CC_PATH&#125;</span> --lang <span class="variable">$CC_LANG</span> --label <span class="variable">$&#123;CC_LABEL&#125;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">set</span> +x</span><br></pre></td></tr></table></figure>
<h4 id="安装链码">安装链码</h4>
<p>依次切换环境变量执行下面的代码:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">setupSubscriberPeerENV0</span><br><span class="line">setupSubscriberPeerENV1</span><br><span class="line">setupProviderPeerENV</span><br><span class="line">setupRegulatorPeerENV</span><br><span class="line"></span><br><span class="line">peer lifecycle chaincode install tmp/<span class="variable">$&#123;CC_LABEL&#125;</span>.tar.gz</span><br></pre></td></tr></table></figure>
<p>检查链码安装情况:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PACKAGE_ID=$(peer lifecycle chaincode queryinstalled --output json | jq -r <span class="string">&#x27;.installed_chaincodes[] | select(.label == env.CC_LABEL) | .package_id&#x27;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;PACKAGE_ID(&#x27;<span class="variable">$ORGANIZATION_NAME</span>&#x27;):&quot;</span> <span class="variable">$&#123;PACKAGE_ID&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="为自己的组织批准链码">为自己的组织批准链码</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$CORE_PEER_TLS_ENABLED</span>&quot;</span> == <span class="string">&quot;true&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">    peer lifecycle chaincode approveformyorg \</span><br><span class="line">        -o <span class="variable">$&#123;ORDERER_ADDRESS&#125;</span> \</span><br><span class="line">        --ordererTLSHostnameOverride orderer.mynetwork.com \</span><br><span class="line">        --tls <span class="variable">$CORE_PEER_TLS_ENABLED</span> \</span><br><span class="line">        --cafile <span class="variable">$ORDERER_CA</span> \</span><br><span class="line">        --channelID <span class="variable">$CHANNEL_NAME</span> \</span><br><span class="line">        --name <span class="variable">$&#123;CC_NAME&#125;</span> \</span><br><span class="line">        --version <span class="variable">$&#123;CC_VERSION&#125;</span> \</span><br><span class="line">        --init-required \</span><br><span class="line">        --package-id <span class="variable">$&#123;PACKAGE_ID&#125;</span> \</span><br><span class="line">        --sequence <span class="variable">$CC_SEQ</span> \</span><br><span class="line">        --waitForEvent \</span><br><span class="line">        --signature-policy <span class="string">&quot;<span class="variable">$CC_POLICY</span>&quot;</span> \</span><br><span class="line">        <span class="variable">$PRIVATE_COLLECTION_DEF</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    peer lifecycle chaincode approveformyorg \</span><br><span class="line">        -o <span class="variable">$&#123;ORDERER_ADDRESS&#125;</span> \</span><br><span class="line">        --channelID <span class="variable">$CHANNEL_NAME</span> \</span><br><span class="line">        --name <span class="variable">$&#123;CC_NAME&#125;</span> \</span><br><span class="line">        --version <span class="variable">$&#123;CC_VERSION&#125;</span> \</span><br><span class="line">        --init-required \</span><br><span class="line">        --package-id <span class="variable">$&#123;PACKAGE_ID&#125;</span> \</span><br><span class="line">        --sequence <span class="variable">$CC_SEQ</span> \</span><br><span class="line">        --waitForEvent \</span><br><span class="line">        --signature-policy <span class="string">&quot;<span class="variable">$CC_POLICY</span>&quot;</span> \</span><br><span class="line">        <span class="variable">$PRIVATE_COLLECTION_DEF</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<h4 id="提交链码定义">提交链码定义</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$CORE_PEER_TLS_ENABLED</span>&quot;</span> == <span class="string">&quot;true&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">    peer lifecycle chaincode commit \</span><br><span class="line">        -o <span class="variable">$&#123;ORDERER_ADDRESS&#125;</span> \</span><br><span class="line">        --ordererTLSHostnameOverride orderer.mynetwork.com \</span><br><span class="line">        --tls <span class="variable">$CORE_PEER_TLS_ENABLED</span> \</span><br><span class="line">        --cafile <span class="variable">$ORDERER_CA</span> \</span><br><span class="line">        --peerAddresses <span class="variable">$PEER0_PROVIDER_ADDRESS</span> \</span><br><span class="line">        --tlsRootCertFiles <span class="variable">$PEER0_PROVIDER_TLS_ROOTCERT_FILE</span> \</span><br><span class="line">        --peerAddresses <span class="variable">$PEER0_SUBSCRIBER_ADDRESS</span> \</span><br><span class="line">        --tlsRootCertFiles <span class="variable">$PEER0_SUBSCRIBER_TLS_ROOTCERT_FILE</span> \</span><br><span class="line">        -C <span class="variable">$CHANNEL_NAME</span> \</span><br><span class="line">        --name <span class="variable">$&#123;CC_NAME&#125;</span> \</span><br><span class="line">        --version <span class="variable">$&#123;CC_VERSION&#125;</span> \</span><br><span class="line">        --sequence <span class="variable">$CC_SEQ</span> \</span><br><span class="line">        --init-required \</span><br><span class="line">        --signature-policy <span class="string">&quot;<span class="variable">$CC_POLICY</span>&quot;</span> \</span><br><span class="line">        <span class="variable">$PRIVATE_COLLECTION_DEF</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    peer lifecycle chaincode commit -o <span class="variable">$&#123;ORDERER_ADDRESS&#125;</span> \</span><br><span class="line">        --peerAddresses <span class="variable">$PEER0_PROVIDER_ADDRESS</span> \</span><br><span class="line">        --peerAddresses <span class="variable">$PEER0_SUBSCRIBER_ADDRESS</span> \</span><br><span class="line">        -C <span class="variable">$CHANNEL_NAME</span> \</span><br><span class="line">        --name <span class="variable">$&#123;CC_NAME&#125;</span> \</span><br><span class="line">        --version <span class="variable">$&#123;CC_VERSION&#125;</span> \</span><br><span class="line">        --sequence <span class="variable">$CC_SEQ</span> \</span><br><span class="line">        --init-required \</span><br><span class="line">        --signature-policy <span class="string">&quot;<span class="variable">$CC_POLICY</span>&quot;</span> \</span><br><span class="line">        <span class="variable">$PRIVATE_COLLECTION_DEF</span></span><br></pre></td></tr></table></figure>
<p>检查链码状态</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode querycommitted --channelID <span class="variable">$CHANNEL_NAME</span> --name <span class="variable">$&#123;CC_NAME&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="调用前实例化链码">调用前实例化链码</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$CORE_PEER_TLS_ENABLED</span>&quot;</span> == <span class="string">&quot;true&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">    peer chaincode invoke \</span><br><span class="line">    -o <span class="variable">$&#123;ORDERER_ADDRESS&#125;</span> \</span><br><span class="line">    --ordererTLSHostnameOverride orderer.mynetwork.com \</span><br><span class="line">    --tls <span class="variable">$CORE_PEER_TLS_ENABLED</span> \</span><br><span class="line">    --cafile <span class="variable">$ORDERER_CA</span> \</span><br><span class="line">    -C <span class="variable">$CHANNEL_NAME</span> \</span><br><span class="line">    -n <span class="variable">$&#123;CC_NAME&#125;</span>  \</span><br><span class="line">    --isInit -c <span class="string">&#x27;&#123;&quot;Function&quot;:&quot;&#x27;</span>Init<span class="string">&#x27;&quot;,&quot;Args&quot;:[]&#125;&#x27;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    peer chaincode invoke \</span><br><span class="line">    -o <span class="variable">$&#123;ORDERER_ADDRESS&#125;</span> \</span><br><span class="line">    -C <span class="variable">$CHANNEL_NAME</span> \</span><br><span class="line">    -n <span class="variable">$&#123;CC_NAME&#125;</span>  \</span><br><span class="line">    --isInit -c <span class="string">&#x27;&#123;&quot;Function&quot;:&quot;&#x27;</span><span class="variable">$INIT_FUNC</span><span class="string">&#x27;&quot;,&quot;Args&quot;:[]&#125;&#x27;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<h4 id="query-调用链码">query 调用链码</h4>
<p>不需要修改链上数据的用这个请求:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -C <span class="variable">$CHANNEL_NAME</span> -n <span class="variable">$CC_NAME</span> -c <span class="string">&#x27;&#123;&quot;Function&quot;:&quot;GetAllStrategies&quot;, &quot;Args&quot;:[]&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="invoke-调用链码">invoke 调用链码</h4>
<p>需要修改数据的用这个:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$CORE_PEER_TLS_ENABLED</span>&quot;</span> == <span class="string">&quot;true&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">    peer chaincode invoke \</span><br><span class="line">    -o <span class="variable">$&#123;ORDERER_ADDRESS&#125;</span> \</span><br><span class="line">    --ordererTLSHostnameOverride orderer.mynetwork.com \</span><br><span class="line">    --tls <span class="variable">$CORE_PEER_TLS_ENABLED</span> \</span><br><span class="line">    --cafile <span class="variable">$ORDERER_CA</span> \</span><br><span class="line">    -C <span class="variable">$CHANNEL_NAME</span> \</span><br><span class="line">    -n <span class="variable">$&#123;CC_NAME&#125;</span>  \</span><br><span class="line">    -c <span class="string">&#x27;&#123;&quot;Function&quot;:&quot;&#x27;</span><span class="variable">$INVOKE_FUNC</span><span class="string">&#x27;&quot;,&quot;Args&quot;:[&quot;&#x27;</span><span class="variable">$INVOKE_FUNC_ARGS</span><span class="string">&#x27;&quot;]&#125;&#x27;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    peer chaincode invoke \</span><br><span class="line">    -o <span class="variable">$&#123;ORDERER_ADDRESS&#125;</span> \</span><br><span class="line">    -C <span class="variable">$CHANNEL_NAME</span> \</span><br><span class="line">    -n <span class="variable">$&#123;CC_NAME&#125;</span>  \</span><br><span class="line">    -c <span class="string">&#x27;&#123;&quot;Function&quot;:&quot;&#x27;</span><span class="variable">$INVOKE_FUNC</span><span class="string">&#x27;&quot;,&quot;Args&quot;:[&quot;&#x27;</span><span class="variable">$INVOKE_FUNC_ARGS</span><span class="string">&#x27;&quot;]&#125;&#x27;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<h3 id="应用开发">应用开发</h3>
<p>用户登录注册流程：</p>
<ol>
<li>
<p>环境准备：connection.json 配置文件，其中包括了组织的 ip 地址， CA 的 ip 地址，连接到 CA 的证书，和连接到 Peer 的证书。这些文件都在服务端中配置的；</p>
</li>
<li>
<p>一开始用户不存在，需要通过管理员账号来注册，管理员账号不需要客户进行操作，代理注册的逻辑可以写在服务端的中，客户端提供用户名和密码即可；而管理员的账户是创建网络时就指定了的，只需要拿着前面的文件，用 SDK 的 enroll 来进行登录操作即可；</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这里的 adminIdentity 是通过服务端的 Wallet 对象得到的</span></span><br><span class="line"><span class="comment">// Wallet 对象可以看作是服务端本地某个目录，这个目录中存着身份标识文件</span></span><br><span class="line"><span class="comment">// （其实可以是别的什么存储系统，只是我用了 newFileSystemWallet() 而已）</span></span><br><span class="line"><span class="type">Enrollment</span> <span class="variable">adminKeys</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Enrollment</span>() &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> PrivateKey <span class="title function_">getKey</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> adminIdentity.getPrivateKey();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getCert</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> Identities.toPemString(adminIdentity.getCertificate());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">User</span> <span class="variable">admin</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserContext</span>(adminName, orgMSP, adminKeys);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发起注册请求</span></span><br><span class="line"><span class="type">RegistrationRequest</span> <span class="variable">registrationRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RegistrationRequest</span>(userName);</span><br><span class="line">registrationRequest.setSecret(userSecret);</span><br><span class="line">caClient.register(registrationRequest, admin);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>前面注册完之后，通过 enroll 进行登录操作，产生了 enrollment 对象，这个对象和组织的 MSPID 结合生成 Identity 对象，存进 Wallet 里面；</p>
</li>
</ol>
<h3 id="量化策略回测">量化策略回测</h3>
<p>这部分打算用 python 的 flask 框架搭建一个简单的 web 服务器，暴露 restful 风格的接口供 Springboot 进行调用，以获取回测的结果；</p>
<p><img src="../../../../assets/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/%E6%AF%95%E8%AE%BE/820cd33c7d23edc3b568c9f5bcbc55f2f75436f6c79c9cba9c84593d954c6c1e.png" alt="picture 1"></p>
<h3 id="Web-设计">Web 设计</h3>
<p>前端用 vue 进行开发<br>
后端用 springboot 进行开发</p>
<p>测试项目：</p>
<ol>
<li>有遇到相同的 key ， GetState() 会产生什么行为？</li>
<li></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/11/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/Golang/Golang%20%E4%B8%80%E4%BA%9B%E7%89%B9%E6%AE%8A%E7%9A%84%E5%AF%BC%E5%8C%85%E6%96%B9%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/11/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/Golang/Golang%20%E4%B8%80%E4%BA%9B%E7%89%B9%E6%AE%8A%E7%9A%84%E5%AF%BC%E5%8C%85%E6%96%B9%E6%B3%95/" class="post-title-link" itemprop="url">Golang 一些特殊的导包方法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-11 00:00:00" itemprop="dateCreated datePublished" datetime="2021-04-11T00:00:00+08:00">2021-04-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-02-01 01:54:09" itemprop="dateModified" datetime="2025-02-01T01:54:09+08:00">2025-02-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/" itemprop="url" rel="index"><span itemprop="name">article</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">计算机</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">程序设计语言</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/Golang/" itemprop="url" rel="index"><span itemprop="name">Golang</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Golang-一些特殊的导包方法">Golang 一些特殊的导包方法</h2>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	. <span class="string">&quot;fmt&quot;</span></span><br><span class="line">	f <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// call the &#x27;init&#x27; function in fmt, unnecessary to use the lib</span></span><br><span class="line">	_ <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	Println(<span class="string">&quot;call fmt without prefix&quot;</span>)</span><br><span class="line">	f.Println(<span class="string">&quot;call fmt with alias&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>另外还能用相对路径和绝对路径来导包。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>   <span class="string">&quot;./model&quot;</span>  <span class="comment">//当前文件同一目录的model目录，但是不建议这种方式import</span></span><br><span class="line"><span class="keyword">import</span>   <span class="string">&quot;shorturl/model&quot;</span>  <span class="comment">//加载GOPATH/src/shorturl/model模块</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/10/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/Hyperledger%20Fabric%20%E9%93%BE%E7%A0%81%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/10/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/Hyperledger%20Fabric%20%E9%93%BE%E7%A0%81%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/" class="post-title-link" itemprop="url">Hyperledger Fabric 链码生命周期</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-10 00:00:00" itemprop="dateCreated datePublished" datetime="2021-04-10T00:00:00+08:00">2021-04-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-02-01 01:54:07" itemprop="dateModified" datetime="2025-02-01T01:54:07+08:00">2025-02-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/" itemprop="url" rel="index"><span itemprop="name">article</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">计算机</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%8C%BA%E5%9D%97%E9%93%BE/" itemprop="url" rel="index"><span itemprop="name">区块链</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/" itemprop="url" rel="index"><span itemprop="name">Hyperledger Fabric</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Hyperledger-Fabric-链码生命周期">Hyperledger Fabric 链码生命周期</h2>
<p>链码是实现了规定接口的程序，通常用 Go, Node.js, Java 编写。链码运行在安全的 Docker 容器内，与背书节点进程相隔离。链码通过客户端提交的交易初始化和管理账本状态。</p>
<p>链码通常处理网络成员同意的业务逻辑，因此可以将其视为“智能合约”。通过某个链码创建的账本只能通过这个账本进行更新，不能被其他的链码直接访问。然而，在同一个网络中，在获得正确的许可后，别的链码可以通过调用该链码访问该账本的状态。</p>
<p>在这个主题中，我们将通过区块链网络维护人员的视角，而不是应用程序开发人员的视角来探索链码。</p>
<h3 id="部署链码">部署链码</h3>
<p>Fabric 链码的生命周期指的是，多个组织在通道上使用该链码之前，对如何处理链码达成一致意见的过程。一个网络运维人员需要使用 Fabric lifecycle 来完成以下的任务：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://hyperledger-fabric.readthedocs.io/en/release-2.3/chaincode_lifecycle.html#install-and-define-a-chaincode">安装并定义一个链码</a></li>
<li><a target="_blank" rel="noopener" href="https://hyperledger-fabric.readthedocs.io/en/release-2.3/chaincode_lifecycle.html#upgrade-a-chaincode">升级一个链码</a></li>
<li><a target="_blank" rel="noopener" href="https://hyperledger-fabric.readthedocs.io/en/release-2.3/chaincode_lifecycle.html#deployment-scenarios">部署方案</a></li>
<li><a target="_blank" rel="noopener" href="https://hyperledger-fabric.readthedocs.io/en/release-2.3/chaincode_lifecycle.html#migrate-to-the-new-fabric-lifecycle">迁移到新的链码生命周期</a></li>
</ul>
<p>你可以通过新建一个通道，并将通道配置中的 <code>Capabilities</code> 设置为 <code>V2_0</code> 来使用 <code>fabric chaincode lifecycle</code> 命令。如果 <code>V2_0</code> 的 <code>Capabilities</code> 被打开，那么旧的链码生命周期将无法使用。然而，你仍然可以用以前的链码生命周期模型来调用已经安装了的链码。<a target="_blank" rel="noopener" href="https://hyperledger-fabric.readthedocs.io/en/release-2.3/enable_cc_lifecycle.html">链码生命周期迁移教程</a>。</p>
<h3 id="安装并定义一个链码">安装并定义一个链码</h3>
<p>链码的安装需要组织同意定义链码的参数，比如名字、版本号和链码的背书策略等。通道上的成员需要按照以下的步骤来同意一个链码（不需要每个组织都完成每一步）：</p>
<ol>
<li>打包链码(package)：这一步可以由一个组织完成，也可以每个组织自己完成；</li>
<li>安装链码到 peers 上(install)：每个要用这个链码来进行交易背书或者查询账本的组织都要完成这一步；</li>
<li>批准组织的链码定义(approve)：每个要用这个链码来进行交易背书或者查询账本的组织都要完成这一步。在链码启动之前，链码的定义需要足够组织的批准来满足链码的生命周期背书策略（ majority 或 default ）；</li>
<li>提交链码的定义到通道上(commit)：一旦通道上所需数量的组织都批准了，提交交易需要由一个组织提交。这个提交组织首先要从已经批准的组织中，收集足够的 Peer 节点背书，然后提交交易，从而提交链码的定义。</li>
</ol>
<p>本主题详细介绍了 Fabric 链码生命周期的操作，而不是特定的命令。要了解如何通过 Peer CLI 使用 Fabric 生命周期，请参阅<a target="_blank" rel="noopener" href="https://hyperledger-fabric.readthedocs.io/en/release-2.3/deploy_chaincode.html">将智能合约部署到通道教程</a>或 <a target="_blank" rel="noopener" href="https://hyperledger-fabric.readthedocs.io/en/release-2.3/commands/peerlifecycle.html">peer lifecycle 命令手册</a>。</p>
<h4 id="第一步：智能合约打包">第一步：智能合约打包</h4>
<p>链码必须先打包成 <code>.tar</code> 文件，然后才能安装在 Peer 节点上。你可以使用 Fabric Peer 命令，Node Fabric SDK 或第三方工具（例如 GNU tar）来打包链码。打包链码时，需要提供一个<strong>链码包标签</strong>，以创建一个的简洁易读的描述。</p>
<p>如果你使用第三方工具打包链码，则生成的文件需要采用以下格式。 Fabric peer 二进制文件和 Fabric SDKs 将自动创建此格式的文件。</p>
<ul>
<li>链码包需要打包成 <code>tar</code> 文件，以 <code>.tar.gz</code> 结尾；</li>
<li>链码包需要包含两个文件（不是目录）：元数据文件 <code>metadata.json</code> 和包含链码文件的 <code>*.tar.gz</code> ；</li>
<li><code>metadata.json</code> 文件包含了链码<strong>使用的语言</strong>、<strong>代码路径</strong>和链码包<strong>标签</strong>。示例如下：</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;Path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;fabric-samples/asset-transfer-basic/chaincode-go&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;Type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;golang&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;Label&quot;</span><span class="punctuation">:</span> <span class="string">&quot;basicv1&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p><code>peer lifecycle chaincode package</code> 把链码 <code>*.tar.gz</code> 和元数据文件 <code>metadata.json</code> 文件打包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode package tmp/<span class="variable">$&#123;CC_LABEL&#125;</span>.tar.gz \</span><br><span class="line">--path <span class="variable">$&#123;CC_PATH&#125;</span> \</span><br><span class="line">--lang <span class="variable">$CC_LANG</span> \</span><br><span class="line">--label <span class="variable">$&#123;CC_LABEL&#125;</span></span><br></pre></td></tr></table></figure>
<p><img src="../../../../assets/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/Hyperledger%20Fabric%20%E9%93%BE%E7%A0%81%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/8fad11d96bc0bf425a43cd30f0963203eb52967ff1141b86176d6e6976944ef6.png" alt="picture 1"></p>
<p><em>链码由 Org1 和 Org2 单独打包。这两个组织都使用 MYCC_1 作为包标签，以便使用名称和版本来标识包。组织无需使用相同的包标签。</em></p>
<h4 id="第二步：安装链码到-peers-中">第二步：安装链码到 peers 中</h4>
<p>每个需要执行交易和为交易背书的 Peer 节点上都要安装链码包。无论是使用 CLI 还是 SDK，你都需要使用 <strong>Peer Admin</strong> 完成此步骤。Peer 节点将在安装链码后构建链码，如果链码出现问题，则返回链码构建错误消息。建议组织只打包一次链码，然后在属于同一个组织的每个 Peer 上安装相同的链码包。如果一个通道想要确保每个组织运行相同的链码，一个组织可以打包一个链码并将其发送给带外的(out of band)的其他通道成员。</p>
<p><code>peer lifecycle chaincode install</code> 命令安装链码包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode install tmp/<span class="variable">$&#123;CC_LABEL&#125;</span>.tar.gz</span><br></pre></td></tr></table></figure>
<p>安装后可以使用如下命令查询 y 已经安装的链码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode queryinstalled --output json | jq</span><br></pre></td></tr></table></figure>
<p>如果输出如下，则链码安装成功，我们可以看到这个包标识符一般是由 <code>链码名_版本号:哈希码</code> 构成的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PACKAGE_ID=mycc_v1.0:03d34a995a0e6b5285746a7662ff42c3ca88145f3a265a5a4580c4c7c5e7e549</span><br></pre></td></tr></table></figure>
<p>安装成功后，将返回一个由包标签与包的哈希组合而成的链码包标识符。此包标识符是用来关联安装在 Peer 上的链码包和组织批准的链码定义的。<strong>该标识符要保存</strong>起来为下一步准备。你还可以通过使用 Peer CLI 查询安装在 Peer 上的包来查找包标识符。</p>
<p><img src="../../../../assets/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/Hyperledger%20Fabric%20%E9%93%BE%E7%A0%81%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/20ea2f6a657756c8d8af8353bccf79909b26e95dbaaaa012aa2b8ea548135a0c.png" alt="picture 2"></p>
<p><em>Org1 和 Org2 的 Peer 管理员在加入该通道的 Peer 上安装 MYCC_1 链码包。安装链码包的过程，完成了构建链码和创建包标识符 <code>MYCC_1:&lt;hashcode&gt;</code> 的的工作。</em></p>
<h4 id="第三步：为组织批准的链码定义">第三步：为组织批准的链码定义</h4>
<p>代码如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果 CORE_PEER_TLS_ENABLED 打开了，则用以下命令</span></span><br><span class="line">peer lifecycle chaincode approveformyorg \</span><br><span class="line">    -o <span class="variable">$&#123;ORDERER_ADDRESS&#125;</span> \</span><br><span class="line">    --ordererTLSHostnameOverride orderer.mynetwork.com \</span><br><span class="line">    --tls <span class="variable">$CORE_PEER_TLS_ENABLED</span> \</span><br><span class="line">    --cafile <span class="variable">$ORDERER_CA</span> \</span><br><span class="line">    --channelID <span class="variable">$CHANNEL_NAME</span> \</span><br><span class="line">    <span class="comment"># 以下是需要整个组织保持一致的链码定义</span></span><br><span class="line">    --name <span class="variable">$&#123;CC_NAME&#125;</span> \</span><br><span class="line">    --version <span class="variable">$&#123;CC_VERSION&#125;</span> \</span><br><span class="line">    --init-required \</span><br><span class="line">    --package-id <span class="variable">$&#123;PACKAGE_ID&#125;</span> \</span><br><span class="line">    --sequence <span class="variable">$CC_SEQ</span> \</span><br><span class="line">    --waitForEvent \</span><br><span class="line">    --signature-policy <span class="string">&quot;<span class="variable">$CC_POLICY</span>&quot;</span> \</span><br><span class="line">    <span class="variable">$PRIVATE_COLLECTION_DEF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果没有打开则用以下命令</span></span><br><span class="line">peer lifecycle chaincode approveformyorg \</span><br><span class="line">    -o <span class="variable">$&#123;ORDERER_ADDRESS&#125;</span> \</span><br><span class="line">    --channelID <span class="variable">$CHANNEL_NAME</span> \</span><br><span class="line">    <span class="comment"># 以下是需要整个组织保持一致的链码定义</span></span><br><span class="line">    --name <span class="variable">$&#123;CC_NAME&#125;</span> \</span><br><span class="line">    --version <span class="variable">$&#123;CC_VERSION&#125;</span> \ <span class="comment"># 包标识符</span></span><br><span class="line">    --init-required \</span><br><span class="line">    --package-id <span class="variable">$&#123;PACKAGE_ID&#125;</span> \</span><br><span class="line">    --sequence <span class="variable">$CC_SEQ</span> \</span><br><span class="line">    --waitForEvent \</span><br><span class="line">    --signature-policy <span class="string">&quot;<span class="variable">$CC_POLICY</span>&quot;</span> \</span><br><span class="line">    <span class="variable">$PRIVATE_COLLECTION_DEF</span></span><br></pre></td></tr></table></figure>
<p>链码受链码定义的约束。当通道成员批准链码定义时，这个批准的过程，就像组织对链码参数的投票。这些经组织批准定义，可以让通道成员在使用链码之前就达成一致。链码定义包括以下参数，这些参数需要整个组织保持一致：</p>
<ul>
<li><code>Name</code> ：应用程序在调用链码时将使用的名称。</li>
<li><code>Version</code> ：与给定链码包关联的版本编号或值。如果你升级了链码二进制文件，你还需要更改链码版本。</li>
<li><code>Sequence</code> ：已定义链码的次数。此值是一个整数，用于跟踪链码升级。例如，当你首次安装和批准链码定义时，序列号为 1。下次升级链码时，序列号将增加为 2。</li>
<li><code>Endorsement Policy</code> ：哪些组织需要执行和验证交易输出。背书策略可以用字符串传递给 CLI ，也可以在通道配置中引用策略。默认情况下，背书策略被设置为 <code>Channel/Application/Endorsement</code> ，该背书策略默认要求该通道中的大多数组织为交易背书。</li>
<li><code>Collection Configuration</code> ：与你的链码关联的私有数据收集定义文件的路径。有关私有数据收集的更多信息，请参阅<a target="_blank" rel="noopener" href="https://hyperledger-fabric.readthedocs.io/en/release-2.3/private-data-arch.html">私有数据架构手册</a>。</li>
<li><code>ESCC/VSCC Plugins</code> ：此链码将使用的自定义背书或验证插件的名称。</li>
<li><code>Initialization</code> ：如果你使用 Fabric 链码 Shim API 提供的低级 APIs ，则你的链码需要包含用于初始化链码的 <code>Init</code> 函数。链码接口需要此函数，但不一定需要由你的应用程序调用。当你批准链码定义时，你可以指定在 invoke 之前是否必须调用 <code>Init</code> 。如果你指定需要 <code>Init</code> ， Fabric 将确保在链码中的任何其他函数之前调用 <code>Init</code> 函数，并且仅调用一次。执行 <code>Init</code> 函数的请求允许你实现在初始化链码时运行的逻辑，例如设置某些初始状态。每次链码版本更新时，你都需要调用 <code>Init</code> 来初始化链码，假设版本号增加的链码定义表示需要 <code>Init</code> 。</li>
</ul>
<p>如果你正在使用 Fabric Peer CLI，你可以在批准并提交链码定义时使用 <code>--init-required</code> 的标记，以表示必须调用 <code>Init</code> 函数来初始化新的链码版本。要使用 Fabric peer CLI 调用 <code>Init</code> ，请使用 <code>peer chaincode invoke</code> 命令并传入 <code>--isInit</code> 标志。</p>
<p>如果你使用的是 Fabric Contract API ，则无需在链码中包含 <code>Init</code> 方法。但是，你仍然可以使用 <code>--init-required</code> 参数来请求通过应用程序的调用来初始化链码。如果使用 <code>--init-required</code> 标志，则每次将链码版本增加时，都需要将 <code>--isInit</code> 参数传递给链码调用，以初始化链码。你可以传递 <code>--isInit</code> 并使用链码中的任何函数来初始化链码。</p>
<p>链码定义还包括<strong>程序包标识符</strong>。这是每个要使用链码的组织的必需参数。程序包标识符不必对于所有组织都相同。组织可以批准链码定义，而无需安装链码包或在定义中不包含标识符。</p>
<p>每个想要使用链码的通道成员都需要为其组织批准链码定义。该批准需要提交给排序服务，然后再分发给所有 Peer 方。该批准需要由你的组织管理员提交。成功提交批准交易后，批准的定义将存储在一个集合中，该集合可供组织的所有 Peer 方用。因此，即使你有多个 Peer 方，你也只需要为组织批准一次链码。</p>
<p><img src="../../../../assets/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/Hyperledger%20Fabric%20%E9%93%BE%E7%A0%81%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/773efc2f61fbfcb4e51ca98bad97f41843741615bba5c7d97e96890e80154069.png" alt="picture 3"></p>
<p><em>Org1 和 Org2 的组织管理员批准其组织的 MYCC 链码定义。链码定义包括链码名称，版本和背书策略以及其他字段。由于两个组织都将使用链码来背书交易，因此两个组织的批准定义都需要包括程序包标识符。</em></p>
<p>组织可以批准链码定义而不安装链码包。如果组织不需要使用链码，则可以批准不带程序包标识符的链码定义，以确保满足生命周期背书策略。</p>
<p>在将链码定义提交到通道后，链码容器将在已安装链码的所有 Peer 上启动，从而允许通道成员开始使用链码。启动链码容器可能需要几分钟。你可以使用链码定义来要求调用 <code>Init</code> 函数来初始化链码。如果请求调用 <code>Init</code> 函数，则链码的第一次调用必须是对 <code>Init</code> 函数的调用。 <code>Init</code> 函数的调用受链码背书策略的约束。</p>
<p><img src="../../../../assets/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/Hyperledger%20Fabric%20%E9%93%BE%E7%A0%81%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/1abe222f69c7c7a4be86059a73571645878eeb5fc5ffd5d23d520a3e550ff247.png" alt="picture 4"></p>
<p><em>一旦在通道上定义了 MYCC ， Org1 和 Org2 就可以开始使用链码了。每个 Peer 上的链码的第一次调用都会在该 Peer 上启动链码容器。</em></p>
<h4 id="第四步：提交链码定义到通道">第四步：提交链码定义到通道</h4>
<p>一旦足够多的通道成员同意一个链码定义，某个组织能够提交定义到通道。你可以用命令 <code>peer lifecycle chaincode checkcommitreadiness</code> 基于哪个通道成员已经批准了该定义，来检查提交链码定义是否应该成功，然后使用 Peer CLI 工具将链码定义提交到通道。（译者注：根据通道成员同意的状况，来判断提交是否可能成功）。提交交易请求首先发送给通道成员的 peer 节点，peer 节点会查询链码定义被他们组织同意的状况，并且为定义背书如果所在组织已经同意了。交易然后提交给排序服务，排序服务会把链码定义提交给通道。提交定义交易需要以 Organization Administrator 身份来提交。</p>
<p>检查链码同意情况：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode checkcommitreadiness \</span><br><span class="line">--channelID <span class="variable">$CHANNEL_NAME</span> \</span><br><span class="line">--name <span class="variable">$&#123;CC_NAME&#125;</span> \</span><br><span class="line">--version <span class="variable">$&#123;CC_VERSION&#125;</span> \</span><br><span class="line">--sequence <span class="variable">$CC_SEQ</span> \</span><br><span class="line">--output json \</span><br><span class="line">--init-required \</span><br><span class="line">--signature-policy <span class="string">&quot;<span class="variable">$CC_POLICY</span>&quot;</span> \</span><br><span class="line"><span class="variable">$PRIVATE_COLLECTION_DEF</span></span><br></pre></td></tr></table></figure>
<p>如果达到了背书条件，可以使用如下命令来提交链码定义到通道，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$CORE_PEER_TLS_ENABLED</span>&quot;</span> == <span class="string">&quot;true&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">    peer lifecycle chaincode commit \</span><br><span class="line">    -o <span class="variable">$&#123;ORDERER_ADDRESS&#125;</span> \</span><br><span class="line">    --ordererTLSHostnameOverride orderer.mynetwork.com \</span><br><span class="line">    --tls <span class="variable">$CORE_PEER_TLS_ENABLED</span> \</span><br><span class="line">    --cafile <span class="variable">$ORDERER_CA</span> \</span><br><span class="line">    --peerAddresses <span class="variable">$PEER0_PROVIDER_ADDRESS</span> \</span><br><span class="line">    --tlsRootCertFiles <span class="variable">$PEER0_PROVIDER_TLS_ROOTCERT_FILE</span> \</span><br><span class="line">    --peerAddresses <span class="variable">$PEER0_SUBSCRIBER_ADDRESS</span> \</span><br><span class="line">    --tlsRootCertFiles <span class="variable">$PEER0_SUBSCRIBER_TLS_ROOTCERT_FILE</span> \</span><br><span class="line">    -C <span class="variable">$CHANNEL_NAME</span> \</span><br><span class="line">    --name <span class="variable">$&#123;CC_NAME&#125;</span> \</span><br><span class="line">    --version <span class="variable">$&#123;CC_VERSION&#125;</span> \</span><br><span class="line">    --sequence <span class="variable">$CC_SEQ</span> \</span><br><span class="line">    --init-required \</span><br><span class="line">    --signature-policy <span class="string">&quot;<span class="variable">$CC_POLICY</span>&quot;</span> \</span><br><span class="line">    <span class="variable">$PRIVATE_COLLECTION_DEF</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    peer lifecycle chaincode commit -o <span class="variable">$&#123;ORDERER_ADDRESS&#125;</span> \</span><br><span class="line">    --peerAddresses <span class="variable">$PEER0_PROVIDER_ADDRESS</span> \</span><br><span class="line">    --peerAddresses <span class="variable">$PEER0_SUBSCRIBER_ADDRESS</span> \</span><br><span class="line">    -C <span class="variable">$CHANNEL_NAME</span> \</span><br><span class="line">    --name <span class="variable">$&#123;CC_NAME&#125;</span> \</span><br><span class="line">    --version <span class="variable">$&#123;CC_VERSION&#125;</span> \</span><br><span class="line">    --sequence <span class="variable">$CC_SEQ</span> \</span><br><span class="line">    --init-required \</span><br><span class="line">    --signature-policy <span class="string">&quot;<span class="variable">$CC_POLICY</span>&quot;</span> \</span><br><span class="line">    <span class="variable">$PRIVATE_COLLECTION_DEF</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<p>使用如下命令检查提交情况，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode querycommitted --channelID <span class="variable">$CHANNEL_NAME</span> --name <span class="variable">$&#123;CC_NAME&#125;</span></span><br></pre></td></tr></table></figure>
<p>链码在被成功提交到通道之前，需要被同意的组织的数量是通过 <code>Channel/Application/LifecycleEndorsement</code> 策略来管理的。默认情况下，这个策略需要通道中大多数的组织来给交易背书。生命周期背书策略不同于链码背书策略。例如，尽管一个链码背书策略只需要一个或两个组织的签名，根据默认策略大多数的通道成员仍然需要批准链码定义。当提交一个通道定义，你需要面向足够多的 peer 组织，以确保你的生命周期背书策略被满足。你可以在 <a target="_blank" rel="noopener" href="https://hyperledger-fabric.readthedocs.io/zh_CN/release-2.2/policies/policies.html">策略概念主题</a> 中了解到更多关于 Fabric 链码生命周期策略。</p>
<p>你也可以设置 <code>Channel/Application/LifecycleEndorsement</code> 策略为一个签名策略并且明确指明通道上可以批准链码定义的组织集合。这允许你创建一个其中大多数组织作为链码管理者并且治理通道业务逻辑的通道。如果你的通道有大量的 Idemix（译者注：身份混合，实现零知识证明）组织，你也可以用一个签名策略（译者注：策略只需要一个签名），因为这些组织不能批准链码定义或者为链码背书并且可能阻碍通道达成大多数成员同意的结果。</p>
<p><img src="../../../../assets/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/Hyperledger%20Fabric%20%E9%93%BE%E7%A0%81%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/da656f5b6c2a5d4436b39753cc73755776951a65e2cedf4e6fcfc77befb77995.png" alt="picture 1"></p>
<p><em>Org1 或 Org2 的一个组织管理员提交链码定义到通道。通道上的定义不包含 packageID。</em></p>
<p>一个组织在不安装链码包的条件下能够批准链码定义。如果一个组织不需要使用链码，他们可以在没有包身份的情况下批准一个链码定义来确保生命周期背书策略被满足。</p>
<p>在链码定义已经提交到通道上后，链码容器会在所有的链码安装到的 peer 节点上启动，来允许通道成员开始使用链码。可能会花费几分钟的时间来启动链码容器。你可以用链码定义来要求调用 <code>Init</code> 方法初始化链码。如果 <code>Init</code> 方法调用是需要的，链码的第一个调用必须是调用 <code>Init</code> 方法。 <code>Init</code> 方法的调用服从于链码的背书策略。</p>
<p><img src="../../../../assets/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/Hyperledger%20Fabric%20%E9%93%BE%E7%A0%81%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/1abe222f69c7c7a4be86059a73571645878eeb5fc5ffd5d23d520a3e550ff247.png" alt="picture 2"></p>
<p><em>一旦 MYCC 链码在通道上定义，Org1 和 Org2 能开始使用链码。每个 peer 节点上的链码的第一个调用会启动该 peer 上的链码容器。</em></p>
<p>调用链码的命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># BASH</span></span><br></pre></td></tr></table></figure>
<h3 id="链码升级">链码升级</h3>
<p>升级链码的过程与安装和启动链码的 Fabric 生命周期相同。你可以升级链码二进制文件，或仅更新链码策略。请按照以下步骤升级链码：</p>
<ol>
<li>
<p>重新打包链码：仅在升级链码二进制文件时才需要完成此步骤。<br>
<img src="../../../../assets/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/Hyperledger%20Fabric%20%E9%93%BE%E7%A0%81%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/3f64011d821ef49bb71bf6a81063b7662f32d21df61293ea81e15760cd869694.png" alt="picture 5"></p>
<p><em>Org1 和 Org2 升级链码二进制文件并重新打包链码。两家公司使用不同的链码包标签。</em></p>
</li>
<li>
<p>在 Peer 上再次安装新的链码软件包：如果要升级链码二进制文件，则仅需要完成此步骤。安装新的链码软件包将生成一个程序包标识符 ，你需要将其传递给新的链码定义。你还需要更改链码版本，生命周期流程将使用它来追踪链码二进制文件，判断是否已升级。<br>
<img src="../../../../assets/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/Hyperledger%20Fabric%20%E9%93%BE%E7%A0%81%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/af2b16ca63944a3cc441c6541065f26696cbfc0f650306005a2750d4611acaf6.png" alt="picture 6"></p>
<p><em>Org1 和 Org2 在其 Peer 节点上安装新软件包。安装将创建一个新的链码包标识符。</em></p>
</li>
<li>
<p>批准新的链码定义：如果要升级链码二进制文件，则需要更新链码定义中的链码版本和程序包标识符。你也可以更新你的链码背书策略，而不必重新打包链码二进制文件。通道成员只需要批准新策略的定义。新定义需要将定义中的序列变量加 1。<br>
<img src="../../../../assets/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/Hyperledger%20Fabric%20%E9%93%BE%E7%A0%81%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/77a875649c1a4477dadaca64c2761d7d1ee5c57ae8ec7e336149fde380820587.png" alt="picture 7"></p>
<p><em>Org1 和 Org2 的组织管理员为各自的组织批准新的链码定义。新定义引用了新的链码包标识符并更改了链码版本。由于这是链码的第一次更新，因此序列从 1 递增到 2 。</em></p>
</li>
<li>
<p>将定义提交给通道：当足够数量的通道成员批准了新的链码定义时，一个组织可以提交新定义以将链码定义升级到通道。作为生命周期过程的一部分，没有单独的升级命令。<br>
<img src="../../../../assets/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/Hyperledger%20Fabric%20%E9%93%BE%E7%A0%81%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/f898ab88ed67fafd96f465837b0c60be5d6eb856d6fad376c122b24ef3c37b87.png" alt="picture 8"></p>
<p><em>来自 Org1 或 Org2 的组织管理员将新的链码定义提交到通道。</em></p>
<p>提交链码定义后，将使用升级的链码二进制文件中的代码启动新的链码容器。如果在链码定义中请求执行 <code>Init</code> 函数，则需要在成功提交新定义后再次调用 <code>Init</code> 函数来始化升级的链码。如果在不更改链码版本的情况下更新了链码定义，则链码容器将保持不变，并且不需要调用 <code>Init</code> 函数。</p>
<p><img src="../../../../assets/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/Hyperledger%20Fabric%20%E9%93%BE%E7%A0%81%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/4864a91eb97ce0828f7a40f9ca1a066ed733f7a033a0a0e95616690d72c09820.png" alt="picture 9"></p>
<p><em>将新定义提交给通道后，每个 Peer 将自动启动新的链码容器。</em></p>
<p>Fabric 链码生命周期使用链码定义中的 <strong>sequence</strong> 来跟踪升级。所有通道成员都需要将序列号加 1 ，并批准新的定义以升级链码。版本参数用于追踪链码二进制文件，仅在升级链码二进制文件时才需要更改。</p>
</li>
</ol>
<h3 id="部署场景">部署场景</h3>
<p>以下示例说明了如何使用 Fabric 链码生命周期来管理通道和链码。</p>
<h4 id="加入通道">加入通道</h4>
<p>新的组织可以使用已定义的链码加入通道，在完成安装链码包和批准已经提交给该通道的链码定义两项工作后，可以开始使用链码。</p>
<p><img src="../../../../assets/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/Hyperledger%20Fabric%20%E9%93%BE%E7%A0%81%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/94e7b38589204b052917e10e27fcf88697387fe4c658503eb349c5fa61a196f6.png" alt="picture 10"></p>
<p>org3 加入通道并批准先前由 org1 和 org2 提交给通道的相同链码定义。</p>
<p>批准链码定义后，新组织可以在将 ​​ 软件包安装到 Peer 后开始使用链码。该定义不需要再次提交。如果将背书策略设置为要求大多数通道成员进行背书的默认策略，则背书策略将自动更新以囊括新组织。</p>
<p><img src="../../../../assets/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/Hyperledger%20Fabric%20%E9%93%BE%E7%A0%81%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/f45cb3b5e2b1423278824c4094b4bef5cc3cd4398985b4569b92ab1299599f95.png" alt="picture 11"></p>
<p>链码容器将在 Org3 的 Peer 上首次调用链码后启动。</p>
<h4 id="更新背书策略">更新背书策略</h4>
<p>你可以使用链码定义来更新背书策略，而不必重新打包或重新安装链码。通道成员可以批准带有新背书策略的链码定义，并将其提交给通道。</p>
<p><img src="../../../../assets/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/Hyperledger%20Fabric%20%E9%93%BE%E7%A0%81%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/ef6db262e497c790162d20ef9ad160ea87c5163a608fa8ba1595352945c9077b.png" alt="picture 12"></p>
<p>Org1 ， Org2 和 Org3 批准了一项新的背书策略，要求三个组织全部都背书一项交易。它们将定义中的 sequence 从 1 增加到 2 ，但是不需要更新链码版本。</p>
<p>新的背书策略将在将新定义提交给通道后生效。通道成员不必通过调用链码或执行 <code>Init</code> 函数来重新启动链码容器即可更新背书策略。</p>
<p><img src="../../../../assets/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/Hyperledger%20Fabric%20%E9%93%BE%E7%A0%81%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/bdb9b29fc8c9bc926ca5b6dc8b02276f03f4d8219000a92476f9d18a80e3fbc9.png" alt="picture 13"></p>
<p>一个组织将新的链码定义提交给通道以更新背书策略。</p>
<h4 id="批准定义而不安装链码">批准定义而不安装链码</h4>
<p>你可以批准链码定义而不安装链码包。这使你可以在将链码定义提交到通道之前对其进行背书，即使你不想使用该链码对交易进背书或查询账本。你批准的链码定义要与通道的其他成员拥有相同的参数，但不需要将链码包标识符包含在链码定义中。</p>
<p><img src="../../../../assets/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/Hyperledger%20Fabric%20%E9%93%BE%E7%A0%81%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/c124306f2a6971e8798b61aa138fe3221dafa0d37be406a41135d3b7f081bc61.png" alt="picture 14"></p>
<p>Org3 不会安装链码软件包。结果，他们不需要提供链码包标识符作为链码定义的一部分。但是， Org3 仍然可以背书已提交给该频道的 MYCC 的定义。</p>
<h4 id="一个组织不同意链码定义">一个组织不同意链码定义</h4>
<p>不批准已提交给通道的链码定义的组织不能使用该链码。未批准链码定义或批准其他链码定义的组织将无法在其 Peer 上执行链码。</p>
<p><img src="../../../../assets/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/Hyperledger%20Fabric%20%E9%93%BE%E7%A0%81%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/04965690dafc98426a2ea5e6b9b0cfa3869532833b4e1079332a616d38597e12.png" alt="picture 15"></p>
<p>Org3 批准的链码定义具有与 Org1 和 Org2 不同的背书 策略。结果， Org3 无法在通道上使用 MYCC 链码。但是， Org1 或 Org2 仍然可以获得足够的背书 ，以将定义提交到通道并使用链码。链码中的交易仍将添加到账本中，并存储在 Org3 的 Peer 中。但是， Org3 将无法背书 交易。</p>
<p>组织可以批准具有任何序列号或版本的新链码定义。这使你可以批准已提交给通道的定义并开始使用链码。你也可以批准新的链码定义，以更正在批准或打包链码过程中犯的任何错误。</p>
<h4 id="通道在链码定义上不一致">通道在链码定义上不一致</h4>
<p>如果通道上的组织们不同意链码定义，则无法将该定义提交给通道。任何通道成员都将无法使用链码。</p>
<p><img src="../../../../assets/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/Hyperledger%20Fabric%20%E9%93%BE%E7%A0%81%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/0e146e68c6e0421ed61b2f30d7f272cdbe3d229cbb5affb971a3022f5c3f4fee.png" alt="picture 16"></p>
<p>Org1 ， Org2 和 Org3 都批准不同的链码定义。结果，该通道的任何成员都无法获得足够的背书以将链码定义提交给该通道。任何通道成员都将无法使用链码。</p>
<h4 id="组织安装不同的链码程序包">组织安装不同的链码程序包</h4>
<p>每个组织在批准链码定义时都可以使用不同的链码包标识符。这允许通道成员安装使用相同背书策略的不同链码二进制文件，并在同一链码命名空间中读取和写入数据。</p>
<p>组织们可以使用此功能来安装拥有特定业务逻辑的智能合约。每个组织的智能合约都可以包含组织在其 Peer 背书交易之前所需的其他验证。每个组织还可以编写代码，以帮助将智能合约与他们现有系统中的数据集成在一起。</p>
<p><img src="../../../../assets/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/Hyperledger%20Fabric%20%E9%93%BE%E7%A0%81%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/02a1f0440f163b70aa09c010aba458b35393fbe65c06622ad0bc3cd88fd6d0ec.png" alt="picture 17"></p>
<p>Org1 和 Org2 每个都安装拥有特定的业务逻辑版本的 MYCC 链码。</p>
<h4 id="使用一个包创建多个链码">使用一个包创建多个链码</h4>
<p>你可以使用一个链码包通过批准和提交多个链码定义，在一个通道上创建多个链码实例。每个定义都需要指定一个不同的链码名称。这使你可以在一个通道上运行智能合约的多个实例，但是要让该合约服从不同的背书策略。</p>
<p><img src="../../../../assets/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/Hyperledger%20Fabric%20%E9%93%BE%E7%A0%81%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/cff829c1624e7d747b94646b6ea08806bcea31631d022fb3ec54dd97b8a7a33e.png" alt="picture 18"></p>
<p>Org1 和 Org2 使用 MYCC_1 链码包来批准和提交两个不同的链码定义。结果，两个 Peer 都有两个在其 Peer 上运行的链码容器。 MYCC1 的背书策略为两者之一背书，而 MYCC2 的背书策略为两者都要背书。</p>
<h4 id="迁移到新的-Fabric-生命周期">迁移到新的 Fabric 生命周期</h4>
<p>有关迁移到新生命周期的信息，请查看<a target="_blank" rel="noopener" href="https://hyperledger-fabric.readthedocs.io/en/release-2.3/upgrade_to_newest_version.html#chaincode-lifecycle">升级到 v2.0 的注意事项</a>。</p>
<p>如果你需要更新通道配置以启用新的生命周期，请检查<a target="_blank" rel="noopener" href="https://hyperledger-fabric.readthedocs.io/en/release-2.3/enable_cc_lifecycle.html">启用新的链码生命周期</a>。</p>
<h4 id="更多信息">更多信息</h4>
<p>你可以观看<a target="_blank" rel="noopener" href="https://youtu.be/XvEMDScFU2M">视频</a>，以了解有关新 Fabric 链码生命周期的动机及其实现方式的更多信息。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/10/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/%E9%93%BE%E7%A0%81%E5%BC%80%E5%8F%91-Golang/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/10/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/%E9%93%BE%E7%A0%81%E5%BC%80%E5%8F%91-Golang/" class="post-title-link" itemprop="url">链码开发-Golang</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-10 00:00:00" itemprop="dateCreated datePublished" datetime="2021-04-10T00:00:00+08:00">2021-04-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-02-01 01:54:07" itemprop="dateModified" datetime="2025-02-01T01:54:07+08:00">2025-02-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/" itemprop="url" rel="index"><span itemprop="name">article</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">计算机</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%8C%BA%E5%9D%97%E9%93%BE/" itemprop="url" rel="index"><span itemprop="name">区块链</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/" itemprop="url" rel="index"><span itemprop="name">Hyperledger Fabric</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="链码开发">链码开发</h2>
<p>Golang 的链码开发有两套 api ：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://pkg.go.dev/github.com/hyperledger/fabric-chaincode-go/shim?utm_source=godoc#Chaincode">shim api</a> 偏底层；</li>
<li><a target="_blank" rel="noopener" href="https://github.com/hyperledger/fabric-contract-api-go/blob/main/tutorials/using-advanced-features.md">contract api</a> 实际上也不过是在 shim api 上做了一层封装，通过获取 shim api 的 stub 来调用 shim api 的 stub；</li>
</ul>
<h3 id="Contract-api">Contract api</h3>
<p>一个合约需要遵循以下的规则：</p>
<ol>
<li>入参的第一个只能是 contratapi.TransactionContext 或者继承了这个结构的接口（自定义的或者 contractapi.TransactionContextInterface ）。其他的入参只能是如下的类型：<br>
string<br>
bool<br>
int (including int8, int16, int32 and int64)<br>
uint (including uint8, uint16, uint32 and uint64)<br>
float32<br>
float64<br>
time.Time<br>
Arrays/slices of any allowable type<br>
Structs (whose public fields are all of the allowable types or another struct)<br>
Pointers to structs<br>
Maps with a key of type string and values of any of the allowable types<br>
interface{} (Only allowed when directly taken in, will receive a string type when called via a transaction)</li>
<li>返回的参数只能是零个、一个或两个</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/10/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/Golang/Golang%20%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86-go%20mod/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/10/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/Golang/Golang%20%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86-go%20mod/" class="post-title-link" itemprop="url">Golang 依赖管理-go mod</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-10 00:00:00" itemprop="dateCreated datePublished" datetime="2021-04-10T00:00:00+08:00">2021-04-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-02-01 01:54:09" itemprop="dateModified" datetime="2025-02-01T01:54:09+08:00">2025-02-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/" itemprop="url" rel="index"><span itemprop="name">article</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">计算机</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">程序设计语言</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/Golang/" itemprop="url" rel="index"><span itemprop="name">Golang</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Golang-依赖管理-go-mod">Golang 依赖管理-go mod</h2>
<h3 id="Go-Module">Go Module</h3>
<p>Go 语言在 1.11 版本之后发布了 <code>go module</code> 是目前最新的依赖管理工具了。<br>
通过设置 <code>GO111MODULE</code> 的值可以开启或禁用 <code>go module</code> 工具。<br>
<code>GO111MUDULE</code> 支持 <code>on</code> <code>auto</code> <code>off</code> 三种模式：</p>
<ul>
<li><code>GO111MODULE=on</code> 编译时会忽略 GOPATH 和 vendor 文件夹，只根据 <code>go.mod</code> 加载依赖；</li>
<li><code>GO111MODULE=auto</code> 当项目在 <code>$GOPATH/src</code> 外，且项目根目录下有 <code>go.mod</code> 文件时，会开启模块支持；</li>
<li><code>GO111MODULE=off</code> 禁用 <code>go module</code> 支持，编译时会从 <code>$GOPATH</code> 和 <code>vendor</code> 下寻找依赖；</li>
</ul>
<h3 id="Go-PROXY">Go PROXY</h3>
<p>在 Go 1.13 之后 <code>GOPROXY</code> 的默认值为 <code>https://proxy.golang.org</code> ，在国内无法访问，所以可以设置为： <code>goproxy.cn</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> GOPROXY=https://goproxy.cn</span><br></pre></td></tr></table></figure>
<h3 id="go-mod-命令">go mod 命令</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">go mod download         下载依赖的module到本地cache（默认为<span class="variable">$GOPATH</span>/pkg/mod目录）</span><br><span class="line">go mod edit             编辑go.mod文件</span><br><span class="line">go mod grap             打印模块依赖图</span><br><span class="line">go mod init             初始化当前文件夹，删除无用的go.mod文件</span><br><span class="line">go mod tidy             增加缺少的module，删除无用的module</span><br><span class="line">go mod vendor           将依赖复制到vendor下</span><br><span class="line">go mod verify           校验依赖</span><br><span class="line">go mod why              解释为什么需要依赖</span><br></pre></td></tr></table></figure>
<h3 id="go-mod">go.mod</h3>
<p><code>go.mod</code> 文件记录了项目所有的依赖信息，其结构大致如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">module github.com/Q1mi/studygo/blogger</span><br><span class="line"></span><br><span class="line">go 1.12</span><br><span class="line"></span><br><span class="line">require (</span><br><span class="line">    github.com/DeanThompson/ginpprof v0.0.0-20190408063150-3be636683586</span><br><span class="line">    github.com/gin-gonic/gin v1.4.0</span><br><span class="line">    github.com/go-sql-driver/mysql v1.4.1</span><br><span class="line">    github.com/jmoiron/sqlx v1.2.0</span><br><span class="line">    github.com/satori/go.uuid v1.2.0</span><br><span class="line">    google.golang.org/appengine v1.6.1 //indirect</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>其中，</p>
<ul>
<li><code>module</code> 定义了包名</li>
<li><code>require</code> 定义依赖以及版本</li>
<li><code>indirect</code> 表示间接引用</li>
</ul>
<h4 id="语义化的版本号">语义化的版本号</h4>
<p>比如 <code>go get foo@v1.2.3</code> ，也可以跟 git 的 tag 或者 branch ，比如 <code>go get foo@master</code> ，当然也可以跟 git 提交 hashcode 比如 <code>go get foo@3702bed2</code> 。关于依赖的版本支持以下几种格式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gopkg.in/tomb.v1 v1.0.1-20141024135613-dd632973f1e7</span><br><span class="line">gopkg.in/vmihailenco/msgpack.v2 v2.9.1</span><br><span class="line">gopkg.in/yaml.v2 &lt;= v2.2.1</span><br><span class="line">github.com/tatsushid/go-fastping v0.0.0-20160109021039-d7bb493dee3e</span><br><span class="line">latest</span><br></pre></td></tr></table></figure>
<h4 id="replace">replace</h4>
<p>在国内访问 <a target="_blank" rel="noopener" href="http://golang.org/xxx">golang.org/xxx</a> 的包都要翻墙，可以在 <code>go.mod</code> 中使用 <code>replace</code> 语法将 <code>require</code> 的包替换成 github 或者 gitee 上相应的库。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">replace (</span><br><span class="line">    golang.org/x/crypto v0.0.0-20180820150726-614d502a4dac =&gt; github.com/golang/crypto v0.0.0-20180820150726-614d502a4dac</span><br><span class="line">    golang.org/x/net v0.0.0-20180821023952-922f4815f713 =&gt; github.com/golang/net v0.0.0-20180826012351-8a410e7b638d</span><br><span class="line">    golang.org/x/text v0.3.0 =&gt; github.com/golang/text v0.3.0</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h4 id="go-get">go get</h4>
<p><code>go get</code> 是下载依赖的命令，还可以指定版本。如果是下载所有依赖，可以用 <code>go mod download</code> 。</p>
<h4 id="整理依赖">整理依赖</h4>
<p>在代码中删除了依赖项之后，在 <code>go.mod</code> 文件中并不会删除，我们需要用 <code>go mod tidy</code> 命令更新 <code>go.mod</code> 中的依赖关系；</p>
<h4 id="go-mod-edit">go mod edit</h4>
<p><code>go mod edit -fmt</code> 帮助我们格式化 <code>go.mod</code> 文件，使文件不会因为手动修改而太乱。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/10/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/Golang/Golang%20%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/10/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/Golang/Golang%20%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" class="post-title-link" itemprop="url">Golang 程序设计语言基础-数据结构</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-10 00:00:00" itemprop="dateCreated datePublished" datetime="2021-04-10T00:00:00+08:00">2021-04-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-02-01 01:54:09" itemprop="dateModified" datetime="2025-02-01T01:54:09+08:00">2025-02-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/" itemprop="url" rel="index"><span itemprop="name">article</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">计算机</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">程序设计语言</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/Golang/" itemprop="url" rel="index"><span itemprop="name">Golang</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Golang-程序设计语言基础-数据结构">Golang 程序设计语言基础-数据结构</h2>
<h3 id="数组">数组</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 数组</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 是存放元素的容器</span></span><br><span class="line"><span class="comment">// 必须指定存放元素的类型和长度</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> a1 [<span class="number">3</span>]<span class="type">bool</span></span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">&quot;a1:%T\n&quot;</span>, a1)</span><br><span class="line">	<span class="comment">// a1:[3]bool</span></span><br><span class="line">	<span class="comment">// 长度是类型的一部分，长度不同的数组是无法比较和赋值的</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 初始化</span></span><br><span class="line">	fmt.Println(a1)</span><br><span class="line">	<span class="comment">// [false false false]</span></span><br><span class="line">	<span class="comment">// 默认用零值初始化，bool-false，int-0，float-0，string-&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 1. 一般的初始化方式</span></span><br><span class="line">	a1 = [<span class="number">3</span>]<span class="type">bool</span>&#123;<span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 2. 根据初始值推断长度</span></span><br><span class="line">	a4 := [...]<span class="type">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line">	fmt.Println(a4)</span><br><span class="line">	<span class="comment">// [1 2 3 4]</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 3. 使用索引初始化</span></span><br><span class="line">	a5 := [<span class="number">5</span>]<span class="type">int</span>&#123;<span class="number">0</span>: <span class="number">1</span>, <span class="number">4</span>: <span class="number">2</span>&#125;</span><br><span class="line">	fmt.Println(a5)</span><br><span class="line">	<span class="comment">// [1 0 0 0 2]</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 数组的遍历</span></span><br><span class="line">	citys := [<span class="number">5</span>]<span class="type">string</span>&#123;<span class="string">&quot;东莞&quot;</span>, <span class="string">&quot;广州&quot;</span>, <span class="string">&quot;深圳&quot;</span>, <span class="string">&quot;长春&quot;</span>, <span class="string">&quot;昆明&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 1. 根据索引遍历</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(citys); i++ &#123;</span><br><span class="line">		fmt.Println(citys[i])</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 东莞</span></span><br><span class="line">	<span class="comment">// 广州</span></span><br><span class="line">	<span class="comment">// 深圳</span></span><br><span class="line">	<span class="comment">// 长春</span></span><br><span class="line">	<span class="comment">// 昆明</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 2. for range 遍历</span></span><br><span class="line">	<span class="keyword">for</span> i, v := <span class="keyword">range</span> citys &#123;</span><br><span class="line">		fmt.Println(i, v)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 0 东莞</span></span><br><span class="line">	<span class="comment">// 1 广州</span></span><br><span class="line">	<span class="comment">// 2 深圳</span></span><br><span class="line">	<span class="comment">// 3 长春</span></span><br><span class="line">	<span class="comment">// 4 昆明</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 多维数组</span></span><br><span class="line">	a11 := [<span class="number">3</span>][<span class="number">4</span>]<span class="type">int</span>&#123;</span><br><span class="line">		&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;,</span><br><span class="line">		&#123;<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>&#125;,</span><br><span class="line">		&#123;<span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>&#125;,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(a11)</span><br><span class="line">	<span class="comment">// [[1 2 3 4] [5 6 7 8] [9 10 11 12]]</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 数组是值类型</span></span><br><span class="line">	b1 := [<span class="number">3</span>]<span class="type">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line">	b2 := b1</span><br><span class="line">	b2[<span class="number">0</span>] = <span class="number">3</span></span><br><span class="line">	fmt.Println(b1)</span><br><span class="line">	<span class="comment">// [1 2 3]</span></span><br><span class="line">	fmt.Println(b2)</span><br><span class="line">	<span class="comment">// [3 2 3]</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 因为是值类型，所以再赋值之后相当于重新创建了一个对象</span></span><br><span class="line">	<span class="comment">// 对新创建的对象的操作，不会影响原来的对象</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="切片">切片</h3>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/10/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/Golang/Golang%20%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80-%E7%BB%93%E6%9E%84%E4%BD%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/10/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/Golang/Golang%20%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80-%E7%BB%93%E6%9E%84%E4%BD%93/" class="post-title-link" itemprop="url">Golang 程序设计语言基础-结构体</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-10 00:00:00" itemprop="dateCreated datePublished" datetime="2021-04-10T00:00:00+08:00">2021-04-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-02-01 01:54:09" itemprop="dateModified" datetime="2025-02-01T01:54:09+08:00">2025-02-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/" itemprop="url" rel="index"><span itemprop="name">article</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">计算机</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">程序设计语言</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/Golang/" itemprop="url" rel="index"><span itemprop="name">Golang</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Golang-程序设计语言基础-结构体">Golang 程序设计语言基础-结构体</h2>
<h3 id="自定义类型和类型别名">自定义类型和类型别名</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义类型</span></span><br><span class="line"><span class="keyword">type</span> myInt <span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 类型别名</span></span><br><span class="line"><span class="keyword">type</span> yourInt = <span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> n myInt</span><br><span class="line">	n = <span class="number">100</span></span><br><span class="line">	fmt.Println(n)</span><br><span class="line">	fmt.Printf(<span class="string">&quot;%T\n&quot;</span>, n)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> m yourInt</span><br><span class="line">	m = <span class="number">200</span></span><br><span class="line">	fmt.Println(m)</span><br><span class="line">	fmt.Printf(<span class="string">&quot;%T\n&quot;</span>, m)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">100</span><br><span class="line">main.myInt</span><br><span class="line">200</span><br><span class="line">int</span><br></pre></td></tr></table></figure>
<p>类型别名的类型本质上还是原来的类型，源代码经过编译之后，还是会变成原来的类型。这是为了代码编写时，丰富类型的含义，尽管两种类型使用的底层类型是同一个类型，但我们能够从源码层面区分这两种类型，便于理解；<br>
而自定义类型已经不是</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/08/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/Hyperledger%202.3%E6%9B%B4%E6%96%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/08/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/Hyperledger%202.3%E6%9B%B4%E6%96%B0/" class="post-title-link" itemprop="url">Hyperledger 2.3更新</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-08 00:00:00" itemprop="dateCreated datePublished" datetime="2021-04-08T00:00:00+08:00">2021-04-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-02-01 01:54:07" itemprop="dateModified" datetime="2025-02-01T01:54:07+08:00">2025-02-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/" itemprop="url" rel="index"><span itemprop="name">article</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">计算机</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%8C%BA%E5%9D%97%E9%93%BE/" itemprop="url" rel="index"><span itemprop="name">区块链</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/" itemprop="url" rel="index"><span itemprop="name">Hyperledger Fabric</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Hyperledger-2-3-更新">Hyperledger 2.3 更新</h2>
<h3 id="重要更新">重要更新</h3>
<ul>
<li><strong>系统通道不再需要创建了</strong></li>
<li><strong>Consortium 不需要再创建了</strong></li>
<li><strong>简化了排序节点的创建过程</strong></li>
</ul>
<p>更新的好处：</p>
<ul>
<li>增强了隐私性</li>
<li>扩展性增强</li>
<li>灵活性增强</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/08/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/python/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/python%20%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/08/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/python/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/python%20%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4/" class="post-title-link" itemprop="url">python 作用域和命名空间</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-08 00:00:00" itemprop="dateCreated datePublished" datetime="2021-04-08T00:00:00+08:00">2021-04-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-02-01 01:54:09" itemprop="dateModified" datetime="2025-02-01T01:54:09+08:00">2025-02-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/" itemprop="url" rel="index"><span itemprop="name">article</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">计算机</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">程序设计语言</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/python/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" itemprop="url" rel="index"><span itemprop="name">面向对象</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="python-作用域和命名空间">python 作用域和命名空间</h2>
<ul>
<li><a href="#python-%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4">python 作用域和命名空间</a>
<ul>
<li><a href="#%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4">命名空间</a></li>
<li><a href="#%E4%BD%9C%E7%94%A8%E5%9F%9F">作用域</a></li>
</ul>
</li>
</ul>
<h3 id="命名空间">命名空间</h3>
<p>官方文档描述：</p>
<blockquote>
<p>namespace （命名空间）是一个从名字到对象的映射。</p>
</blockquote>
<p>我们在编程时使用的内置函数 <code>len()</code> 、 <code>try... catch ...</code> 中捕获的 <code>Exception</code> 类，并不是天然就存在的，他们都源自于 python 内建的包，也就是所谓的 <code>buildins</code> 。编译器从 <code>buildins</code> 中寻找这个“名”到“指令实体”的过程其实就是在命名空间中搜索。</p>
<p>命名空间也可以由我们自己定义，比方说我定义了一个 <code>class</code> ，其中包含了若干的函数和变量。我在类外 <code>import</code> 这个类（其实就是导入了这个包的命名空间）我们在使用时，一般就是 <code>&lt;class_name&gt;.&lt;attribute&gt;</code> ，解释器就会去 <code>&lt;class_name&gt;</code> 下寻找这个 <code>&lt;attribute&gt;</code> 这个“名”对应的“对象”，然后调用之。</p>
<h3 id="作用域">作用域</h3>
<p>官方文档描述：</p>
<blockquote>
<p>一个 作用域 是一个命名空间可直接访问的 Python 程序的文本区域。</p>
</blockquote>
<p>从例子中说明：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">scope_test</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">do_local</span>():</span><br><span class="line">        <span class="comment"># 作用域在 do_local() 内</span></span><br><span class="line">        spam = <span class="string">&quot;local spam&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">do_nonlocal</span>():</span><br><span class="line">        <span class="comment"># 受 nonlocal 关键字影响，对 spam 的赋值影响到了 scope_test() 了</span></span><br><span class="line">        <span class="keyword">nonlocal</span> spam</span><br><span class="line">        spam = <span class="string">&quot;nonlocal spam&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">do_global</span>():</span><br><span class="line">        <span class="comment"># 受 global 关键字影响，对 spam 的赋值影响到了整个模块</span></span><br><span class="line">        <span class="comment"># 在 scope_test() 外的使用受到了影响</span></span><br><span class="line">        <span class="keyword">global</span> spam</span><br><span class="line">        spam = <span class="string">&quot;global spam&quot;</span></span><br><span class="line"></span><br><span class="line">    spam = <span class="string">&quot;test spam&quot;</span></span><br><span class="line">    do_local()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;After local assignment:&quot;</span>, spam)</span><br><span class="line">    do_nonlocal()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;After nonlocal assignment:&quot;</span>, spam)</span><br><span class="line">    do_global()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;After global assignment:&quot;</span>, spam)</span><br><span class="line"></span><br><span class="line">scope_test()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;In global scope:&quot;</span>, spam)</span><br></pre></td></tr></table></figure>
<p>上述变量 <code>spam</code> 被多处定义，被绑定到多个作用域中了，</p>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">After local assignment: test spam</span><br><span class="line">After nonlocal assignment: nonlocal spam</span><br><span class="line">After global assignment: nonlocal spam</span><br><span class="line">In global scope: global spam</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/21/">21</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/6/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">John Doe</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdn.bootcdn.net/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdn.bootcdn.net/ajax/libs/mermaid/11.4.0/mermaid.min.js","integrity":"sha256-G8ouPAnw4zzMbnAenHnVz6h9XpKbNdOkrqTh7AadyHs="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>





  





</body>
</html>
