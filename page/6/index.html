<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.22.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/6/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/6/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/6/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Hexo</title>
  







<link 
  rel="stylesheet" 
  href="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.css"
>
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Hexo</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">204</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">78</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">77</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/08/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/python/flask/flask%20%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/08/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/python/flask/flask%20%E5%85%A5%E9%97%A8/" class="post-title-link" itemprop="url">flask 入门</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-08 00:00:00" itemprop="dateCreated datePublished" datetime="2021-04-08T00:00:00+08:00">2021-04-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-02-01 01:54:09" itemprop="dateModified" datetime="2025-02-01T01:54:09+08:00">2025-02-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/" itemprop="url" rel="index"><span itemprop="name">article</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">计算机</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">程序设计语言</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/python/flask/" itemprop="url" rel="index"><span itemprop="name">flask</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="flask-入门">flask 入门</h2>
<ul>
<li><a href="#flask-%E5%85%A5%E9%97%A8">flask 入门</a>
<ul>
<li><a href="#hello-world">Hello World</a></li>
</ul>
</li>
</ul>
<h3 id="Hello-World">Hello World</h3>
<p>第一个 Hello World 程序：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> redirect</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> abort</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> make_response</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 简单的路由示例</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    user_agent = request.headers.get(<span class="string">&#x27;User-Agent&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&lt;p&gt;Your browser is %s&lt;/p&gt;&#x27;</span> % user_agent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 动态路由 name 作为 url 参数传入</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/hello/&lt;name&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&lt;h1&gt;Hello %s!&lt;/h1&gt;&#x27;</span> % name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 带有状态码的返回值</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/404&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">notFound</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&lt;h1&gt;Not Found&lt;/h1&gt;&#x27;</span>, <span class="number">404</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重定向测试</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/redirect&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">redirectto</span>():</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;https://www.baidu.com&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># abort 错误处理函数测试</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/abort&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aborttest</span>():</span><br><span class="line">    abort(<span class="number">404</span>)</span><br><span class="line">    <span class="comment"># abort() 被调用之后不会再回到这个函数</span></span><br><span class="line">    <span class="comment"># 而是直接将控制权交给 Web 服务器</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&lt;h1&gt;Not Found&lt;/h1&gt;&#x27;</span>, <span class="number">404</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># make_response 建立响应测试</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/test_response&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">responseTest</span>():</span><br><span class="line">    response = make_response(<span class="string">&#x27;&lt;h1&gt;This document carries a cookie!&lt;/h1&gt;&#x27;</span>)</span><br><span class="line">    response.set_cookie(<span class="string">&#x27;answer&#x27;</span>, <span class="string">&#x27;42&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>打开浏览器输入 <code>localhost:5000</code> 就能看到以下图片：</p>
<p><img src="../../../../../assets/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/python/flask/flask%20%E5%85%A5%E9%97%A8/81cee5436729e1238fd26e4ca93f4e63ba9d721317e16746f799b158ef90823c.png" alt="picture 1"></p>
<p>这是 <code>index()</code> 方法返回的结果；</p>
<p><img src="../../../../../assets/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/python/flask/flask%20%E5%85%A5%E9%97%A8/04d4c81bcac11ea2cc44430d06b3e78e2fb14a2e029b916197285f741101a83d.png" alt="picture 3"></p>
<p>这是 <code>hello(name)</code> 方法的返回结果；</p>
<p>输入 <code>@app.route()</code> 内部对应的路径，就能够进入到对应的视图函数。</p>
<blockquote>
<p>视图函数：就是上面定义的那一个个的函数</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/07/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%B7%A5%E5%85%B7/docker/docker%E5%AE%B9%E5%99%A8%E9%83%A8%E7%BD%B2%E9%94%99%E8%AF%AF%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/07/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%B7%A5%E5%85%B7/docker/docker%E5%AE%B9%E5%99%A8%E9%83%A8%E7%BD%B2%E9%94%99%E8%AF%AF%E5%88%86%E6%9E%90/" class="post-title-link" itemprop="url">docker容器部署错误分析</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-07 00:00:00" itemprop="dateCreated datePublished" datetime="2021-04-07T00:00:00+08:00">2021-04-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-02-01 01:54:09" itemprop="dateModified" datetime="2025-02-01T01:54:09+08:00">2025-02-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/" itemprop="url" rel="index"><span itemprop="name">article</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">计算机</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%B7%A5%E5%85%B7/docker/" itemprop="url" rel="index"><span itemprop="name">docker</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="docker-容器部署错误分析">docker 容器部署错误分析</h2>
<p>今天用 docker-compose 部署 Hyperledger Fabric 网络的时候， <a target="_blank" rel="noopener" href="http://peer1.subscriber.mynetwork.com">peer1.subscriber.mynetwork.com</a> 容器出现了 Exited(1) 的错误。</p>
<p>使用 <code>docker logs &lt;container_name&gt;</code> 命令，列出了这个容器的日志</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2021-04-07 03:49:03.657 UTC [main] InitCmd -&gt; ERRO 001 Cannot run peer because error when setting up MSP of type bccsp from directory /etc/hyperledger/fabric/msp: administrators must be declared when no admin ou classification is set</span><br></pre></td></tr></table></figure>
<p>查看 <code>/etc/hyperledger/fabric/msp</code> 目录挂载在哪里，将目录结构和另一个成功启动的节点对比，发现少了一个 <code>msp/config.yaml</code> 文件，然后将 <code>config.yaml</code> 文件从外面的 <code>msp</code> 目录复制进来就好了，像另一个节点那样操作。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/05/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/Fabric%20CA%E9%83%A8%E7%BD%B2%E8%BF%87%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/05/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/Fabric%20CA%E9%83%A8%E7%BD%B2%E8%BF%87%E7%A8%8B/" class="post-title-link" itemprop="url">Fabric CA部署过程</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-05 00:00:00" itemprop="dateCreated datePublished" datetime="2021-04-05T00:00:00+08:00">2021-04-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-02-01 01:54:07" itemprop="dateModified" datetime="2025-02-01T01:54:07+08:00">2025-02-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/" itemprop="url" rel="index"><span itemprop="name">article</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">计算机</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%8C%BA%E5%9D%97%E9%93%BE/" itemprop="url" rel="index"><span itemprop="name">区块链</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/" itemprop="url" rel="index"><span itemprop="name">Hyperledger Fabric</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Fabric-CA-部署过程">Fabric CA 部署过程</h2>
<h3 id="下载二进制文件">下载二进制文件</h3>
<p>这些二进制文件中，您可能想改用 Fabric CA 映像，例如在 Kubernetes 或 Docker 部署。不过，到目前为止，本主题的目的是教您如何正确使用二进制文件。服务器和 CA 客户端二进制文件。掌握了使用部署和运行 CA 之后 Fabric CA 服务器和 CA 客户端二进制文件可以从 github 下载。向下滚动到 Assets ，然后为您的计算机类型选择最新的二进制文件。 .zip 文件包含两个 CA 。</p>
<h4 id="服务器二进制文件">服务器二进制文件</h4>
<p>在本主题中，我们使用服务器二进制文件来部署三种不同类型的 CA：TLS CA ，组织 CA ，以及可选的中间 CA 。 TLS CA 颁发安全的证书在组织中的所有节点之间进行通信。组织 CA 颁发身份证书。如果您决定包括一个中间 CA ，则组织 CA 将充当根 CA 规划 CA 以了解每种类型的 CA 的目的及其差异。我们跑 CA 或中间 CA 的父服务器。如果您还没有，请查看该主题 TLS CA ，组织 CA 和来自不同文件夹的中间 CAS 。我们将 CA 服务器二进制文件复制到每个文件夹。</p>
<h4 id="客户端二进制文件">客户端二进制文件</h4>
<p>同样，我们将 Fabric CA 客户端二进制文件复制到其自己的目录中。将 CA 客户端放在其自己的文件夹中可简化证书管理，尤其是当您需要与多个 CA 进行交互时。当您从 CA 客户端向 CA 服务器发出命令时，可以通过修改请求中的 CA 服务器 URL 来定位特定的 CA 。因此，仅需要单个 Fabric CA client 二进制文件，即可用于与多个 CA 进行事务处理。有关在下面使用 Fabric CA 客户端的更多信息。</p>
<h3 id="Fabric-CA-客户端">Fabric CA 客户端</h3>
<p>在部署 Fabric CA 服务器之前，您需要了解 Fabric CA 客户端的角色。Fabric CA 客户本主题假定正在使用单个 Fabric CA 客户端。注册身份或用户是使用 LDAP 服务器进行用户注册，则不需要注册步骤，因为将注册 ID 和机密添加到 CA 数据库“用户注册表”的过程。如果你是虽然可以使用 Fabric SDK 与 CA 进行交互，但建议您使用 Fabric CA 客户端注册和注册节点管理员身 ​​ 份。在此提供的说明 LDAP 数据库中已经存在身份。注册用户后，您可以使用结构需要作为组织的一部分进行交易。当您提交注册请求时， CA 客户端“注册”身份，该身份是生成证书的过程由于您将使用单个 CA 客户端向多个 CA 提交注册和注册请求，因此在使用 CA 客户端时，证书管理至关重要。最佳做法专用和公用密钥首先由 Fabric CA 客户端在本地生成，然后将公用密钥发送到 CA ， CA 返回编码的“签名证书”。因此，将为 CA 客户端将与之交互的每个 CA 服务器创建子文件夹，以存储生成的证书。</p>
<p>由于您将使用单个 CA 客户端向多个 CA 提交注册和注册请求，因此在使用 CA 客户端时，证书管理至关重要。最佳做法因此，将为 CA 客户端将与之交互的每个 CA 服务器创建子文件夹，以存储生成的证书。</p>
<ul>
<li>创建一个子文件夹以连接到每个 CA 服务器，例如 <code>/tls-ca</code> 或， <code>/orgl.ca</code> 或。该文件夹可以在 Fabric CA 客户端下，也可以在 CA 客户端可以访问的任何位置下 <code>/int-ca</code> 访问路径。出于这些说明的目的，这些文件夹位于 <code>fabric-ca-client</code> 目录内。例如：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> fabric-ca-client</span><br><span class="line"><span class="built_in">cd</span> fabric-ca-client</span><br><span class="line"><span class="built_in">mkdir</span> tls-ca org1-ca int-ca</span><br></pre></td></tr></table></figure>
<p>提示：虽然您可以从任何首选的文件夹中运行 Fabric CA 客户端二进制文件，但为了方便起见，在遵循这些说明时，我们将在其自己的目录中对其进行引用按客户要求的结构。</p>
<p>SSL 握手。名为的 TLS CA 根证书在 TLS CA 上生成客户端与服务器之间的通信。例如，当 Fabric CA 客户端发出注册或向 CA 服务器注册请求，客户端请求包括该根证书以执行客户结构将 Fabric CA 客户端二进制文件复制到该文件夹 ​​ 中。</p>
<ul>
<li>将 Fabric CA 客户端二进制文件复制到 <code>fabric-ca-client</code> 文件夹中。</li>
<li>因为在生产网络上启用了 TLS 通信，所以组织的 TLS CA 负责生成证书，以保护组织中所有节点之间的通信安全。因此， Fabric CA 客户端每次与该组织中的 CA 服务器进行交易时，都需要提供 TLS CA “根证书”以保护 <code>ca-cert.pem</code> ，在服务器配置 <code>.yaml</code> 文件中启用 TLS 之后。要为您的 CA 客户端启用 TLS 通信，您需要一个子文件夹来存储<code>tls-root-cert</code> 。在本主题的稍后部分，我们将把根证书复制到该文件夹 ​​ 中。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> tls-root-cert</span><br></pre></td></tr></table></figure>
<p>产生的文件夹结构类似于：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fabric-ca-client</span><br><span class="line">  ├── int-ca</span><br><span class="line">  ├── org1-ca</span><br><span class="line">  ├── tls-ca</span><br><span class="line">  └── tls-root-cert</span><br></pre></td></tr></table></figure>
<p>重要提示：如果您的 Fabric CA 客户端将与来自受不同 TLS 服务器保护的多个组织的 CAS 进行交易，则您将需要创建不同的 <code>tls-root-cert</code> 文件夹来保存每个组织的 TLS CA 根证书，或者在内部简单地命名不同文件夹以区分它们。<br>
由于我们的 Fabric CA 客户端将仅与同一组织中的 CA 服务器进行事务处理，而所有这些服务器均由相同的 TLS CA 保护，因此我们在此文件夹中将只有一个根证书。</p>
<p>您可以在 CLI 命令上使用环境变量或标志来指定证书和 Fabric CA 客户端二进制文件的位置：</p>
<ul>
<li><code>FABRIC_CA_CLIENT_HOME</code> ：指定 Fabric CA 客户端二进制文件所在的标准路径。</li>
<li><code>FABRIC_CA_CLIENT_TLS_CERTFILES</code> ：指定 TLS CA 根证书的位置和名称。如果环境变量 <code>FABRIC_CA_CLIENT_TLS_CERTFILES</code> 的路径不是绝对路径，则将其解析为相对于 <code>FABRIC_CA_CLIENT_HOME</code> 指定的 Fabric CA 客户端主目录的相对路径。在这些说明中，我们在命令上使用 <code>--tls.certfiles</code> 标志，而不是指定 TLS CA 根证书的位置。</li>
<li><code>FABRIC_CA_CLIENT_MSPDIR</code> ：尽管您可以使用此环境变量来指定证书所在的文件夹的名称，但是由于客户端与多个 CA 进行通信，所以更好的选择是在 register 上显式传递 <code>--mspdir</code> 标志，并注册命令以指定位置。如果未在命令上指定，则该位置默认为 <code>$FABRIC_CA_CLIENT_HOME/msp</code> ，如果 Fabric CA 客户端与组织中的多个 CA 服务器进行交易，则该位置将成问题。</li>
</ul>
<p>提示：第一次从 CA 客户端发出 <code>enroll</code> 命令时，如果 <code>$FABRIC_CA_CLIENT_HOME</code> 目录中尚不存在 <code>fabric-ca-client-config.yaml</code> ，则会生成该命令。当您自定义此文件中的值时， CA 客户端会自动使用它们，而不必在后续的 <code>enroll</code> 命令中在命令行中传递它们。</p>
<p>在这些说明中，始终使用单个 Fabric CA 客户端与多个 CA 服务器进行交互，但这不一定是必需的模式。另一种选择是为每个 CA 服务器使用单个 Fabric CA 客户端。在这种情况下，当为 CA 服务器管理员发出初始注册命令时，将生成到服务器的 Fabric CA 客户端连接设置，并将其存储在 <code>fabric-ca-client-config.yaml</code> 文件中。</p>
<h3 id="从-CLI-提交事务">从 CLI 提交事务</h3>
<p>CA 服务器和 CA 客户端二进制文件随附了两组 CLI 命令：</p>
<ul>
<li>使用 Fabric CA 服务器 CLI 命令来部署和更新 CA 服务器。</li>
<li>设置后，使用 Fabric CA 客户端 CLI 命令将请求提交到您的 CA 服务器，例如注册，注册或吊销身份。</li>
</ul>
<p>在本主题中，我们将同时使用这两个 CLI 命令。</p>
<h3 id="我应该按什么顺序部署-CA-？">我应该按什么顺序部署 CA ？</h3>
<p>假设您将不部署同时包含 TLS CA 和组织 CA 的双头 CA ，则可以按以下顺序部署 CA ：</p>
<ol>
<li>
<p>部署 TLS CA<br>
由于生产网络中需要 TLS 通信，因此必须在每个 CA，对等方和订购节点上启用 TLS。尽管《 CA Operations 指南》中的示例配置在所有组织中共享一个 TLS CA，但建议的生产配置是为每个组织部署 TLSCA。 TLS CA 颁发 TLS 证书，以确保网络上所有节点之间的通信安全。因此，需要首先对其进行部署以为节点之间发生的 TLS 握手生成 TLS 证书。</p>
</li>
<li>
<p>部署组织 CA<br>
这是组织的身份注册 CA ，用于注册和注册将要从该组织参与网络的身份。</p>
</li>
<li>
<p>部署中间 CA （可选）<br>
如果您决定在网络中包括中间 CA，则必须先部署中间 CA 的父服务器（关联的根 CA ），然后再部署任何中间 CA 。</p>
</li>
</ol>
<h3 id="部署-TLS-CA">部署 TLS CA</h3>
<p>无论您是设置 TLS CA ，组织 CA 还是中间 CA ，该过程都遵循相同的总体步骤。区别在于您对 CA 服务器配置 .yaml 文件所做的修改。以下步骤概述了该过程：</p>
<ol>
<li>初始化 CA 服务器</li>
<li>修改 CA 服务器配置</li>
<li>删除 CA 服务器证书</li>
<li>启动 CA 服务器</li>
<li>使用 TLS CA 注册引导用户</li>
</ol>
<p>部署任何节点时， TLS 配置都有三个选项：</p>
<ul>
<li>没有 TLS。不建议用于生产网络。</li>
<li>服务器端 TLS。</li>
<li>相互 TLS。</li>
</ul>
<p>此过程将配置一个启用了服务器端 TLS 的 CA ，推荐用于生产网络。默认情况下，相互 TLS 是禁用的。如果需要使用双向 TLS ，请参考 TLS 配置设置。</p>
<h4 id="在你开始之前">在你开始之前</h4>
<p>您应该已经下载了 Fabric CA 服务器二进制文件 <code>fabric-ca-server</code> 并将其复制到计算机上的干净目录中。出于这些说明的目的，我们将二进制文件放入其自己的名为 <code>fabric-ca-server-tls</code> 的文件夹中。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> fabric-ca-server-tls</span><br></pre></td></tr></table></figure>
<p>将 <code>fabric-ca-server</code> 二进制文件复制到此文件夹中。</p>
<h4 id="初始化-TLS-CA-服务器">初始化 TLS CA 服务器</h4>
<p>部署 CA 服务器的第一步是对其进行“初始化”。通过指定 CA 的管理员用户 ID 和密码，运行以下 CA Server CLI 命令以初始化服务器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./fabric-ca-server init -b &lt;ADMIN_USER&gt;:&lt;ADMIN_PWD&gt;</span><br></pre></td></tr></table></figure>
<p>例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> fabric-ca-server-tls</span><br><span class="line">./fabric-ca-server init -b tls-admin:tls-adminpw</span><br></pre></td></tr></table></figure>
<p><code>-b</code> （引导程序身份）标志将管理员用户名和密码引导至 CA 服务器，该服务器名有效地为您向服务器“注册”了 CA admin 用户，因此引导用户不需要显式的 Fabric CA 客户端 CLI 册命令。除了使用 <code>-b</code> 标志隐式注册的该 CA 管理员身份外，所有 CA 用户都需要先“注册”然后再“注册”到 CA 。注册过程会将用户插入到 CA 数据库中。当将配置 LDAP 时，不需要 <code>-b</code> 选项进行初始化。</p>
<p>注意：此示例仅用于说明目的。显然，在生产环境中，您永远不会使用 <code>tls-admin</code> 和 <code>tls-adminpw</code> 作为引导程序用户名和密码。确保记录了您指定的管理员 ID 和密码。稍后当您向 CA 发出注册和注册命令时，它们是必需的。使用有意义的 ID 可以帮助您区分与哪个服务器进行交易并遵循安全密码惯例。</p>
<h4 id="CA-服务器初始化命令有什么作用？">CA 服务器初始化命令有什么作用？</h4>
<p><code>init</code> 命令实际上不会启动服务器，但是会生成所需的元数据（如果该元数据对于服务器而言尚不存在）：</p>
<ul>
<li>将默认的 CA Home 目录（在这些说明中称为 <code>FABRIC_CA_HOME</code> ）设置为运行 <code>fabric-ca-server init</code> 命令的位置。</li>
<li>生成默认配置文件 <code>fabric-ca-server-config.yaml</code> ，该文件用作 <code>FABRIC_CA_HOME</code> 目录中服务器配置的模板。在整个说明中，我们将此文件称为“ configuration .yaml”文件。</li>
<li>创建 TLS CA 根签名证书文件 <code>ca-cert.pem</code>（如果它在 CA Home 目录中尚不存在）。这是自签名的根证书，这意味着它是由 TLS CA 本身生成和签名的，而不是来自其他来源。该证书是必须与要与组织中的任何节点进行交易的所有客户端共享的公用密钥。当任何客户端或节点向另一个节点提交事务时，它必须将此证书作为事务的一部分。</li>
<li>生成 CA 服务器私钥，并将其存储在 <code>/msp /keystore</code> 下的 <code>FABRIC_CA_HOME</code> 目录中。</li>
<li>初始化服务器的默认 SQLite 数据库，尽管您可以修改配置.yaml 文件中的数据库设置以使用您选择的支持的数据库。每次启动服务器时，它将从该数据库加载数据。如果您稍后切换到其他数据库（例如 PostgreSQL 或 MySQL ），并且配置 .yaml 文件的 <code>registry.identites</code> 部分中定义的身份在该数据库中不存在，则将对其进行注册。</li>
<li>将由 <code>-b</code> 标志参数 <code>&lt;ADMIN_USER&gt;</code> 和 <code>&lt;ADMIN_PWD&gt;</code> 指定的 CA 服务器管理员引导到服务器上。随后启动 CA 服务器时，将使用配置 .yaml 文件 <code>registry</code> 部分中提供的 admin 属性来注册 admin 用户。如果此 CA 将用于注册具有这些属性中任何一个的其他用户，则 CA 管理员用户需要拥有这些属性。换句话说，注册服务商必须具有 <code>hf.Registrar.Roles</code> 属性，然后才能使用这些属性中的任何一个注册另一个身份。因此，如果此 CA 管理员将用于注册中级 CA 的管理员身份，则即使该 CA 可能不是中级 CA 服务器，该 CA 管理员也必须将 <code>hf.IntermediateCA</code> 设置为 <code>true</code> 。默认设置已包含这些属性。</li>
</ul>
<p>重要说明：在配置 .yaml 文件中修改设置并重新启动服务器时，不会替换以前颁发的证书。如果要在启动服务器时重新生成证书，则需要删除它们并运行 <code>fabric-ca-server start</code> 命令。例如，如果在启动服务器后修改 <code>csr</code> 值，则需要删除以前生成的证书，然后运行 <code>fabric-ca-server start</code> 命令。但是请注意，当您使用新的签名证书和私钥重新启动 CA 服务器时，所有以前颁发的证书将不再能够通过 CA 进行身份验证。</p>
<h4 id="修改-TLS-CA-服务器配置">修改 TLS CA 服务器配置</h4>
<p>现在，您已经初始化了服务器，您可以根据生产 CA 服务器的清单，编辑生成的 <code>fabric-ca-server-config.yaml</code> 文件，以修改用例的默认配置设置。</p>
<p>至少应执行以下操作：</p>
<ul>
<li><code>port</code> - 输入要用于此服务器的端口。这些说明使用 7054 ，但是您可以选择端口。</li>
<li><code>tls.enabled</code> - 回忆默认配置文件中禁用了 TLS 。由于这是生产服务器，因此可以通过将该值设置为 <code>true</code> 来启用它。将此值设置为 <code>true</code> 会导致在下一步中启动服务器时生成 TLS 签名证书 <code>tls-cert.pem</code> 文件。 <code>tls-cert.pem</code> 是服务器在 TLS 握手期间将提供给客户端的证书，然后客户端将使用 TLS CA 的 <code>ca-cert.pem</code> 对其进行验证。</li>
<li><code>ca.name</code> - 通过编辑参数为 CA 命名，例如 <code>tls-ca</code> 。</li>
<li><code>csr.hosts</code> - 更新此参数以包括此服务器运行所在的主机名和 IP 地址（如果此文件中已存在的主机名和 IP 地址不同）。</li>
<li><code>signing.profiles.ca</code> - 由于这是不会颁发 CA 证书的 TLS CA ，因此可以删除“ ca 个人资料”部分。 <code>signing.profiles</code> 块应仅包含 <code>tls</code> 配置文件。</li>
<li><code>Operations.listenAddress:</code>-在不太可能的情况下，该主机和端口上正在运行另一个节点，那么您需要更新此参数以使用其他端口。</li>
</ul>
<h4 id="删除-TLS-CA-服务器证书">删除 TLS CA 服务器证书</h4>
<p>启动服务器之前，如果您修改了配置 .yaml 文件的 csr 块中的任何值，则需要删除 <code>fabric-ca-server-tls/ca-cert.pem</code> 文件和整个 fabric-ca-server <code>-tls/msp</code> 文件夹。在下一步中启动 CA 服务器时，将重新生成这些证书。</p>
<h4 id="启动-TLS-CA-服务器">启动 TLS CA 服务器</h4>
<p>运行以下命令以启动 CA 服务器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./fabric-ca-server start</span><br></pre></td></tr></table></figure>
<p>服务器成功启动后，您将看到类似以下内容的内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[INFO] Listening on https://0.0.0.0:7054</span><br></pre></td></tr></table></figure>
<p>因为您已启用 TLS 通信，所以请注意 TLS 签名证书 <code>tls-cert.pem</code> 文件是在 <code>FABRIC_CA_HOME</code> 位置下生成的。</p>
<p>提示：在 <code>init</code> 命令上设置的 CA <code>ADMIN_USER</code> 和 <code>ADMIN_PWD</code> 不能用 <code>start</code> 命令上的 <code>-b</code> 标志覆盖。当您需要修改 CA 管理员密码时，请使用 Fabric CA 客户端身份命令。</p>
<p>可选标志：</p>
<ul>
<li><code>-d</code> - 如果要在调试模式下运行服务器（这有助于问题诊断），则可以在启动命令中包括 <code>-d</code> 标志。但是，通常不建议在启用调试的情况下运行服务器，因为这将导致服务器性能降低。</li>
<li><code>-p</code> - 如果希望服务器在与配置 .yaml 文件中指定的端口不同的端口上运行，则可以覆盖现有端口。</li>
</ul>
<h4 id="使用-TLS-CA-注册引导程序用户">使用 TLS CA 注册引导程序用户</h4>
<p>既然已经配置了 TLS CA ，并且可以为组织部署任何其他节点，则需要注册 TLS CA 的引导（管理员）用户。由于 CA 服务器已启动并正在运行，因此现在不再使用 Fabric CA 服务器 CLI 命令，而是使用 Fabric CA 客户端 CLI 命令向服务器提交注册请求。</p>
<p>通过使用 Fabric CA 客户端执行，注册过程将用于生成形成节点身份的证书和私钥对。您应该已经在 Fabric CA 客户端部分中设置了所需的文件夹。</p>
<p>我们用于这些 Fabric CA 客户端命令的文件夹结构为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fabric-ca-client</span><br><span class="line">  └── tls-ca</span><br><span class="line">  └── tls-root-cert</span><br></pre></td></tr></table></figure>
<p>Fabric CA 客户端将这些文件夹用于：</p>
<ul>
<li>存储对 TLS CA 服务器运行 Fabric CA client enroll 命令以注册 TLS CA 引导程序标识时颁发的证书。 （ tls-ca 文件夹）</li>
<li>知道 TLS CA 根证书所在的位置，该证书允许 Fabric CA 客户端与 TLS CA 服务器进行通信。 （ tls-root-cert 文件夹）</li>
</ul>
<ol>
<li>
<p>将启动 TLS CA 服务器时生成的 TLS CA 根证书文件 <code>fabric-ca-server-tls/ca-cert.pem</code> 复制到 <code>fabric-ca-client/tls-root-cert/tls-ca- cert.pem</code> 文件夹。请注意，文件名已更改为 <code>tls-ca-cert.pem</code> ，以使其清楚这是来自 TLS CA 的根证书。重要说明： TLS CA 根证书必须在每个针对 TLS CA 运行命令的客户端系统上都可用。</p>
</li>
<li>
<p>Fabric CA 客户端还需要知道 Fabric CA 客户端二进制文件的位置。 <code>FABRIC_CA_CLIENT_HOME</code> 环境变量用于设置位置。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export FABRIC_CA_CLIENT_HOME=&lt;FULLY-QUALIFIED-PATH-TO-FABRIC-CA-BINARY&gt;</span><br></pre></td></tr></table></figure>
<p>例如，如果您位于 <code>fabric-ca-client</code> 文件夹中，则可以使用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export FABRIC_CA_CLIENT_HOME=$PWD</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>您已准备好使用 Fabric CA 客户端 CLI 注册 TLS CA 管理员用户。运行命令：</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./fabric-ca-client enroll -d -u https://&lt;ADMIN&gt;:&lt;ADMIN-PWD&gt;@&lt;CA-URL&gt;:&lt;PORT&gt; --tls.certfiles &lt;RELATIVE-PATH-TO-TLS-CERT&gt; --enrollment.profile tls --csr.hosts &#x27;&lt;CA_HOSTNAME&gt;&#x27; --mspdir tls-ca/tlsadmin/msp</span><br></pre></td></tr></table></figure>
<ul>
<li><code>&lt;ADMIN&gt;</code> - 使用 <code>init</code> 命令中指定的 TLS CA 管理员。</li>
<li><code>&lt;ADMIN-PWD&gt;</code> - 使用 <code>init</code> 命令中指定的 TLS CA 管理员密码。</li>
<li><code>&lt;CA-URL&gt;</code> - 使用在 TLS CA 配置.yaml 文件的 <code>csr</code> 部分中指定的主机名。</li>
<li><code>&lt;PORT&gt;</code> - 使用 TLS CA 正在侦听的端口。</li>
<li><code>&lt;RELATIVE-PATH-TO-TLS-CERT&gt;</code> - 带有从 TLS CA 复制的根 TLS 证书文件的路径和名称。此路径是相对于 <code>FABRIC_CA_CLIENT_HOME</code> 的。如果您遵循本教程中的文件夹结构，则为 <code>tls-root-cert/tls-ca-cert.pem</code> 。</li>
<li><code>&lt;CA_HOSTNAME&gt;</code> - 带有逗号分隔的证书名称的主机名列表。如果未指定，则使用 <code>fabric-ca-client-config.yaml</code> 中的默认值。您可以为域指定一个通配符。例如，当包含标志 <code>--csr.hosts'host1，*。example.com'</code> 时，意味着主机名 <code>host1</code> 以及 <code>example.com</code> 域中的任何主机均被识别。这些值将插入到生成的证书使用者备用名称（ SAN ）属性中。此处指定的值对应于您为 CA 服务器指定的 <code>csr.hosts</code> 参数。</li>
</ul>
<p>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./fabric-ca-client enroll -d -u https://tls-admin:tls-adminpw@my-machine.example.com:7054 --tls.certfiles tls-root-cert/tls-ca-cert.pem --enrollment.profile tls --csr.hosts &#x27;host1,*.example.com&#x27; --mspdir tls-ca/tlsadmin/msp</span><br></pre></td></tr></table></figure>
<p>在这种情况下， <code>-d</code> 参数以 DEBUG 模式运行客户端，这对于调试注册失败很有用。</p>
<p>请注意，在命令上使用了 <code>--mspdir</code> 标志，以指定在哪里存储由 enroll 命令生成的 TLS CA 管理员证书。</p>
<p>之所以指定 <code>--enrollment.profile tls</code> 标志，是因为我们正在针对 TLS CA 进行注册。使用此标志意味着注册是根据配置 .yaml 文件的 <code>signing</code> 部分中定义的 TLS 配置文件的 <code>usage</code> 和 <code>expiry</code> 设置执行的。**注意：**如果从 TLS CA 配置 .yaml 文件中删除了 <code>signing.profiles.ca</code> 块，则可以省略 <code>--enrollment.profile tls</code> 标志。</p>
<p>成功完成此命令后，将生成 <code>fabric-ca-client/tls-ca/tlsadmin/msp</code> 文件夹，其中包含 TLS CA 管理员身份的签名证书和私钥。如果 enroll 命令由于某种原因而失败，为了避免以后造成混淆，您应该在重新尝试 enroll 命令之前从 <code>fabric-ca-client/tls-ca/admin/msp/keystore</code> 文件夹中删除生成的私钥。当需要在 TLS CA 中注册其他身份时，我们将在以后引用此加密材料。</p>
<p>提示：从 Fabric CA 客户端发出此第一个 <code>enroll</code> 命令后，检查生成的 <code>fabric-ca-client/fabric-ca-client-config.yaml</code> 文件的内容，以熟悉 Fabric 使用的默认设置。 CA 客户端。因为我们使用单个 Fabric CA 客户端与多个 CA 服务器进行交互，所以我们需要在客户端 CLI 命令上使用 <code>-u</code> 标志来定位正确的 CA 服务器。 <code>--mspdir</code> 标志指示在 <code>register</code> 命令上使用的加密材料的位置，或在 <code>enroll</code> 命令上存储生成的证书的位置。</p>
<p>下图是您创建 TLS CA 服务器并使用 Fabric CA 客户端注册引导程序标识所执行的步骤的概念性摘要：</p>
<p><img src="../../../../assets/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/Fabric%20CA%E9%83%A8%E7%BD%B2%E8%BF%87%E7%A8%8B/92e199190128e0a4397f93fcc76cb491e1248f77d7d310f4c34729346f0bc047.png" alt="picture 1"></p>
<h4 id="使用-TLS-CA-注册并注册组织-CA-引导程序标识">使用 TLS CA 注册并注册组织 CA 引导程序标识</h4>
<p>TLS CA 服务器以引导程序身份启动，该身份具有服务器的完全管理员特权。管理员的关键能力之一是注册新身份的能力。组织中在网络上进行交易的每个节点都需要向 TLS CA 注册。因此，在设置组织 CA 之前，我们需要使用 TLS CA 来注册和注册组织 CA 引导程序标识，以获取其 TLS 证书和私钥。以下命令将组织 CA 引导程序身份 <code>rcaadmin</code> 和 <code>rcaadminpw</code> 注册到 TLS CA。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./fabric-ca-client register -d --id.name rcaadmin --id.secret rcaadminpw -u https://my-machine.example.com:7054  --tls.certfiles tls-root-cert/tls-ca-cert.pem --mspdir tls-ca/tlsadmin/msp</span><br></pre></td></tr></table></figure>
<p>请注意，命令上的 <code>--mspdir</code> 标志指向我们在上一步中生成的 TLS CA admin msp 证书的位置。需要使用这种加密材料才能向 TLS CA 注册其他用户。</p>
<p>接下来，我们需要注册 <code>rcaadmin</code> 用户以为该身份生成 TLS 证书。在这种情况下，我们在 enroll 命令上使用 <code>--mspdir</code> 标志来指定应为 <code>rcaadmin</code> 用户存储生成的组织 CA TLS 证书的位置。因为这些证书具有不同的身份，所以最佳做法是将它们放在自己的文件夹中。因此，我们将它们放置在 <code>tlsadmin</code> 文件夹旁边，而不是将它们放置在默认的 <code>msp</code> 文件夹中，而不是将其放置在名为 <code>rcaadmin</code> 的新文件夹中。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./fabric-ca-client enroll -d -u https://rcaadmin:rcaadminpw@my-machine.example.com:7054 --tls.certfiles tls-root-cert/tls-ca-cert.pem --enrollment.profile tls --csr.hosts <span class="string">&#x27;host1,*.example.com&#x27;</span> --mspdir tls-ca/rcaadmin/msp</span><br></pre></td></tr></table></figure>
<p>在这种情况下，<code>--mspdir</code> 标志的工作原理略有不同。对于 <code>enroll</code> 命令，<code>--mspdir</code> 标志指示将生成的证书用于 <code>rcaadmin</code> 身份的存储位置。</p>
<p>重要提示：组织 CA TLS 签名证书是在 <code>fabric-ca-client/tls-ca/rcaadmin/msp/signcert</code> 下生成的，私钥在 <code>fabric-ca-client/tls-ca/rcaadmin/msp/keystore</code> 下可用。部署组织 CA 时，您需要在 CA 配置 .yaml 文件的 <code>tls</code> 部分中指向这两个文件的位置。为了便于参考，您可以将 <code>keystore</code> 文件夹中的文件重命名为 <code>key.pem</code> 。</p>
<h4 id="（可选）使用-TLS-CA-注册并注册中级-CA-管理员">（可选）使用 TLS CA 注册并注册中级 CA 管理员</h4>
<p>同样，如果您计划拥有一个可以代表组织 CA 发行证书的中间 CA ，那么您现在也应该注册并注册该中间 CA 管理员用户。以下命令向 TLS CA 注册中间 CA 管理员 ID <code>icaadmin</code> 和 <code>icaadminpw</code> 。您可以使用选择的任何值作为身份名称和密码。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./fabric-ca-client register -d --id.name icaadmin --id.secret icaadminpw -u https://my-machine.example.com:7054  --tls.certfiles tls-root-cert/tls-ca-cert.pem --mspdir tls-ca/tlsadmin/msp</span><br></pre></td></tr></table></figure>
<p>同样，register 命令上的 <code>--mspdir</code> 标志指向 TLS CA admin msp 证书的位置，这些证书才能够向 TLS CA 注册其他用户。</p>
<p>现在也将是通过注册该用户为 <code>icaadmin</code> 用户生成中间 CA TLS 证书的好时机。对于 enroll 命令，我们使用 <code>--mspdir</code> 标志指定应为 <code>icaadmin</code> 用户存储生成的中间 CA TLS 证书的位置。在这种情况下，我们将它们放在 <code>tlsadmin</code> 文件夹旁边的新文件夹 <code>icaadmin/msp</code> 中。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./fabric-ca-client enroll -d -u https://icaadmin:icaadminpw@my-machine.example.com:7054 --tls.certfiles tls-root-cert/tls-ca-cert.pem --enrollment.profile tls --csr.hosts <span class="string">&#x27;host1,*.example.com&#x27;</span> --mspdir tls-ca/icaadmin/msp</span><br></pre></td></tr></table></figure>
<p>重要提示：中间 CA TLS 签名证书是在 <code>fabric-ca-client/tls-ca/icaadmin/signcert</code> 下生成的，私钥在 <code>fabric-ca-client/tls-ca/icaadmin/keystore</code> 下是可用的。部署中间 CA 时，您需要在中间 CA 配置 .yaml 文件的 <code>tls</code> 部分中引用这两个文件。为了便于参考，您可以将 <code>keystore</code> 文件夹中的文件重命名为 <code>key.pem</code> 。</p>
<p>产生的文件夹结构类似于：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fabric-ca-client</span><br><span class="line">  └── tls-ca</span><br><span class="line">    └── tlsadmin</span><br><span class="line">      └── msp</span><br><span class="line">    └── rcaadmin</span><br><span class="line">      └── msp</span><br><span class="line">    └── icaadmin</span><br><span class="line">      └── msp</span><br><span class="line">    └── tls-root-cert</span><br><span class="line">      └── tls-ca-cert.pem</span><br></pre></td></tr></table></figure>
<p>提示：在 TLS CA 中注册了所有节点之后，可以安全地关闭它。</p>
<h3 id="部署组织-CA">部署组织 CA</h3>
<p>部署过程概述描述了每个组织对组织 CA 和 TLS CA 的需求。 TLS CA 颁发 TLS 证书，以允许组织内进行安全交易。组织 CA （也称为“注册 CA ”或“ eCert CA ”）用于为组织颁发身份。您已经在上一组步骤中部署了 TLS CA ，现在我们准备部署组织 CA 。在本主题的稍后部分，您可以选择创建中间 CA 。因此，该 CA 成为该信任链中的“根 CA ”。</p>
<p>由于您已在上一步中使用 TLS CA 注册并注册了组织 CA 引导程序身份 <code>rcaadmin</code> ，因此您可以按照部署 TLS CA 时所使用的相同步骤模式来部署 CA 。</p>
<h4 id="在开始之前">在开始之前</h4>
<ul>
<li>将 Fabric CA 服务器二进制文件 <code>fabric-ca-server</code> 复制到计算机上的新目录。出于这些说明的目的，我们将二进制文件放入名为 <code>fabric-ca-server-org1</code> 的文件夹中。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> fabric-ca-server-org1</span><br></pre></td></tr></table></figure>
<p>现在，将 <code>fabric-ca-server</code> 二进制文件复制到此文件夹中。</p>
<ul>
<li>使用以下命令，将您在上一步中生成的组织 CA TLS 证书和密钥对复制到此 CA 服务器可以访问的位置，例如 <code>fabric-ca-server-org1/tls</code> 。这些是由 enroll 命令生成的 <code>fabric-ca-client/tls-ca/rcaadmin/msp/signcerts/cert.pem</code> 和 <code>fabric-ca-client/tls-ca/rcaadmin/msp/keystore/</code> 文件。<br>
注意：以下命令假定：
<ul>
<li>在 <code>fabric-ca-client/tls-ca/rcaadmin/msp/keystore/</code> 下生成的私钥已重命名为 <code>key.pem</code> 。</li>
<li><code>fabric-ca-client</code> 和 <code>fabric-ca-server-org1</code> 文件夹在文件结构中处于同一级别。</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> fabric-ca-server-org1</span><br><span class="line"><span class="built_in">mkdir</span> tls</span><br><span class="line"><span class="built_in">cp</span> ../fabric-ca-client/tls-ca/rcaadmin/msp/signcerts/cert.pem tls &amp;&amp; <span class="built_in">cp</span> ../fabric-ca-client/tls-ca/rcaadmin/msp/keystore/key.pem tls</span><br></pre></td></tr></table></figure>
<p>生成的文件夹结构类似于下图。（为清楚起见，一些文件夹和文件已被省略）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">fabric-ca-client</span><br><span class="line">  └── tls-ca</span><br><span class="line">        ├── rcaadmin</span><br><span class="line">          ├── msp</span><br><span class="line">             ├── IssuerPublicKey</span><br><span class="line">             ├── IssuerRevocationPublicKey</span><br><span class="line">             ├── cacerts</span><br><span class="line">             ├── keystore</span><br><span class="line">                 └── key.pem</span><br><span class="line">             ├── signcerts</span><br><span class="line">                 └── cert.pem</span><br><span class="line">fabric-ca-server-org1</span><br><span class="line">  └── tls</span><br><span class="line">    └── cert.pem</span><br><span class="line">    └── key.pem</span><br></pre></td></tr></table></figure>
<h4 id="初始化-CA-服务器">初始化 CA 服务器</h4>
<p>运行命令以初始化服务器，并为 CA 指定新的管理员用户 ID 和密码。我们使用在上一组步骤中向 TLS CA 注册的身份 <code>rcaadmin</code> 作为组织 CA 的引导身份。从 <code>fabric-ca-server-org1</code> 文件夹运行此命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./fabric-ca-server init -b &lt;ADMIN_USER&gt;:&lt;ADMIN_PWD&gt;</span><br></pre></td></tr></table></figure>
<p>例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./fabric-ca-server init -b rcaadmin:rcaadminpw</span><br></pre></td></tr></table></figure>
<h4 id="修改-CA-服务器配置">修改 CA 服务器配置</h4>
<p>与使用 TLS CA 一样，我们需要为组织 CA 编辑生成的 <code>fabric-ca-server-config.yaml</code> 文件，以根据生产 CA 服务器的清单修改您的用例的默认配置设置。</p>
<p>至少，您应该编辑以下字段：</p>
<ul>
<li><code>port</code> - 输入要用于此服务器的端口。这些说明使用 <code>7055</code> ，但您可以选择端口。</li>
<li><code>tls.enabled</code> - 通过将此值设置为 <code>true</code> 来启用 TLS。</li>
<li><code>tls.certfile</code> 和 <code>tls.keystore</code> - 输入在 TLS CA 中注册该 CA 的引导管理员时生成的 TLS CA 签名证书和私钥的相对路径和文件名。签名证书 <code>cert.pem</code> 是使用 Fabric CA 客户端生成的，可以在 <code>fabric-ca-client/tls-ca/rcaadmin/msp/signcerts/cert.pem</code> 下找到。私钥位于 <code>fabric-ca-client/tls-ca/rcaadmin/msp/keystore</code> 下。指定的路径名 ​​ 是相对于 <code>FABRIC_CA_CLIENT_HOME</code> 的，因此，如果您遵循这些说明中使用的文件夹结构，则只需为 <code>tls.certfile</code> 指定 <code>tls/cert.pem</code> ，为 <code>tls.keystore</code> 定 <code>tls/key.pem</code> 。指定标准路径名。</li>
<li><code>ca.name</code> - 通过在此参数中指定值来为组织 CA 命名，例如 <code>org1-ca</code> 。</li>
<li><code>csr.hosts</code> - 更新此参数以包含此服务器运行所在的主机名和 IP 地址（如果该文件与文件中已有的名称不同）。</li>
<li><code>Operations.listenAddress:</code> - 如果此主机上正在运行另一个 CA ，则需要更新此参数以使用其他端口。</li>
<li><code>csr.ca.pathlength</code> ：此字段用于限制 CA 证书层次结构。根 CA 将此值设置为 1 意味着根 CA 可以颁发中间 CA 证书，但是这些中间 CA 不能依次颁发其他 CA 证书。换句话说，中间 CA 无法注册其他中间 CA ，但可以为用户颁发注册证书。默认值为 1。</li>
<li><code>signing.profiles.ca.caconstraint.maxpathlen</code> - 此字段表示证书链中可以跟随此证书的非自发行中间证书的最大数量。如果这将是中间 CA 的父服务器，并且您希望该中间 CA 充当另一个中间 CA 的父 CA ，则此根 CA 需要在配置 .yaml 文件中将此值设置为大于 0。请参阅“签名”部分的说明。默认值为 0。</li>
<li><code>Operations.listenAddress:</code> - 在不太可能的情况下，该主机和端口上正在运行另一个节点，则需要更新此参数以使用其他端口。</li>
</ul>
<h4 id="删除-CA-服务器证书">删除 CA 服务器证书</h4>
<p>启动服务器之前，如果您修改了配置 .yaml 文件的 <code>csr</code> 块中的任何值，则需要删除 <code>fabric-ca-server-org1/ca-cert.pem</code> 文件和整个 <code>fabric-ca-server-org1/msp</code> 文件夹。在下一步中启动 CA 服务器时，将根据配置 .yaml 文件中的新设置重新生成这些证书。</p>
<h4 id="启动-CA-服务器">启动 CA 服务器</h4>
<p>运行以下命令以启动 CA 服务器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./fabric-ca-server start</span><br></pre></td></tr></table></figure>
<h4 id="注册-CA-管理员">注册 CA 管理员</h4>
<p>部署 CA 的最后一步是注册 CA 管理员引导程序身份，该身份会生成节点签名的证书和私钥。密钥对是此管理员身份所必需的，以便能够注册其他身份。同样，我们将使用 Fabric CA 客户端 CLI 来注册管理员。您应该已经在 Fabric CA 客户端部分中设置了所需的文件夹。</p>
<p>我们用于这些命令的文件夹结构是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fabric-ca-client</span><br><span class="line">  └── org1-ca</span><br><span class="line">  └── tls-root-cert</span><br></pre></td></tr></table></figure>
<p>Fabric CA 客户端将这些文件夹用于：</p>
<ul>
<li>存储对 TLS CA 服务器运行 Fabric CA 客户端注册命令时颁发的证书。（org1-ca 文件夹）</li>
<li>知道 TLS 证书位于的位置，该证书允许 Fabric CA 客户端与 TLS CA 服务器进行通信。（tls-root-cert 文件夹）</li>
</ul>
<ol>
<li>
<p>以前使用 Fabric CA 客户端为 TLS CA 生成证书时，您指定了 <code>FABRIC_CA_CLIENT_HOME</code> 的值。假设仍然设置，则可以继续执行下一步。否则，您应该在 Fabric CA 客户端二进制文件所在的目录中，并运行以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> FABRIC_CA_CLIENT_HOME=<span class="variable">$PWD</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>现在，您可以使用 Fabric CA 客户端生成 CA 管理员证书和私钥。您需要此证书和私钥才能使用此 CA 颁发身份。我们在 enroll 命令上使用 <code>--mspdir</code> 标志来指定将生成的证书存储在何处。运行命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./fabric-ca-client enroll -d -u https://&lt;ADMIN&gt;:&lt;ADMIN-PWD&gt;@&lt;CA-URL&gt;:&lt;PORT&gt; --tls.certfiles &lt;RELATIVE-PATH-TO-TLS-CERT&gt; --csr.hosts <span class="string">&#x27;&lt;CA_HOSTNAME&gt;&#x27;</span> --mspdir org1-ca/rcaadmin/msp</span><br></pre></td></tr></table></figure>
<ul>
<li><code>&lt;ADMIN&gt;</code> - 使用 <code>init</code> 命令中指定的组织 CA admin 。</li>
<li><code>&lt;ADMIN-PWD&gt;</code> - 使用 <code>init</code> 命令中指定的组织 CA 管理员密码。</li>
<li><code>&lt;CA-URL&gt;</code> - 使用在组织 CA 配置.yaml 文件的 <code>csr</code> 部分中指定的主机名。</li>
<li><code>&lt;PORT&gt;</code> - 使用组织 CA 正在侦听的端口。</li>
<li><code>&lt;RELATIVE-PATH-TO-TLS-CERT&gt;</code> - 包含从 TLS CA 复制的 tls-ca-cert.pem 文件的路径。这是相对于 <code>FABRIC_CA_CLIENT_HOME</code> 的路径。</li>
<li><code>&lt;CA_HOSTNAME&gt;</code> - 带有逗号分隔的证书名称的主机名列表。如果未指定，则使用 <code>fabric-ca-client-config.yaml</code> 中的默认值。如果主机名是动态的，则可以为域指定通配符。例如，当包含标志 <code>--csr.hosts 'host1,*.example.com'</code> 时，意味着主机名 <code>host1</code> 以及 <code>example.com</code> 域中的任何主机均被识别。</li>
</ul>
<p>在这种情况下， <code>-d</code> 参数以 DEBUG 模式运行客户机，这对于调试命令失败很有用。</p>
<p>例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./fabric-ca-client enroll -d -u https://rcaadmin:rcaadminpw@my-machine.example.com:7055 --tls.certfiles tls-root-cert/tls-ca-cert.pem --csr.hosts <span class="string">&#x27;host1,*.example.com&#x27;</span> --mspdir org1-ca/rcaadmin/msp</span><br></pre></td></tr></table></figure>
<p>运行此命令时，enroll 命令将创建 <code>fabric-ca-client/org1-ca/rcaadmin/msp</code> 文件夹，其中包含组织 CA 的签名证书和私钥，其外观类似于：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">└── msp</span><br><span class="line">    ├── cacerts</span><br><span class="line">        └── my-machine-example-com-7055.pem</span><br><span class="line">    ├── keystore</span><br><span class="line">        └── 60b6a16b8b5ba3fc3113c522cce86a724d7eb92d6c3961cfd9afbd27bf11c37f_sk</span><br><span class="line">    ├── signcerts</span><br><span class="line">        └── cert.pem</span><br><span class="line">    ├── user</span><br><span class="line">    ├── IssuerPublicKey</span><br><span class="line">    └── IssuerRevocationPublicKey</span><br></pre></td></tr></table></figure>
<p>位置：</p>
<ul>
<li><code>my-machine-example-com-7055.pem</code> 是组织 CA 根证书。</li>
<li><code>60b6a16b8b5ba3fc3113c522cce86a724d7eb92d6c3961cfd9afbd27bf11c37f_sk</code> 是组- 织 CA 管理员身份的私钥。此密钥需要受到保护，不应与任何人共享。需要能够在此 CA 中注册- 和注册其他身份。可以将这个文件重命名为更易于引用的名称，例如 <code>org1-key.pem</code> 。</li>
<li><code>cert.pem</code> 是 CA 管理员身份签名的证书。</li>
</ul>
</li>
<li>
<p>（可选）向组织（根）CA 注册中间 CA 引导程序标识。</p>
</li>
</ol>
<p>如果计划部署中间 CA ，则必须向其根 CA 注册中间 CA 引导程序标识，以形成信任链。回想一下，您已经在 TLS CA 中注册了 <code>icaadmin</code> 身份。您还需要在（根）组织 CA 中注册相同的身份。并且由于这将是中间 CA ，因此必须包含 <code>hf.IntermediateCA = true</code> 属性。（从在上一步中注册组织 CA admin 的同一终端窗口中运行此命令。）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./fabric-ca-client register -u https://my-machine.example.com:7055  --id.name icaadmin --id.secret icaadminpw --id.attrs <span class="string">&#x27;&quot;hf.Registrar.Roles=user,admin&quot;,&quot;hf.Revoker=true&quot;,&quot;hf.IntermediateCA=true&quot;&#x27;</span> --tls.certfiles tls-root-cert/tls-ca-cert.pem --mspdir org1-ca/rcaadmin/msp</span><br></pre></td></tr></table></figure>
<p>register 命令上的 <code>--mspdir</code> 标志指向我们在上一步中注册的组织 CA admin 的加密材料，并被授权注册新用户。我们不会在组织 CA 中注册 <code>icaadmin</code> 身份。相反，此中间 CA 管理员身份稍后将针对中间 CA 进行注册。</p>
<h3 id="（可选）部署中间-CA">（可选）部署中间 CA</h3>
<p>中间 CA 与组织根 CA 形成信任链，可用于将特定组织的注册请求定向到单个 CA ，以及通过关闭根 CA 来保护信任根。因此，当使用中间 CA 来处理所有注册请求时，可以关闭根 CA 。</p>
<p>注意：本节假定您已经在 TLS CA 和上级组织 CA 中注册并注册了 <code>icaadmin</code> 身份（本节之前的第 3 步）。</p>
<p>在你开始之前</p>
<ul>
<li>将 Fabric CA 服务器二进制 <code>fabric-ca-server</code> 复制到计算机上的新目录。出于这些说明的目的，我们将二进制文件放入其自己的名为 <code>fabric-ca-server-int-ca</code>的文件夹中。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> fabric-ca-server-int-ca</span><br></pre></td></tr></table></figure>
<p>将 <code>fabric-ca-server</code> 二进制文件复制到此文件夹中。</p>
<ul>
<li>
<p>使用以下命令将在上一步中生成的 CA admin TLS 证书和密钥对复制到此 CA 服务器可以访问的位置，例如 <code>fabric-ca-server-int-ca/tls</code> 。这些是由 enroll 命令生成的 <code>fabric-ca-client/tls-ca/icaadmin/msp/signcerts/cert.pem</code> 和 <code>fabric-ca-client/tls-ca/icaadmin/msp/keystore/</code> 文件。<br>
注意：以下命令假定：</p>
<ul>
<li>在 <code>fabric-ca-client/tls-ca/icaadmin/keystore/</code> 下生成的私钥被重命名为 <code>key.pem</code> 。</li>
<li><code>fabric-ca-client</code> 和 <code>fabric-ca-server-int-ca</code> 文件夹在文件结构中处于同一级别。</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> fabric-ca-server-int-ca</span><br><span class="line"><span class="built_in">mkdir</span> tls</span><br><span class="line"><span class="built_in">cp</span> ../fabric-ca-client/tls-ca/icaadmin/msp/signcerts/cert.pem tls &amp;&amp; <span class="built_in">cp</span> ../fabric-ca-client/tls-ca/icaadmin/msp/keystore/key.pem tls</span><br></pre></td></tr></table></figure>
<ul>
<li>因为启用了 TLS 通信，所以中间 CA 需要 TLS CA 根证书才能与上级组织 CA 安全通信。因此，您需要将初始化 TLS CA 服务器时生成的 <code>fabric-ca-server-tls/ca-cert.pem</code> 复到 <code>tls</code> 文件夹。请注意，文件名已更改为 <code>tls-ca-cert.pem</code> ，以使其清楚这是来自 TLS CA 的根证书。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> ../fabric-ca-server-tls/ca-cert.pem tls/tls-ca-cert.pem</span><br></pre></td></tr></table></figure>
<p>生成的文件夹结构类似于以下结构。（为清楚起见，一些文件夹和文件已被省略）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">fabric-ca-client</span><br><span class="line">  └── tls-ca</span><br><span class="line">        ├── icaadmin</span><br><span class="line">          ├── msp</span><br><span class="line">             ├── cacerts</span><br><span class="line">             ├── keystore</span><br><span class="line">                 └── key.pem</span><br><span class="line">             ├── signcerts</span><br><span class="line">                 └── cert.pem</span><br><span class="line">             ├── tlscacerts</span><br><span class="line">             ├── user</span><br><span class="line">             ├── IssuerPublicKey</span><br><span class="line">             └── IssuerRevocationPublicKey</span><br><span class="line">fabric-ca-server-int-ca</span><br><span class="line">  └── tls</span><br><span class="line">    └── tls-ca-cert.pem</span><br><span class="line">    └── cert.pem</span><br><span class="line">    └── key.pem</span><br></pre></td></tr></table></figure>
<p>因为您已经部署了父组织（根） CA ，所以可以使用以下步骤来创建中间 CA：</p>
<ol>
<li>
<p>在中间 CA 主目录中，通过运行 <code>init</code> 命令并引导您已经在 TLS CA 和父组织 CA 中注册的 <code>icaadmin</code> id 来初始化 CA 。<br>
例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./fabric-ca-server init -b icaadmin:icaadminpw</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>修改 <code>fabric-ca-server-config.yaml</code> 文件。</p>
</li>
</ol>
<p>未完。。。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/05/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/MSP%E6%88%90%E5%91%98%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E8%80%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/05/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/MSP%E6%88%90%E5%91%98%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E8%80%85/" class="post-title-link" itemprop="url">MSP 成员服务提供者</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-05 00:00:00" itemprop="dateCreated datePublished" datetime="2021-04-05T00:00:00+08:00">2021-04-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-02-01 01:54:07" itemprop="dateModified" datetime="2025-02-01T01:54:07+08:00">2025-02-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/" itemprop="url" rel="index"><span itemprop="name">article</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">计算机</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%8C%BA%E5%9D%97%E9%93%BE/" itemprop="url" rel="index"><span itemprop="name">区块链</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/" itemprop="url" rel="index"><span itemprop="name">Hyperledger Fabric</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="MSP-成员服务提供者">MSP 成员服务提供者</h2>
<h3 id="简介">简介</h3>
<p>MSP（成员服务提供者）是一种机制，他为区块链网络内的组织成员提供身份认证的功能。因为 Fabric 是一个认证性的网络，网络中的通信和交易是建立在可信身份的基础上的。他让用户不用暴露自己的私钥而能够让网络中的成员识别他的身份。</p>
<p>具体来说，用户要想加入一个网络进行交易，需要满足以下条件：</p>
<ol>
<li>拥有被信任的 CA 颁发的身份；</li>
<li>成为一个被网络成员认可和认可的 组织 的成员。MSP 将身份与组织的成员资格联系在一起。成员资格是通过将成员的公钥(也称为证书、签名证书或签证)添加到组织的 MSP 来实现的。</li>
<li>将 MSP 添加到网络上的一个联盟 或者通道。</li>
<li>确保 MSP 包括在网络中的<a target="_blank" rel="noopener" href="https://hyperledger-fabric.readthedocs.io/zh_CN/release-2.2/policies/policies.html">策略</a>定义。</li>
</ol>
<h3 id="MSP-域">MSP 域</h3>
<p>网络中， MSP 出现在两个位置：</p>
<ul>
<li>在参与者节点本地（<strong>本地 MSP</strong>）</li>
<li>在通道配置中（<strong>通道 MSP</strong>）</li>
</ul>
<p>它们的使用范围不同，每个 MSP 列出特定管理级别上的角色和权限。</p>
<h4 id="本地-MSP">本地 MSP</h4>
<p>本地 MSP 是为<strong>客户端</strong>和<strong>节点</strong>( peer 节点和排序节点)定义的。 本地 MSPs 定义节点的权限(例如，谁是可以操作节点的 peer 节点管理员)。客户端的本地 MSP ，允许用户作为一个通道成员或作为一个特定角色的所有者，如组织管理者，在其交易(如链码交易)时进行身份验证从而进入系统，例如，进行配置交易。</p>
<p><strong>每个节点都必须定义一个本地 MSP</strong>，因为它定义了在该级别上谁拥有管理权或参与权( peer 节点管理员不一定是通道管理员，反之亦然)。这允许在通道上下文之外对成员消息进行身份验证，并定义特定节点(例如，能够在 peer 节点上安装链码的节点)的权限。请注意，一个组织可以拥有一个或多个节点。 MSP 定义了组织管理员。组织、组织的管理员、节点的管理员以及节点本身都应该具有相同的信任根。</p>
<p>排序节点的本地 MSP 也在节点的文件系统上定义，并且只应用于该节点。与 peer 节点一样，排序节点也由单个组织拥有，因此有一个 MSP 来列出它信任的参与者角色或节点。</p>
<h4 id="通道-MSP">通道 MSP</h4>
<p>通道 MSP 在通道层面上定义了管理权和参与权。应用程序通道上的 peer 节点和排序节点共用通道 MSP 的相同视图，因此能够正确地对通道参与者进行身份验证。这意味着，如果组织希望加入通道，则需要在通道配置中添加包含组织成员信任链的 MSP。否则，来自该组织身份的交易将被拒绝。本地 MSP 表现为<strong>文件系统上的文件夹结构</strong>，而通道 MSP 则<strong>在通道配置中被描述</strong>。</p>
<p>通道 MSP 识别谁在通道层次拥有权限。通道 MSP 定义通道成员(本身是 MSP )的身份和通道级策略的执行之间的 关系 。通道 MSP 包含通道成员组织的 MSP 。</p>
<p>每个参与通道的组织都必须为其定义一个 MSP。</p>
<p>系统通道 MSP 包括参与排序服务的所有组织的 MSP。</p>
<ul>
<li>本地 MSP 仅在其应用的节点或用户的文件系统上定义。每个节点只有一个本地 MSP；</li>
<li>由于通道 MSP 对通道内的所有节点都可用，它们在通道配置中逻辑上仅定义一次，而通道 MSP 也在通道中的每个节点的文件系统上实例化，并通过共识保持同步；</li>
</ul>
<p><img src="../../../../assets/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/MSP%E6%88%90%E5%91%98%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E8%80%85/42c2719412b013108ddd074bac2351aed145979e59286659dbd0444252014d0f.png" alt="picture 2"></p>
<h3 id="组织和-MSP">组织和 MSP</h3>
<p>组织可以作为 MSP 的身份标识，像用户组一样管理组织成员。同时，一个组织也可以被划分为多个<strong>组织单元( ou )</strong>，每个单元有一定职责（ <code>affiliations</code> ）。例如，组织 <code>Org1</code> 可能同时拥有 <code>org1.Manufacturing</code> 和 <code>org1.Distribution</code> 组织单元，这两个组织单元反映了互相隔离的流水线。这样使用组织单元可以让策略的定义更简单，在组织内部实现更细粒度的访问控制。或者使用基于属性进行访问控制的智能合约。 <code>OU</code> 字段是可选的，如果不使用 MSP 中的所有身份都被 CA 视为组织成员。</p>
<h5 id="节点组织单元和-MSP">节点组织单元和 MSP</h5>
<p>一类特殊的组织单元，有时也被称为<strong>节点组织单元</strong>，用于为角色赋予身份。这些节点组织单元被定义在 <code>FABRIC_CFG_PATH/msp/config.yaml</code> 配置文件中。这些单元成员被认为是 MSP 所代表的组织的一部分，通过节点组织单元，您可以实现更细粒度的背书策略，该策略要求 Org1 的 peer 节点(而不是 Org1 的任何成员)为交易背书。</p>
<p>例如我们可以这样定义节点组织单元：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">NodeOUs:</span></span><br><span class="line">  <span class="attr">Enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">ClientOUIdentifier:</span></span><br><span class="line">    <span class="attr">Certificate:</span> <span class="string">cacerts/ca.sampleorg-cert.pem</span></span><br><span class="line">    <span class="attr">OrganizationalUnitIdentifier:</span> <span class="string">client</span></span><br><span class="line">  <span class="attr">PeerOUIdentifier:</span></span><br><span class="line">    <span class="attr">Certificate:</span> <span class="string">cacerts/ca.sampleorg-cert.pem</span></span><br><span class="line">    <span class="attr">OrganizationalUnitIdentifier:</span> <span class="string">peer</span></span><br><span class="line">  <span class="attr">AdminOUIdentifier:</span></span><br><span class="line">    <span class="attr">Certificate:</span> <span class="string">cacerts/ca.sampleorg-cert.pem</span></span><br><span class="line">    <span class="attr">OrganizationalUnitIdentifier:</span> <span class="string">admin</span></span><br><span class="line">  <span class="attr">OrdererOUIdentifier:</span></span><br><span class="line">    <span class="attr">Certificate:</span> <span class="string">cacerts/ca.sampleorg-cert.pem</span></span><br><span class="line">    <span class="attr">OrganizationalUnitIdentifier:</span> <span class="string">orderer</span></span><br></pre></td></tr></table></figure>
<p>以上代码定义了四个节点组织单元：</p>
<ul>
<li>client</li>
<li>peer</li>
<li>admin</li>
<li>orderer</li>
</ul>
<p>经过上述配置，当使用 Fabric CA 或 SDK 注册带有 CA 的用户时，这些角色和 <code>OU</code> 属性会被分配给一个身份标识。随后 <code>enroll</code> 用户命令会在用户的 <code>/msp</code> 文件夹中生成证书。</p>
<p><img src="../../../../assets/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/MSP%E6%88%90%E5%91%98%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E8%80%85/e905af5fd5cacc68043ed9b7fe374adb2685be11bcbca4f4b16b8874a981911e.png" alt="picture 3"></p>
<p>生成的角色和 OU 属性在位于 <code>/signcerts</code> 文件夹中的 X.509 签名证书中可见。 <code>ROLE</code> 属性被标识为 <code>hf.Type</code> ，其指的是参与者在其组织中的角色(例如，指定参与者是一个 <code>peer</code> 节点)。请参阅以下来自签名证书的代码片段，它显示了角色和 ou 在证书中是如何表示的。</p>
<p><img src="../../../../assets/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/MSP%E6%88%90%E5%91%98%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E8%80%85/78c16733d6209be583fbf1273cae814c7200f2ef12448c310f727310fc1a82df.png" alt="picture 4"></p>
<p>另外，节点是否有权管理特定资源，还要看实际分配权力的 <strong>策略</strong> 如何编写，如果策略要求持有 <code>Org1.Manufaturing</code> msp 的管理者（即 <code>admin</code> 角色）才有权向通道添加新的组织，那么单单持有其中一个 msp 是无权限的。</p>
<h3 id="MSP-结构">MSP 结构</h3>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/04/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/%E6%9B%B2%E5%86%B0%E7%9A%84%E7%BD%91%E7%BB%9C%E5%90%AF%E5%8A%A8%E8%84%9A%E6%9C%AC%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/04/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/%E6%9B%B2%E5%86%B0%E7%9A%84%E7%BD%91%E7%BB%9C%E5%90%AF%E5%8A%A8%E8%84%9A%E6%9C%AC%E8%AF%A6%E8%A7%A3/" class="post-title-link" itemprop="url">曲冰的网络启动脚本详解</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-04 00:00:00" itemprop="dateCreated datePublished" datetime="2021-04-04T00:00:00+08:00">2021-04-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-02-01 01:54:07" itemprop="dateModified" datetime="2025-02-01T01:54:07+08:00">2025-02-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/" itemprop="url" rel="index"><span itemprop="name">article</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">计算机</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%8C%BA%E5%9D%97%E9%93%BE/" itemprop="url" rel="index"><span itemprop="name">区块链</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/" itemprop="url" rel="index"><span itemprop="name">Hyperledger Fabric</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="曲冰的网络启动脚本详解">曲冰的网络启动脚本详解</h2>
<h3 id="环境准备">环境准备</h3>
<h4 id="工具包">工具包</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt-get install -y apt-transport-https ca-certificates software-properties-common</span><br><span class="line"><span class="built_in">sudo</span> apt-get install -y unzip git  curl wget vim tree jq</span><br></pre></td></tr></table></figure>
<h4 id="gradle">gradle</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /tmp &amp;&amp; wget https://services.gradle.org/distributions/gradle-6.4-bin.zip</span><br><span class="line">unzip gradle-6.4-bin.zip</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mv</span> gradle-6.4 /usr/local/gradle</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">cat</span> &gt;&gt; ~/.bashrc &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string"># setup gradle environments</span></span><br><span class="line"><span class="string"># =====================</span></span><br><span class="line"><span class="string">export PATH=$PATH:/usr/local/gradle/bin</span></span><br><span class="line"><span class="string"># =====================</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure>
<h4 id="docker">docker</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># import docker repository</span></span><br><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | <span class="built_in">sudo</span> apt-key add -</span><br><span class="line"><span class="built_in">sudo</span> add-apt-repository \</span><br><span class="line"><span class="string">&quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu \</span></span><br><span class="line"><span class="string"><span class="subst">$(lsb_release -cs)</span> stable&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># update repository index &amp; install docker-ce</span></span><br><span class="line"><span class="built_in">sudo</span> apt-get update &amp; <span class="built_in">sudo</span> apt-get install -y docker-ce</span><br><span class="line"></span><br><span class="line"><span class="comment"># check docker version</span></span><br><span class="line">docker -v</span><br><span class="line"><span class="comment"># check docker image list (only root can use docker by default)</span></span><br><span class="line">docker images</span><br><span class="line"><span class="comment"># enable  current user to use docker (!!! need to re-login via terminal !!!)</span></span><br><span class="line"><span class="built_in">sudo</span> gpasswd -a <span class="variable">$&#123;USER&#125;</span> docker</span><br><span class="line"><span class="comment"># check docker image list</span></span><br><span class="line">docker images</span><br><span class="line"><span class="comment"># 这里添加的镜像需要去 docker_practice 项目中看看镜像的可用性</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">cat</span> &gt;&gt; /etc/docker/daemon.json &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    &quot;registry-mirrors&quot;: [&quot;https://registry.docker-cn.com&quot;]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl daemon-reload</span><br><span class="line"><span class="built_in">sudo</span> systemctl restart docker</span><br></pre></td></tr></table></figure>
<h5 id="下载-Fabric-的相关镜像">下载 Fabric 的相关镜像</h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># image of ca</span></span><br><span class="line">docker pull hyperledger/fabric-ca:1.4.6</span><br><span class="line"><span class="comment"># image of peer</span></span><br><span class="line">docker pull hyperledger/fabric-peer:2.1.0</span><br><span class="line"><span class="comment"># image of orderer</span></span><br><span class="line">docker pull hyperledger/fabric-orderer:2.1.0</span><br><span class="line"><span class="comment"># image of tools &amp; utilities</span></span><br><span class="line">docker pull hyperledger/fabric-tools:2.1.0</span><br><span class="line"><span class="comment"># image of Chaincode deployment for Programming Languages (Go | Java | Node.JS)</span></span><br><span class="line">docker pull hyperledger/fabric-ccenv:2.1.0</span><br><span class="line">docker pull hyperledger/fabric-javaenv:2.1.0</span><br><span class="line">docker pull hyperledger/fabric-nodeenv:2.1.0</span><br><span class="line"><span class="comment"># image of Base-OS of Chaincode runtime</span></span><br><span class="line">docker pull hyperledger/fabric-baseos:0.4.20</span><br><span class="line"><span class="comment"># image of coucddb (one NOSQL DB for ledger state)</span></span><br><span class="line">docker pull hyperledger/fabric-couchdb:0.4.20</span><br><span class="line"></span><br><span class="line"><span class="comment"># check image list to validate downloading</span></span><br><span class="line">docker images</span><br></pre></td></tr></table></figure>
<h5 id="docker-compose">docker-compose</h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># download</span></span><br><span class="line"><span class="comment">#wget https://github.com/docker/compose/releases/download/1.25.3/docker-compose-`uname -s`-`uname -m`</span></span><br><span class="line"><span class="comment">#wget https://get.daocloud.io/docker/compose/releases/download/1.25.3/docker-compose-`uname -s`-`uname -m`</span></span><br><span class="line"><span class="comment"># 自己选择来源，那个快选哪个</span></span><br><span class="line">wget https://blockchain-files.s3.cn-northwest-1.amazonaws.com.cn/docker-compose-`<span class="built_in">uname</span> -s`-`<span class="built_in">uname</span> -m`</span><br><span class="line"><span class="comment"># copy to ` /usr/local/bin/ ` and rename</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mv</span> docker-compose-`<span class="built_in">uname</span> -s`-`<span class="built_in">uname</span> -m` /usr/local/bin/docker-compose</span><br><span class="line"><span class="comment"># make executable</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> +x /usr/local/bin/docker-compose</span><br><span class="line"><span class="comment"># validate installation</span></span><br><span class="line">docker-compose -v</span><br></pre></td></tr></table></figure>
<h5 id="编程语言-SDK">编程语言 SDK</h5>
<ul>
<li>GO</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /tmp &amp;&amp; wget https://dl.google.com/go/go1.13.4.linux-amd64.tar.gz</span><br><span class="line"><span class="built_in">sudo</span> tar -C /usr/local -xzf go1.13.4.linux-amd64.tar.gz</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">cat</span> &gt;&gt; ~/.bashrc &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string"># setup go environments</span></span><br><span class="line"><span class="string"># =====================</span></span><br><span class="line"><span class="string">export PATH=$PATH:/usr/local/go/bin</span></span><br><span class="line"><span class="string">export GOPATH=$HOME/gopath</span></span><br><span class="line"><span class="string">export GO111MODULE=on</span></span><br><span class="line"><span class="string">export GOPROXY=https://goproxy.cn</span></span><br><span class="line"><span class="string"># =====================</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line">go version</span><br></pre></td></tr></table></figure>
<ul>
<li>Java</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install Java</span></span><br><span class="line"><span class="built_in">sudo</span> apt-get update</span><br><span class="line"><span class="built_in">sudo</span> apt-get install -y openjdk-8-jdk</span><br><span class="line">java -version</span><br></pre></td></tr></table></figure>
<ul>
<li>node.js</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install `nvm`</span></span><br><span class="line">curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.3/install.sh | bash</span><br><span class="line"><span class="comment"># validate installation of `nvm`</span></span><br><span class="line">nvm --version</span><br><span class="line"><span class="comment"># install Node.JS version 10</span></span><br><span class="line">nvm install 10</span><br><span class="line"><span class="comment"># check the version of Node.JS and NPM</span></span><br><span class="line">node -v</span><br><span class="line">npm -v</span><br></pre></td></tr></table></figure>
<h4 id="下载曲冰脚本的工作环境">下载曲冰脚本的工作环境</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://gitlab.com/qubing/blockchain_lab_v2.git ~/workspace</span><br></pre></td></tr></table></figure>
<h3 id="搭建网络">搭建网络</h3>
<p>这部执行了四个脚本：</p>
<ul>
<li><code>./setup.sh</code> ：用于下载 Fabric 和 Fabric CA 二进制文件以及网络相关的组件镜像，比如 Peer ， Orderer ， baseos 等等</li>
<li><code>. ./init.sh</code> ：这个脚本用于初始化网络；
<ul>
<li>把三个 CA 服务的的目标挂载路径先配置好，把 CA 的配置文件先放到对应的位置；</li>
<li>注册 Peer 和 Orderer 节点到 CA 上；</li>
<li>创建创世区块；</li>
<li>启动 Peer 和 Orderer 节点；</li>
<li>创建并将节点加入到通道中；</li>
<li>生成连接的配置文件；</li>
</ul>
</li>
<li><code>. script/deploy_chaincode.sh</code> ：通过链码的生命周期管理机制，将链码安装到链上；</li>
<li><code>. scripts/test_example.sh</code> ：通过 CLI 调用链码，测试链码返回结果；</li>
</ul>
<h4 id="setup-sh"><code>. ./setup.sh</code></h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">WORK_PATH=<span class="variable">$PWD</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> FABRIC_VERSION=2.3.0</span><br><span class="line"><span class="built_in">export</span> CA_VERSION=1.4.9</span><br><span class="line"><span class="built_in">export</span> DB_VERSION=3.1.1</span><br><span class="line">DOCKER_NS=hyperledger</span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> == <span class="string">&quot;docker&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Pulling Docker Images&quot;</span></span><br><span class="line">  <span class="comment"># Fabric-CA image</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Pulling <span class="variable">$&#123;DOCKER_NS&#125;</span>/fabric-ca:<span class="variable">$&#123;CA_VERSION&#125;</span>&quot;</span></span><br><span class="line">  docker pull <span class="variable">$&#123;DOCKER_NS&#125;</span>/fabric-ca:<span class="variable">$&#123;CA_VERSION&#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Fabric images</span></span><br><span class="line">  <span class="comment"># peer</span></span><br><span class="line">  <span class="comment"># orderer</span></span><br><span class="line">  <span class="comment"># tools</span></span><br><span class="line">  <span class="comment"># ccenv, javaenv, nodeenv （可选）</span></span><br><span class="line">  <span class="comment"># baseos</span></span><br><span class="line">  FABRIC_IMAGES=(fabric-peer fabric-orderer fabric-tools fabric-ccenv fabric-javaenv fabric-nodeenv fabric-baseos)</span><br><span class="line">  <span class="keyword">for</span> image <span class="keyword">in</span> <span class="variable">$&#123;FABRIC_IMAGES[@]&#125;</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Pulling <span class="variable">$&#123;DOCKER_NS&#125;</span>/<span class="variable">$image</span>:<span class="variable">$&#123;FABRIC_VERSION&#125;</span>&quot;</span></span><br><span class="line">    docker pull <span class="variable">$&#123;DOCKER_NS&#125;</span>/<span class="variable">$image</span>:<span class="variable">$&#123;FABRIC_VERSION&#125;</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Other images</span></span><br><span class="line">  <span class="comment"># couchdb image</span></span><br><span class="line">  docker pull couchdb:<span class="variable">$&#123;DB_VERSION&#125;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;ignored.&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 所在系统的架构</span></span><br><span class="line">ARCH=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(uname -s|tr &#x27;[:upper:]&#x27; &#x27;[:lower:]&#x27;|sed &#x27;s/mingw64_nt.*/windows/&#x27;)</span>-<span class="subst">$(uname -m | sed &#x27;s/x86_64/amd64/g&#x27;)</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Fabric Source Code</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Download Fabric Bianries&quot;</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$&#123;WORK_PATH&#125;</span>/fabric-bin</span><br><span class="line">FILE_NAME=hyperledger-fabric-<span class="variable">$&#123;ARCH&#125;</span>-<span class="variable">$&#123;FABRIC_VERSION&#125;</span>.tar.gz</span><br><span class="line"><span class="keyword">if</span> [ ! -f <span class="string">&quot;<span class="variable">$&#123;FILE_NAME&#125;</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;downloading fabric binaries (<span class="variable">$&#123;FILE_NAME&#125;</span>)...&quot;</span></span><br><span class="line">  wget https://github.com/hyperledger/fabric/releases/download/v<span class="variable">$&#123;FABRIC_VERSION&#125;</span>/<span class="variable">$&#123;FILE_NAME&#125;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;fabric binaries existing (<span class="variable">$&#123;FABRIC_VERSION&#125;</span>), ignored&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Fabric CA Source Code</span></span><br><span class="line">CA_FILE_NAME=hyperledger-fabric-ca-<span class="variable">$&#123;ARCH&#125;</span>-<span class="variable">$&#123;CA_VERSION&#125;</span>.tar.gz</span><br><span class="line"><span class="keyword">if</span> [ ! -f <span class="variable">$CA_FILE_NAME</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;downloading fabric-ca binaries (<span class="variable">$&#123;CA_FILE_NAME&#125;</span>)...&quot;</span></span><br><span class="line">  wget https://github.com/hyperledger/fabric-ca/releases/download/v<span class="variable">$&#123;CA_VERSION&#125;</span>/<span class="variable">$&#123;CA_FILE_NAME&#125;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;fabric-ca binaries existing (<span class="variable">$&#123;CA_VERSION&#125;</span>), ignored&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 移除旧的目录</span></span><br><span class="line"><span class="keyword">if</span> [ -d <span class="string">&quot;<span class="variable">$&#123;FABRIC_VERSION&#125;</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">rm</span> -rf ./<span class="variable">$&#123;FABRIC_VERSION&#125;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建新的目录</span></span><br><span class="line"><span class="built_in">mkdir</span> -p ./<span class="variable">$&#123;FABRIC_VERSION&#125;</span></span><br><span class="line"><span class="built_in">cd</span> ./<span class="variable">$&#123;FABRIC_VERSION&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压下载的源码放到对应的目录下</span></span><br><span class="line">tar zxf ../<span class="variable">$&#123;FILE_NAME&#125;</span></span><br><span class="line">tar zxf ../<span class="variable">$&#123;CA_FILE_NAME&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 把 fabric 的组件命令放到 /usr/local/bin/</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">cp</span> <span class="variable">$&#123;WORK_PATH&#125;</span>/fabric-bin/<span class="variable">$&#123;FABRIC_VERSION&#125;</span>/bin/* /usr/local/bin/</span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$WORK_PATH</span></span><br><span class="line"><span class="built_in">echo</span></span><br></pre></td></tr></table></figure>
<h4 id="init-sh"><code>. ./init.sh</code></h4>
<h5 id="初始化目录结构">初始化目录结构</h5>
<p>原本 <code>~/workspace/organizations/</code> 目录结构如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">workspace/organizations/</span><br><span class="line">├── ccp-generate.sh</span><br><span class="line">├── ccp-template.json</span><br><span class="line">├── ccp-template.yaml</span><br><span class="line">└── fabric-ca</span><br><span class="line">    ├── ca.orderer.example.com.yaml</span><br><span class="line">    ├── ca.org1.example.com.yaml</span><br><span class="line">    ├── ca.org2.example.com.yaml</span><br><span class="line">    └── registerEnroll.sh</span><br></pre></td></tr></table></figure>
<p>要转换成：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">workspace/organizations/</span><br><span class="line">├── ccp-generate.sh</span><br><span class="line">├── ccp-template.json</span><br><span class="line">├── ccp-template.yaml</span><br><span class="line">└── fabric-ca</span><br><span class="line">    ├── ca.orderer.example.com.yaml</span><br><span class="line">    ├── ca.org1.example.com.yaml</span><br><span class="line">    ├── ca.org2.example.com.yaml</span><br><span class="line">    ├── ordererOrg</span><br><span class="line">    │   └── fabric-ca-server-config.yaml</span><br><span class="line">    ├── org1</span><br><span class="line">    │   └── fabric-ca-server-config.yaml</span><br><span class="line">    ├── org2</span><br><span class="line">    │   └── fabric-ca-server-config.yaml</span><br><span class="line">    └── registerEnroll.sh</span><br></pre></td></tr></table></figure>
<p>其中的 <code>ordererOrg/fabric-ca-server-config.yaml</code> 来自于 <code>~/workspace/organizations/fabric-ca/ca.order.example.com.yaml</code> ，其他目录下的 <code>fabric-ca-server-config.yaml</code> 文件也来自于对应的文件。</p>
<p>新建起来的目录将作为下一步，要启动的 CA 服务容器所挂载的数据卷，其中的配置文件也是容器启动所需要的配置文件。</p>
<h5 id="启动-CA-容器">启动 CA 容器</h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CA_IMAGE_TAG=<span class="variable">$&#123;CA_VERSION&#125;</span> docker-compose -f docker/docker-compose-ca.yaml up -d</span><br></pre></td></tr></table></figure>
<p><code>docker-compose-ca.yaml</code> 文件部分内容如下：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker-compose 版本</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">&quot;2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义服务用到的网桥</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">ABC:</span></span><br><span class="line">  <span class="attr">ORDERER:</span></span><br><span class="line">  <span class="attr">ORG1:</span></span><br><span class="line">  <span class="attr">ORG2:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 一个服务就是一个容器</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="comment"># 服务名 ca_org1 ，也就是一个容器</span></span><br><span class="line">  <span class="attr">ca_org1:</span></span><br><span class="line">    <span class="comment"># 容器使用的镜像</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">hyperledger/fabric-ca:$CA_IMAGE_TAG</span></span><br><span class="line">    <span class="comment"># 容器内的环境变量</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FABRIC_CA_HOME=/etc/hyperledger/fabric-ca-server</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FABRIC_CA_SERVER_CA_NAME=ca-org1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FABRIC_CA_SERVER_TLS_ENABLED=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FABRIC_CA_SERVER_PORT=7054</span></span><br><span class="line">    <span class="comment"># 宿主机和容器的端口映射</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;7054:7054&quot;</span></span><br><span class="line">    <span class="comment"># 用于覆盖容器启动后默认执行的命令</span></span><br><span class="line">    <span class="comment"># 这条命令做的是启动 CA Server</span></span><br><span class="line">    <span class="comment"># -b 参数，如果 LDAP 的配置没有开启，那么就需要加上这个参数，表示需要引导一个管理员账户</span></span><br><span class="line">    <span class="comment"># -d 参数，DEBUG 模式启动 CA Server 方便调试</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">sh</span> <span class="string">-c</span> <span class="string">&#x27;fabric-ca-server start -b admin:adminpw -d&#x27;</span></span><br><span class="line">    <span class="comment"># 容器数据卷挂载在宿主机的路径位置</span></span><br><span class="line">    <span class="comment"># 这里的相对路径是相对 compose file 来映射的</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">../organizations/fabric-ca/org1:/etc/hyperledger/fabric-ca-server</span></span><br><span class="line">    <span class="comment"># 容器名</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">ca_org1</span></span><br><span class="line">    <span class="comment"># 代表当前服务都在哪些网桥内通信</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ABC</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ORG1</span></span><br></pre></td></tr></table></figure>
<p>其中的服务只包含了一个组织的 CA 容器，但另外两个类似，所以不一一解读了。</p>
<p>检查容器启动情况，我们看到三个容器启动了：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a --format <span class="string">&quot;&#123;&#123;.CreatedAt&#125;&#125;\t&#123;&#123;.Status&#125;&#125;\t&#123;&#123;.Networks&#125;&#125;\t&#123;&#123;.Names&#125;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2021-04-03 05:26:48 +0000 UTC   Up 30 hours     net_ABC,net_ORG2        ca_org2</span></span><br><span class="line"><span class="comment"># 2021-04-03 05:26:48 +0000 UTC   Up 30 hours     net_ABC,net_ORG1        ca_org1</span></span><br><span class="line"><span class="comment"># 2021-04-03 05:26:48 +0000 UTC   Up 30 hours     net_ABC,net_ORDERER     ca_orderer</span></span><br></pre></td></tr></table></figure>
<p>对比三个配置文件，这三个 CA 容器不同的部分有：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###### ca.orderer.example.com.yaml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">ca:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">OrdererCA</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">csr:</span></span><br><span class="line">  <span class="attr">cn:</span> <span class="string">ca.example.com</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">C:</span> <span class="string">US</span></span><br><span class="line">      <span class="attr">ST:</span> <span class="string">&quot;New York&quot;</span></span><br><span class="line">      <span class="attr">L:</span> <span class="string">&quot;New York&quot;</span></span><br><span class="line">      <span class="attr">O:</span> <span class="string">example.com</span></span><br><span class="line">      <span class="attr">OU:</span></span><br><span class="line">  <span class="attr">hosts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">localhost</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">example.com</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment">###### ca.org1.example.com.yaml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">ca:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">Org2CA</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">csr:</span></span><br><span class="line">  <span class="attr">cn:</span> <span class="string">ca.org1.example.com</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">C:</span> <span class="string">US</span></span><br><span class="line">      <span class="attr">ST:</span> <span class="string">&quot;North Carolina&quot;</span></span><br><span class="line">      <span class="attr">L:</span> <span class="string">&quot;Durham&quot;</span></span><br><span class="line">      <span class="attr">O:</span> <span class="string">org1.example.com</span></span><br><span class="line">      <span class="attr">OU:</span></span><br><span class="line">  <span class="attr">hosts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">localhost</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">org1.example.com</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment">###### ca.org2.example.com.yaml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">ca:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">Org2CA</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">csr:</span></span><br><span class="line">  <span class="attr">cn:</span> <span class="string">ca.org2.example.com</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">C:</span> <span class="string">UK</span></span><br><span class="line">      <span class="attr">ST:</span> <span class="string">&quot;Hampshire&quot;</span></span><br><span class="line">      <span class="attr">L:</span> <span class="string">&quot;Hursley&quot;</span></span><br><span class="line">      <span class="attr">O:</span> <span class="string">org2.example.com</span></span><br><span class="line">      <span class="attr">OU:</span></span><br><span class="line">  <span class="attr">hosts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">localhost</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">org2.example.com</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>这里好像没有专门启动 TLS CA ，只是启动了给网络组织提供 msp 等等认证的 ca ，让节点和用户可以登录到网络上。但是又在文件中看到了 tls 证书的存在（估计是 <code>fabric-ca-server</code> 生成的），所以比较困惑。我猜测是因为 Peer 和 Order 这些节点都需要 TLS 证书来进行安全通信，所以在配置中 TLS 的配置是 enable 了的，但是为了测试网络的简洁，所以没有给他们配置 TLS CA 所以涉及到证书过期等等问题都没有考虑。生产网络则不允许这样设计。根据官网的建议，一般每个组织都需要两个 CA ，一个用于组织内节点的登录（为 peer 节点、管理员、通信以及代表组织的 MSP 目录结构生成登录证书），一个用于生成保护传输层安全，防止中间人攻击的 TLS 证书。</p>
</blockquote>
<p>我们来看看容器生成的时候，执行的命令都生成了什么文件，以 ordererOrg 为例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">tree organizations/fabric-ca/ordererOrg/</span><br><span class="line"></span><br><span class="line"><span class="comment"># organizations/fabric-ca/ordererOrg/</span></span><br><span class="line"><span class="comment"># ├── IssuerPublicKey</span></span><br><span class="line"><span class="comment"># ├── IssuerRevocationPublicKey</span></span><br><span class="line"><span class="comment"># ├── ca-cert.pem</span></span><br><span class="line"><span class="comment"># ├── fabric-ca-server-config.yaml CA 服务器的配置文件</span></span><br><span class="line"><span class="comment"># ├── fabric-ca-server.db 用于存储用户账密的数据库</span></span><br><span class="line"><span class="comment"># ├── msp</span></span><br><span class="line"><span class="comment"># │   ├── cacerts</span></span><br><span class="line"><span class="comment"># │   ├── keystore 这个文件夹下面存放的是管理员的私钥</span></span><br><span class="line"><span class="comment"># │   │   ├── 8bc09ebe688b7db3b5ea6b6a093d9cac770daae995ddf5704daaabf71ed0212e_sk</span></span><br><span class="line"><span class="comment"># │   │   ├── IssuerRevocationPrivateKey</span></span><br><span class="line"><span class="comment"># │   │   ├── IssuerSecretKey</span></span><br><span class="line"><span class="comment"># │   │   └── eae356176a0695ab432782cb941f4b62ba6e59ce7ae73d9a9e5f822d04232464_sk</span></span><br><span class="line"><span class="comment"># │   ├── signcerts 这个文件夹是用来存放管理员证书的，由于管理员尚未到 CA 注册所以这个文件夹是空的</span></span><br><span class="line"><span class="comment"># │   └── user</span></span><br><span class="line"><span class="comment"># └── tls-cert.pem</span></span><br></pre></td></tr></table></figure>
<h5 id="注册-Peer-和-Orderer-节点">注册 Peer 和 Orderer 节点</h5>
<p>在 <code>. ./init.sh</code> 脚本中，这部分的工作是交给了 <code>organizations/fabric-ca/registerEnroll.sh</code> 脚本来完成的。在 <code>registerEnroll.sh</code> 中定义了三个函数： <code>createOrg1()</code> 、 <code>createOrg2()</code> 、 <code>createOrderer()</code> ：</p>
<ul>
<li><code>createOrg1()</code>
<ul>
<li>Enroll the CA admin</li>
<li>Register peer0</li>
<li>Register user</li>
<li>Register the org admin</li>
<li>Generate the peer0 msp</li>
<li>Generate the peer0-tls certificates</li>
<li>Generate the user msp</li>
<li>Generate the org admin msp</li>
</ul>
</li>
<li><code>createOrg2()</code>
<ul>
<li>Enroll the CA admin</li>
<li>Register peer0</li>
<li>Register user</li>
<li>Register the org admin</li>
<li>Generate the peer0 msp</li>
<li>Generate the peer0-tls certificates</li>
<li>Generate the user msp</li>
<li>Generate the org admin msp</li>
</ul>
</li>
<li><code>createOrderer()</code>
<ul>
<li>Enroll the CA admin</li>
<li>Register orderer</li>
<li>Register the orderer admin</li>
<li>Generate the orderer msp</li>
<li>Generate the orderer-tls certificates</li>
<li>Generate the admin msp</li>
</ul>
</li>
</ul>
<p>可见创建这三个组织的过程是差不多的：</p>
<ul>
<li>登录 CA 管理员</li>
<li>注册 peer/orderer</li>
<li>注册 user （可选）</li>
<li>注册 peer/orderer 管理员</li>
<li>生成 peer/orderer 的 msp</li>
<li>生成 peer/orderer 的 tls 证书</li>
<li>生成 user 的 msp （可选）</li>
<li>生成组织管理员的 msp</li>
</ul>
<p>下面只分析 Org1 的创建过程。</p>
<h6 id="创建-org1">创建 org1</h6>
<ol>
<li>
<p>登录 CA 的管理员</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p organizations/peerOrganizations/org1.example.com/</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> FABRIC_CA_CLIENT_HOME=<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/</span><br><span class="line"></span><br><span class="line">fabric-ca-client enroll -u https://admin:adminpw@localhost:7054 --caname ca-org1 --tls.certfiles <span class="variable">$&#123;PWD&#125;</span>/organizations/fabric-ca/org1/tls-cert.pem</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;NodeOUs:</span></span><br><span class="line"><span class="string">Enable: true</span></span><br><span class="line"><span class="string">ClientOUIdentifier:</span></span><br><span class="line"><span class="string">  Certificate: cacerts/localhost-7054-ca-org1.pem</span></span><br><span class="line"><span class="string">  OrganizationalUnitIdentifier: client</span></span><br><span class="line"><span class="string">PeerOUIdentifier:</span></span><br><span class="line"><span class="string">  Certificate: cacerts/localhost-7054-ca-org1.pem</span></span><br><span class="line"><span class="string">  OrganizationalUnitIdentifier: peer</span></span><br><span class="line"><span class="string">AdminOUIdentifier:</span></span><br><span class="line"><span class="string">  Certificate: cacerts/localhost-7054-ca-org1.pem</span></span><br><span class="line"><span class="string">  OrganizationalUnitIdentifier: admin</span></span><br><span class="line"><span class="string">OrdererOUIdentifier:</span></span><br><span class="line"><span class="string">  Certificate: cacerts/localhost-7054-ca-org1.pem</span></span><br><span class="line"><span class="string">  OrganizationalUnitIdentifier: orderer&#x27;</span> &gt; <span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/msp/config.yaml</span><br></pre></td></tr></table></figure>
<p>以上命令执行之后应该有这样的目录结构：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">organizations/peerOrganizations/</span><br><span class="line">└── org1.example.com</span><br><span class="line">    ├── fabric-ca-client-config.yaml</span><br><span class="line">    └── msp</span><br><span class="line">        ├── IssuerPublicKey</span><br><span class="line">        ├── IssuerRevocationPublicKey</span><br><span class="line">        ├── cacerts</span><br><span class="line">        │   └── localhost-7054-ca-org1.pem</span><br><span class="line">        ├── keystore</span><br><span class="line">        │   └── 88613215f7f6ad9fcc0c29b131c44c66431e3e609713f42384cc622fb2988ba4_sk</span><br><span class="line">        ├── signcerts</span><br><span class="line">        │   └── cert.pem</span><br><span class="line">        └── user</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>注册节点 peer0</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">fabric-ca-client register --caname ca-org1 --id.name peer0 --id.secret peer0pw --id.type peer --tls.certfiles <span class="variable">$&#123;PWD&#125;</span>/organizations/fabric-ca/org1/tls-cert.pem</span><br><span class="line"><span class="comment"># 目录结构如下：</span></span><br><span class="line"><span class="comment"># organizations/peerOrganizations</span></span><br><span class="line"><span class="comment">#     └── org1.example.com</span></span><br><span class="line"><span class="comment">#         ├── fabric-ca-client-config.yaml</span></span><br><span class="line"><span class="comment">#         └── msp</span></span><br><span class="line"><span class="comment">#             ├── IssuerPublicKey</span></span><br><span class="line"><span class="comment">#             ├── IssuerRevocationPublicKey</span></span><br><span class="line"><span class="comment">#             ├── cacerts</span></span><br><span class="line"><span class="comment">#             │   └── localhost-7054-ca-org1.pem</span></span><br><span class="line"><span class="comment">#             ├── config.yaml</span></span><br><span class="line"><span class="comment">#             ├── keystore</span></span><br><span class="line"><span class="comment">#             │   ├── 88613215f7f6ad9fcc0c29b131c44c66431e3e609713f42384cc622fb2988ba4_sk</span></span><br><span class="line"><span class="comment">#             │   └── dcbe1485ee1f7856019c33998ea46c2a591fbb7491ff8ecc8f20f31631ac4d76_sk</span></span><br><span class="line"><span class="comment">#             ├── signcerts</span></span><br><span class="line"><span class="comment">#             │   └── cert.pem</span></span><br><span class="line"><span class="comment">#             └── user</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>注册用户</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fabric-ca-client register --caname ca-org1 --id.name user1 --id.secret user1pw --id.type client --tls.certfiles <span class="variable">$&#123;PWD&#125;</span>/organizations/fabric-ca/org1/tls-cert.pem</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>注册组织管理员</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fabric-ca-client register --caname ca-org1 --id.name org1admin --id.secret org1adminpw --id.type admin --tls.certfiles <span class="variable">$&#123;PWD&#125;</span>/organizations/fabric-ca/org1/tls-cert.pem</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>注册 peer0 的 msp</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p organizations/peerOrganizations/org1.example.com/peers</span><br><span class="line"><span class="built_in">mkdir</span> -p organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com</span><br><span class="line"></span><br><span class="line">fabric-ca-client enroll \</span><br><span class="line">-u https://peer0:peer0pw@localhost:7054 \</span><br><span class="line">--caname ca-org1 \</span><br><span class="line">-M <span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/msp \</span><br><span class="line">--csr.hosts peer0.org1.example.com \</span><br><span class="line">--tls.certfiles <span class="variable">$&#123;PWD&#125;</span>/organizations/fabric-ca/org1/tls-cert.pem</span><br><span class="line"></span><br><span class="line"><span class="comment"># organizations/peerOrganizations</span></span><br><span class="line"><span class="comment">#     └── org1.example.com</span></span><br><span class="line"><span class="comment">#         ├── fabric-ca-client-config.yaml</span></span><br><span class="line"><span class="comment">#         ├── msp</span></span><br><span class="line"><span class="comment">#         │   ├── IssuerPublicKey</span></span><br><span class="line"><span class="comment">#         │   ├── IssuerRevocationPublicKey</span></span><br><span class="line"><span class="comment">#         │   ├── cacerts</span></span><br><span class="line"><span class="comment">#         │   │   └── localhost-7054-ca-org1.pem</span></span><br><span class="line"><span class="comment">#         │   ├── config.yaml</span></span><br><span class="line"><span class="comment">#         │   ├── keystore</span></span><br><span class="line"><span class="comment">#         │   │   ├── 88613215f7f6ad9fcc0c29b131c44c66431e3e609713f42384cc622fb2988ba4_sk</span></span><br><span class="line"><span class="comment">#         │   │   └── dcbe1485ee1f7856019c33998ea46c2a591fbb7491ff8ecc8f20f31631ac4d76_sk</span></span><br><span class="line"><span class="comment">#         │   ├── signcerts</span></span><br><span class="line"><span class="comment">#         │   │   └── cert.pem</span></span><br><span class="line"><span class="comment">#         │   └── user</span></span><br><span class="line"><span class="comment">#         └── peers</span></span><br><span class="line"><span class="comment">#             └── peer0.org1.example.com</span></span><br><span class="line"><span class="comment">#                 └── msp</span></span><br><span class="line"><span class="comment">#                     ├── IssuerPublicKey</span></span><br><span class="line"><span class="comment">#                     ├── IssuerRevocationPublicKey</span></span><br><span class="line"><span class="comment">#                     ├── cacerts</span></span><br><span class="line"><span class="comment">#                     │   └── localhost-7054-ca-org1.pem</span></span><br><span class="line"><span class="comment">#                     ├── config.yaml</span></span><br><span class="line"><span class="comment">#                     ├── keystore</span></span><br><span class="line"><span class="comment">#                     │   └── f45202beaef4daf7a7e528c9625076fbfc1a327a7e0a0e23b77ce1f3a797f456_sk</span></span><br><span class="line"><span class="comment">#                     ├── signcerts</span></span><br><span class="line"><span class="comment">#                     │   └── cert.pem</span></span><br><span class="line"><span class="comment">#                     └── user</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>生成 peer0 的 tls 证书</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">fabric-ca-client enroll \</span><br><span class="line">-u https://peer0:peer0pw@localhost:7054 \</span><br><span class="line">--caname ca-org1 \</span><br><span class="line">-M <span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls \</span><br><span class="line">--enrollment.profile tls \</span><br><span class="line">--csr.hosts peer0.org1.example.com \</span><br><span class="line">--csr.hosts localhost \</span><br><span class="line">--tls.certfiles <span class="variable">$&#123;PWD&#125;</span>/organizations/fabric-ca/org1/tls-cert.pem</span><br><span class="line"></span><br><span class="line"><span class="comment"># organizations/</span></span><br><span class="line"><span class="comment"># ├── ccp-generate.sh</span></span><br><span class="line"><span class="comment"># ├── ccp-template.json</span></span><br><span class="line"><span class="comment"># ├── ccp-template.yaml</span></span><br><span class="line"><span class="comment"># ├── fabric-ca</span></span><br><span class="line"><span class="comment"># │   ├── ca.orderer.example.com.yaml</span></span><br><span class="line"><span class="comment"># │   ├── ca.org1.example.com.yaml</span></span><br><span class="line"><span class="comment"># │   ├── ca.org2.example.com.yaml</span></span><br><span class="line"><span class="comment"># │   ├── ordererOrg</span></span><br><span class="line"><span class="comment"># │   │   ├── IssuerPublicKey</span></span><br><span class="line"><span class="comment"># │   │   ├── IssuerRevocationPublicKey</span></span><br><span class="line"><span class="comment"># │   │   ├── ca-cert.pem</span></span><br><span class="line"><span class="comment"># │   │   ├── fabric-ca-server-config.yaml</span></span><br><span class="line"><span class="comment"># │   │   ├── fabric-ca-server.db</span></span><br><span class="line"><span class="comment"># │   │   ├── msp</span></span><br><span class="line"><span class="comment"># │   │   │   ├── cacerts</span></span><br><span class="line"><span class="comment"># │   │   │   ├── keystore</span></span><br><span class="line"><span class="comment"># │   │   │   │   ├── 8bc09ebe688b7db3b5ea6b6a093d9cac770daae995ddf5704daaabf71ed0212e_sk</span></span><br><span class="line"><span class="comment"># │   │   │   │   ├── IssuerRevocationPrivateKey</span></span><br><span class="line"><span class="comment"># │   │   │   │   ├── IssuerSecretKey</span></span><br><span class="line"><span class="comment"># │   │   │   │   └── eae356176a0695ab432782cb941f4b62ba6e59ce7ae73d9a9e5f822d04232464_sk</span></span><br><span class="line"><span class="comment"># │   │   │   ├── signcerts</span></span><br><span class="line"><span class="comment"># │   │   │   └── user</span></span><br><span class="line"><span class="comment"># │   │   └── tls-cert.pem</span></span><br><span class="line"><span class="comment"># │   ├── org1</span></span><br><span class="line"><span class="comment"># │   │   ├── IssuerPublicKey</span></span><br><span class="line"><span class="comment"># │   │   ├── IssuerRevocationPublicKey</span></span><br><span class="line"><span class="comment"># │   │   ├── ca-cert.pem</span></span><br><span class="line"><span class="comment"># │   │   ├── fabric-ca-server-config.yaml</span></span><br><span class="line"><span class="comment"># │   │   ├── fabric-ca-server.db</span></span><br><span class="line"><span class="comment"># │   │   ├── msp</span></span><br><span class="line"><span class="comment"># │   │   │   ├── cacerts</span></span><br><span class="line"><span class="comment"># │   │   │   ├── keystore</span></span><br><span class="line"><span class="comment"># │   │   │   │   ├── 230c741dd12acb5283c00790dce694e0e5ff449e15b48ecf356cc8dc5d063441_sk</span></span><br><span class="line"><span class="comment"># │   │   │   │   ├── IssuerRevocationPrivateKey</span></span><br><span class="line"><span class="comment"># │   │   │   │   ├── IssuerSecretKey</span></span><br><span class="line"><span class="comment"># │   │   │   │   └── a30524cd7016297b0d2387597657eb2d14254bf48dadca940e6487dd7600be3f_sk</span></span><br><span class="line"><span class="comment"># │   │   │   ├── signcerts</span></span><br><span class="line"><span class="comment"># │   │   │   └── user</span></span><br><span class="line"><span class="comment"># │   │   └── tls-cert.pem</span></span><br><span class="line"><span class="comment"># │   ├── org2</span></span><br><span class="line"><span class="comment"># │   │   ├── IssuerPublicKey</span></span><br><span class="line"><span class="comment"># │   │   ├── IssuerRevocationPublicKey</span></span><br><span class="line"><span class="comment"># │   │   ├── ca-cert.pem</span></span><br><span class="line"><span class="comment"># │   │   ├── fabric-ca-server-config.yaml</span></span><br><span class="line"><span class="comment"># │   │   ├── fabric-ca-server.db</span></span><br><span class="line"><span class="comment"># │   │   ├── msp</span></span><br><span class="line"><span class="comment"># │   │   │   ├── cacerts</span></span><br><span class="line"><span class="comment"># │   │   │   ├── keystore</span></span><br><span class="line"><span class="comment"># │   │   │   │   ├── 30bf6cf68bb244019e0eb8953c7d3bb3e8aa5f3c2ecd53882b3ca553cbacb896_sk</span></span><br><span class="line"><span class="comment"># │   │   │   │   ├── IssuerRevocationPrivateKey</span></span><br><span class="line"><span class="comment"># │   │   │   │   ├── IssuerSecretKey</span></span><br><span class="line"><span class="comment"># │   │   │   │   └── e870a0d645d963537e0cf25391ba6cfab1fc5ecdcacdd0a91db8d52375297021_sk</span></span><br><span class="line"><span class="comment"># │   │   │   ├── signcerts</span></span><br><span class="line"><span class="comment"># │   │   │   └── user</span></span><br><span class="line"><span class="comment"># │   │   └── tls-cert.pem</span></span><br><span class="line"><span class="comment"># │   └── registerEnroll.sh</span></span><br><span class="line"><span class="comment"># └── peerOrganizations</span></span><br><span class="line"><span class="comment">#     └── org1.example.com</span></span><br><span class="line"><span class="comment">#         ├── fabric-ca-client-config.yaml</span></span><br><span class="line"><span class="comment">#         ├── msp</span></span><br><span class="line"><span class="comment">#         │   ├── IssuerPublicKey</span></span><br><span class="line"><span class="comment">#         │   ├── IssuerRevocationPublicKey</span></span><br><span class="line"><span class="comment">#         │   ├── cacerts</span></span><br><span class="line"><span class="comment">#         │   │   └── localhost-7054-ca-org1.pem</span></span><br><span class="line"><span class="comment">#         │   ├── config.yaml</span></span><br><span class="line"><span class="comment">#         │   ├── keystore</span></span><br><span class="line"><span class="comment">#         │   │   ├── 88613215f7f6ad9fcc0c29b131c44c66431e3e609713f42384cc622fb2988ba4_sk</span></span><br><span class="line"><span class="comment">#         │   │   └── dcbe1485ee1f7856019c33998ea46c2a591fbb7491ff8ecc8f20f31631ac4d76_sk</span></span><br><span class="line"><span class="comment">#         │   ├── signcerts</span></span><br><span class="line"><span class="comment">#         │   │   └── cert.pem</span></span><br><span class="line"><span class="comment">#         │   └── user</span></span><br><span class="line"><span class="comment">#         └── peers</span></span><br><span class="line"><span class="comment">#             └── peer0.org1.example.com</span></span><br><span class="line"><span class="comment">#                 ├── msp</span></span><br><span class="line"><span class="comment">#                 │   ├── IssuerPublicKey</span></span><br><span class="line"><span class="comment">#                 │   ├── IssuerRevocationPublicKey</span></span><br><span class="line"><span class="comment">#                 │   ├── cacerts</span></span><br><span class="line"><span class="comment">#                 │   │   └── localhost-7054-ca-org1.pem</span></span><br><span class="line"><span class="comment">#                 │   ├── config.yaml</span></span><br><span class="line"><span class="comment">#                 │   ├── keystore</span></span><br><span class="line"><span class="comment">#                 │   │   └── f45202beaef4daf7a7e528c9625076fbfc1a327a7e0a0e23b77ce1f3a797f456_sk</span></span><br><span class="line"><span class="comment">#                 │   ├── signcerts</span></span><br><span class="line"><span class="comment">#                 │   │   └── cert.pem</span></span><br><span class="line"><span class="comment">#                 │   └── user</span></span><br><span class="line"><span class="comment">#                 └── tls</span></span><br><span class="line"><span class="comment">#                     ├── IssuerPublicKey</span></span><br><span class="line"><span class="comment">#                     ├── IssuerRevocationPublicKey</span></span><br><span class="line"><span class="comment">#                     ├── cacerts</span></span><br><span class="line"><span class="comment">#                     ├── keystore</span></span><br><span class="line"><span class="comment">#                     │   └── b482a35fe5b87742dc7f04e6530d1b8f958bd86d5e47e68bf6cbc9c2ef60b041_sk</span></span><br><span class="line"><span class="comment">#                     ├── signcerts</span></span><br><span class="line"><span class="comment">#                     │   └── cert.pem</span></span><br><span class="line"><span class="comment">#                     ├── tlscacerts</span></span><br><span class="line"><span class="comment">#                     │   └── tls-localhost-7054-ca-org1.pem</span></span><br><span class="line"><span class="comment">#                     └── user</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> <span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/tlscacerts/* <span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</span><br><span class="line"><span class="built_in">cp</span> <span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/signcerts/* <span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt</span><br><span class="line"><span class="built_in">cp</span> <span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/keystore/* <span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> <span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/msp/tlscacerts</span><br><span class="line"><span class="built_in">cp</span> <span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/tlscacerts/* <span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/msp/tlscacerts/ca.crt</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> <span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/tlsca</span><br><span class="line"><span class="built_in">cp</span> <span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/tlscacerts/* <span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/tlsca/tlsca.org1.example.com-cert.pem</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> <span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/ca</span><br><span class="line"><span class="built_in">cp</span> <span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/msp/cacerts/* <span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/ca/ca.org1.example.com-cert.pem</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># organizations/</span></span><br><span class="line"><span class="comment"># ├── ccp-generate.sh</span></span><br><span class="line"><span class="comment"># ├── ccp-template.json</span></span><br><span class="line"><span class="comment"># ├── ccp-template.yaml</span></span><br><span class="line"><span class="comment"># ├── fabric-ca</span></span><br><span class="line"><span class="comment"># │   ├── ca.orderer.example.com.yaml</span></span><br><span class="line"><span class="comment"># │   ├── ca.org1.example.com.yaml</span></span><br><span class="line"><span class="comment"># │   ├── ca.org2.example.com.yaml</span></span><br><span class="line"><span class="comment"># │   ├── ordererOrg</span></span><br><span class="line"><span class="comment"># │   │   ├── IssuerPublicKey</span></span><br><span class="line"><span class="comment"># │   │   ├── IssuerRevocationPublicKey</span></span><br><span class="line"><span class="comment"># │   │   ├── ca-cert.pem</span></span><br><span class="line"><span class="comment"># │   │   ├── fabric-ca-server-config.yaml</span></span><br><span class="line"><span class="comment"># │   │   ├── fabric-ca-server.db</span></span><br><span class="line"><span class="comment"># │   │   ├── msp</span></span><br><span class="line"><span class="comment"># │   │   │   ├── cacerts</span></span><br><span class="line"><span class="comment"># │   │   │   ├── keystore</span></span><br><span class="line"><span class="comment"># │   │   │   │   ├── 8bc09ebe688b7db3b5ea6b6a093d9cac770daae995ddf5704daaabf71ed0212e_sk</span></span><br><span class="line"><span class="comment"># │   │   │   │   ├── IssuerRevocationPrivateKey</span></span><br><span class="line"><span class="comment"># │   │   │   │   ├── IssuerSecretKey</span></span><br><span class="line"><span class="comment"># │   │   │   │   └── eae356176a0695ab432782cb941f4b62ba6e59ce7ae73d9a9e5f822d04232464_sk</span></span><br><span class="line"><span class="comment"># │   │   │   ├── signcerts</span></span><br><span class="line"><span class="comment"># │   │   │   └── user</span></span><br><span class="line"><span class="comment"># │   │   └── tls-cert.pem</span></span><br><span class="line"><span class="comment"># │   ├── org1</span></span><br><span class="line"><span class="comment"># │   │   ├── IssuerPublicKey</span></span><br><span class="line"><span class="comment"># │   │   ├── IssuerRevocationPublicKey</span></span><br><span class="line"><span class="comment"># │   │   ├── ca-cert.pem</span></span><br><span class="line"><span class="comment"># │   │   ├── fabric-ca-server-config.yaml</span></span><br><span class="line"><span class="comment"># │   │   ├── fabric-ca-server.db</span></span><br><span class="line"><span class="comment"># │   │   ├── msp</span></span><br><span class="line"><span class="comment"># │   │   │   ├── cacerts</span></span><br><span class="line"><span class="comment"># │   │   │   ├── keystore</span></span><br><span class="line"><span class="comment"># │   │   │   │   ├── 230c741dd12acb5283c00790dce694e0e5ff449e15b48ecf356cc8dc5d063441_sk</span></span><br><span class="line"><span class="comment"># │   │   │   │   ├── IssuerRevocationPrivateKey</span></span><br><span class="line"><span class="comment"># │   │   │   │   ├── IssuerSecretKey</span></span><br><span class="line"><span class="comment"># │   │   │   │   └── a30524cd7016297b0d2387597657eb2d14254bf48dadca940e6487dd7600be3f_sk</span></span><br><span class="line"><span class="comment"># │   │   │   ├── signcerts</span></span><br><span class="line"><span class="comment"># │   │   │   └── user</span></span><br><span class="line"><span class="comment"># │   │   └── tls-cert.pem</span></span><br><span class="line"><span class="comment"># │   ├── org2</span></span><br><span class="line"><span class="comment"># │   │   ├── IssuerPublicKey</span></span><br><span class="line"><span class="comment"># │   │   ├── IssuerRevocationPublicKey</span></span><br><span class="line"><span class="comment"># │   │   ├── ca-cert.pem</span></span><br><span class="line"><span class="comment"># │   │   ├── fabric-ca-server-config.yaml</span></span><br><span class="line"><span class="comment"># │   │   ├── fabric-ca-server.db</span></span><br><span class="line"><span class="comment"># │   │   ├── msp</span></span><br><span class="line"><span class="comment"># │   │   │   ├── cacerts</span></span><br><span class="line"><span class="comment"># │   │   │   ├── keystore</span></span><br><span class="line"><span class="comment"># │   │   │   │   ├── 30bf6cf68bb244019e0eb8953c7d3bb3e8aa5f3c2ecd53882b3ca553cbacb896_sk</span></span><br><span class="line"><span class="comment"># │   │   │   │   ├── IssuerRevocationPrivateKey</span></span><br><span class="line"><span class="comment"># │   │   │   │   ├── IssuerSecretKey</span></span><br><span class="line"><span class="comment"># │   │   │   │   └── e870a0d645d963537e0cf25391ba6cfab1fc5ecdcacdd0a91db8d52375297021_sk</span></span><br><span class="line"><span class="comment"># │   │   │   ├── signcerts</span></span><br><span class="line"><span class="comment"># │   │   │   └── user</span></span><br><span class="line"><span class="comment"># │   │   └── tls-cert.pem</span></span><br><span class="line"><span class="comment"># │   └── registerEnroll.sh</span></span><br><span class="line"><span class="comment"># └── peerOrganizations</span></span><br><span class="line"><span class="comment">#     └── org1.example.com</span></span><br><span class="line"><span class="comment">#         ├── ca （新建的）</span></span><br><span class="line"><span class="comment">#         │   └── ca.org1.example.com-cert.pem （来自 ../peers/peer0.org1.example.com/msp/cacerts/*）</span></span><br><span class="line"><span class="comment">#         ├── fabric-ca-client-config.yaml</span></span><br><span class="line"><span class="comment">#         ├── msp</span></span><br><span class="line"><span class="comment">#         │   ├── IssuerPublicKey</span></span><br><span class="line"><span class="comment">#         │   ├── IssuerRevocationPublicKey</span></span><br><span class="line"><span class="comment">#         │   ├── cacerts</span></span><br><span class="line"><span class="comment">#         │   │   └── localhost-7054-ca-org1.pem</span></span><br><span class="line"><span class="comment">#         │   ├── config.yaml</span></span><br><span class="line"><span class="comment">#         │   ├── keystore</span></span><br><span class="line"><span class="comment">#         │   │   ├── 88613215f7f6ad9fcc0c29b131c44c66431e3e609713f42384cc622fb2988ba4_sk</span></span><br><span class="line"><span class="comment">#         │   │   └── dcbe1485ee1f7856019c33998ea46c2a591fbb7491ff8ecc8f20f31631ac4d76_sk</span></span><br><span class="line"><span class="comment">#         │   ├── signcerts</span></span><br><span class="line"><span class="comment">#         │   │   └── cert.pem</span></span><br><span class="line"><span class="comment">#         │   ├── tlscacerts （新建的）</span></span><br><span class="line"><span class="comment">#         │   │   └── ca.crt （来自 ../../peers/peer0.org1.example.com/tls/tlscacerts/*）</span></span><br><span class="line"><span class="comment">#         │   └── user</span></span><br><span class="line"><span class="comment">#         ├── peers</span></span><br><span class="line"><span class="comment">#         │   └── peer0.org1.example.com</span></span><br><span class="line"><span class="comment">#         │       ├── msp</span></span><br><span class="line"><span class="comment">#         │       │   ├── IssuerPublicKey</span></span><br><span class="line"><span class="comment">#         │       │   ├── IssuerRevocationPublicKey</span></span><br><span class="line"><span class="comment">#         │       │   ├── cacerts</span></span><br><span class="line"><span class="comment">#         │       │   │   └── localhost-7054-ca-org1.pem</span></span><br><span class="line"><span class="comment">#         │       │   ├── config.yaml</span></span><br><span class="line"><span class="comment">#         │       │   ├── keystore</span></span><br><span class="line"><span class="comment">#         │       │   │   └── f45202beaef4daf7a7e528c9625076fbfc1a327a7e0a0e23b77ce1f3a797f456_sk</span></span><br><span class="line"><span class="comment">#         │       │   ├── signcerts</span></span><br><span class="line"><span class="comment">#         │       │   │   └── cert.pem</span></span><br><span class="line"><span class="comment">#         │       │   └── user</span></span><br><span class="line"><span class="comment">#         │       └── tls</span></span><br><span class="line"><span class="comment">#         │           ├── IssuerPublicKey</span></span><br><span class="line"><span class="comment">#         │           ├── IssuerRevocationPublicKey</span></span><br><span class="line"><span class="comment">#         │           ├── ca.crt （来自 ./tlscacerts/*）</span></span><br><span class="line"><span class="comment">#         │           ├── cacerts</span></span><br><span class="line"><span class="comment">#         │           ├── keystore</span></span><br><span class="line"><span class="comment">#         │           │   └── b482a35fe5b87742dc7f04e6530d1b8f958bd86d5e47e68bf6cbc9c2ef60b041_sk</span></span><br><span class="line"><span class="comment">#         │           ├── server.crt （来自 ./signcerts/*）</span></span><br><span class="line"><span class="comment">#         │           ├── server.key （来自 ./keystore/*）</span></span><br><span class="line"><span class="comment">#         │           ├── signcerts</span></span><br><span class="line"><span class="comment">#         │           │   └── cert.pem</span></span><br><span class="line"><span class="comment">#         │           ├── tlscacerts</span></span><br><span class="line"><span class="comment">#         │           │   └── tls-localhost-7054-ca-org1.pem</span></span><br><span class="line"><span class="comment">#         │           └── user</span></span><br><span class="line"><span class="comment">#         └── tlsca （新建的）</span></span><br><span class="line"><span class="comment">#             └── tlsca.org1.example.com-cert.pem （来自 ../peers/tls/tlscacerts/*）</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>生成用户的 msp</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p organizations/peerOrganizations/org1.example.com/users</span><br><span class="line"><span class="built_in">mkdir</span> -p organizations/peerOrganizations/org1.example.com/users/User1@org1.example.com</span><br><span class="line"></span><br><span class="line">fabric-ca-client enroll \</span><br><span class="line">-u https://user1:user1pw@localhost:7054 \</span><br><span class="line">--caname ca-org1 \</span><br><span class="line">-M <span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/users/User1@org1.example.com/msp \</span><br><span class="line">--tls.certfiles <span class="variable">$&#123;PWD&#125;</span>/organizations/fabric-ca/org1/tls-cert.pem</span><br><span class="line"></span><br><span class="line"><span class="comment"># organizations/</span></span><br><span class="line"><span class="comment"># ├── ccp-generate.sh</span></span><br><span class="line"><span class="comment"># ├── ccp-template.json</span></span><br><span class="line"><span class="comment"># ├── ccp-template.yaml</span></span><br><span class="line"><span class="comment"># ├── fabric-ca</span></span><br><span class="line"><span class="comment"># │   ├── ca.orderer.example.com.yaml</span></span><br><span class="line"><span class="comment"># │   ├── ca.org1.example.com.yaml</span></span><br><span class="line"><span class="comment"># │   ├── ca.org2.example.com.yaml</span></span><br><span class="line"><span class="comment"># │   ├── ordererOrg</span></span><br><span class="line"><span class="comment"># │   │   ├── IssuerPublicKey</span></span><br><span class="line"><span class="comment"># │   │   ├── IssuerRevocationPublicKey</span></span><br><span class="line"><span class="comment"># │   │   ├── ca-cert.pem</span></span><br><span class="line"><span class="comment"># │   │   ├── fabric-ca-server-config.yaml</span></span><br><span class="line"><span class="comment"># │   │   ├── fabric-ca-server.db</span></span><br><span class="line"><span class="comment"># │   │   ├── msp</span></span><br><span class="line"><span class="comment"># │   │   │   ├── cacerts</span></span><br><span class="line"><span class="comment"># │   │   │   ├── keystore</span></span><br><span class="line"><span class="comment"># │   │   │   │   ├── 8bc09ebe688b7db3b5ea6b6a093d9cac770daae995ddf5704daaabf71ed0212e_sk</span></span><br><span class="line"><span class="comment"># │   │   │   │   ├── IssuerRevocationPrivateKey</span></span><br><span class="line"><span class="comment"># │   │   │   │   ├── IssuerSecretKey</span></span><br><span class="line"><span class="comment"># │   │   │   │   └── eae356176a0695ab432782cb941f4b62ba6e59ce7ae73d9a9e5f822d04232464_sk</span></span><br><span class="line"><span class="comment"># │   │   │   ├── signcerts</span></span><br><span class="line"><span class="comment"># │   │   │   └── user</span></span><br><span class="line"><span class="comment"># │   │   └── tls-cert.pem</span></span><br><span class="line"><span class="comment"># │   ├── org1</span></span><br><span class="line"><span class="comment"># │   │   ├── IssuerPublicKey</span></span><br><span class="line"><span class="comment"># │   │   ├── IssuerRevocationPublicKey</span></span><br><span class="line"><span class="comment"># │   │   ├── ca-cert.pem</span></span><br><span class="line"><span class="comment"># │   │   ├── fabric-ca-server-config.yaml</span></span><br><span class="line"><span class="comment"># │   │   ├── fabric-ca-server.db</span></span><br><span class="line"><span class="comment"># │   │   ├── msp</span></span><br><span class="line"><span class="comment"># │   │   │   ├── cacerts</span></span><br><span class="line"><span class="comment"># │   │   │   ├── keystore</span></span><br><span class="line"><span class="comment"># │   │   │   │   ├── 230c741dd12acb5283c00790dce694e0e5ff449e15b48ecf356cc8dc5d063441_sk</span></span><br><span class="line"><span class="comment"># │   │   │   │   ├── IssuerRevocationPrivateKey</span></span><br><span class="line"><span class="comment"># │   │   │   │   ├── IssuerSecretKey</span></span><br><span class="line"><span class="comment"># │   │   │   │   └── a30524cd7016297b0d2387597657eb2d14254bf48dadca940e6487dd7600be3f_sk</span></span><br><span class="line"><span class="comment"># │   │   │   ├── signcerts</span></span><br><span class="line"><span class="comment"># │   │   │   └── user</span></span><br><span class="line"><span class="comment"># │   │   └── tls-cert.pem</span></span><br><span class="line"><span class="comment"># │   ├── org2</span></span><br><span class="line"><span class="comment"># │   │   ├── IssuerPublicKey</span></span><br><span class="line"><span class="comment"># │   │   ├── IssuerRevocationPublicKey</span></span><br><span class="line"><span class="comment"># │   │   ├── ca-cert.pem</span></span><br><span class="line"><span class="comment"># │   │   ├── fabric-ca-server-config.yaml</span></span><br><span class="line"><span class="comment"># │   │   ├── fabric-ca-server.db</span></span><br><span class="line"><span class="comment"># │   │   ├── msp</span></span><br><span class="line"><span class="comment"># │   │   │   ├── cacerts</span></span><br><span class="line"><span class="comment"># │   │   │   ├── keystore</span></span><br><span class="line"><span class="comment"># │   │   │   │   ├── 30bf6cf68bb244019e0eb8953c7d3bb3e8aa5f3c2ecd53882b3ca553cbacb896_sk</span></span><br><span class="line"><span class="comment"># │   │   │   │   ├── IssuerRevocationPrivateKey</span></span><br><span class="line"><span class="comment"># │   │   │   │   ├── IssuerSecretKey</span></span><br><span class="line"><span class="comment"># │   │   │   │   └── e870a0d645d963537e0cf25391ba6cfab1fc5ecdcacdd0a91db8d52375297021_sk</span></span><br><span class="line"><span class="comment"># │   │   │   ├── signcerts</span></span><br><span class="line"><span class="comment"># │   │   │   └── user</span></span><br><span class="line"><span class="comment"># │   │   └── tls-cert.pem</span></span><br><span class="line"><span class="comment"># │   └── registerEnroll.sh</span></span><br><span class="line"><span class="comment"># └── peerOrganizations</span></span><br><span class="line"><span class="comment">#     └── org1.example.com</span></span><br><span class="line"><span class="comment">#         ├── ca</span></span><br><span class="line"><span class="comment">#         │   └── ca.org1.example.com-cert.pem</span></span><br><span class="line"><span class="comment">#         ├── fabric-ca-client-config.yaml</span></span><br><span class="line"><span class="comment">#         ├── msp</span></span><br><span class="line"><span class="comment">#         │   ├── IssuerPublicKey</span></span><br><span class="line"><span class="comment">#         │   ├── IssuerRevocationPublicKey</span></span><br><span class="line"><span class="comment">#         │   ├── cacerts</span></span><br><span class="line"><span class="comment">#         │   │   └── localhost-7054-ca-org1.pem</span></span><br><span class="line"><span class="comment">#         │   ├── config.yaml</span></span><br><span class="line"><span class="comment">#         │   ├── keystore</span></span><br><span class="line"><span class="comment">#         │   │   ├── 88613215f7f6ad9fcc0c29b131c44c66431e3e609713f42384cc622fb2988ba4_sk</span></span><br><span class="line"><span class="comment">#         │   │   └── dcbe1485ee1f7856019c33998ea46c2a591fbb7491ff8ecc8f20f31631ac4d76_sk</span></span><br><span class="line"><span class="comment">#         │   ├── signcerts</span></span><br><span class="line"><span class="comment">#         │   │   └── cert.pem</span></span><br><span class="line"><span class="comment">#         │   ├── tlscacerts</span></span><br><span class="line"><span class="comment">#         │   │   └── ca.crt</span></span><br><span class="line"><span class="comment">#         │   └── user</span></span><br><span class="line"><span class="comment">#         ├── peers</span></span><br><span class="line"><span class="comment">#         │   └── peer0.org1.example.com</span></span><br><span class="line"><span class="comment">#         │       ├── msp</span></span><br><span class="line"><span class="comment">#         │       │   ├── IssuerPublicKey</span></span><br><span class="line"><span class="comment">#         │       │   ├── IssuerRevocationPublicKey</span></span><br><span class="line"><span class="comment">#         │       │   ├── cacerts</span></span><br><span class="line"><span class="comment">#         │       │   │   └── localhost-7054-ca-org1.pem</span></span><br><span class="line"><span class="comment">#         │       │   ├── config.yaml</span></span><br><span class="line"><span class="comment">#         │       │   ├── keystore</span></span><br><span class="line"><span class="comment">#         │       │   │   └── f45202beaef4daf7a7e528c9625076fbfc1a327a7e0a0e23b77ce1f3a797f456_sk</span></span><br><span class="line"><span class="comment">#         │       │   ├── signcerts</span></span><br><span class="line"><span class="comment">#         │       │   │   └── cert.pem</span></span><br><span class="line"><span class="comment">#         │       │   └── user</span></span><br><span class="line"><span class="comment">#         │       └── tls</span></span><br><span class="line"><span class="comment">#         │           ├── IssuerPublicKey</span></span><br><span class="line"><span class="comment">#         │           ├── IssuerRevocationPublicKey</span></span><br><span class="line"><span class="comment">#         │           ├── ca.crt</span></span><br><span class="line"><span class="comment">#         │           ├── cacerts</span></span><br><span class="line"><span class="comment">#         │           ├── keystore</span></span><br><span class="line"><span class="comment">#         │           │   └── b482a35fe5b87742dc7f04e6530d1b8f958bd86d5e47e68bf6cbc9c2ef60b041_sk</span></span><br><span class="line"><span class="comment">#         │           ├── server.crt</span></span><br><span class="line"><span class="comment">#         │           ├── server.key</span></span><br><span class="line"><span class="comment">#         │           ├── signcerts</span></span><br><span class="line"><span class="comment">#         │           │   └── cert.pem</span></span><br><span class="line"><span class="comment">#         │           ├── tlscacerts</span></span><br><span class="line"><span class="comment">#         │           │   └── tls-localhost-7054-ca-org1.pem</span></span><br><span class="line"><span class="comment">#         │           └── user</span></span><br><span class="line"><span class="comment">#         ├── tlsca</span></span><br><span class="line"><span class="comment">#         │   └── tlsca.org1.example.com-cert.pem</span></span><br><span class="line"><span class="comment">#         └── users</span></span><br><span class="line"><span class="comment">#             └── User1@org1.example.com</span></span><br><span class="line"><span class="comment">#                 └── msp</span></span><br><span class="line"><span class="comment">#                     ├── IssuerPublicKey</span></span><br><span class="line"><span class="comment">#                     ├── IssuerRevocationPublicKey</span></span><br><span class="line"><span class="comment">#                     ├── cacerts</span></span><br><span class="line"><span class="comment">#                     │   └── localhost-7054-ca-org1.pem</span></span><br><span class="line"><span class="comment">#                     ├── keystore</span></span><br><span class="line"><span class="comment">#                     │   └── e62b64279c20424d3ec5a4d4315ea8e0bffe7c554fd37190cd315e2eada6b390_sk</span></span><br><span class="line"><span class="comment">#                     ├── signcerts</span></span><br><span class="line"><span class="comment">#                     │   └── cert.pem</span></span><br><span class="line"><span class="comment">#                     └── user</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>生成组织管理员的 msp</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com</span><br><span class="line"></span><br><span class="line">fabric-ca-client enroll \</span><br><span class="line">-u https://org1admin:org1adminpw@localhost:7054 \</span><br><span class="line">--caname ca-org1 \</span><br><span class="line">-M <span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp \</span><br><span class="line">--tls.certfiles <span class="variable">$&#123;PWD&#125;</span>/organizations/fabric-ca/org1/tls-cert.pem</span><br><span class="line"></span><br><span class="line"><span class="comment"># organizations/</span></span><br><span class="line"><span class="comment"># ├── ccp-generate.sh</span></span><br><span class="line"><span class="comment"># ├── ccp-template.json</span></span><br><span class="line"><span class="comment"># ├── ccp-template.yaml</span></span><br><span class="line"><span class="comment"># ├── fabric-ca</span></span><br><span class="line"><span class="comment"># │   ├── ca.orderer.example.com.yaml</span></span><br><span class="line"><span class="comment"># │   ├── ca.org1.example.com.yaml</span></span><br><span class="line"><span class="comment"># │   ├── ca.org2.example.com.yaml</span></span><br><span class="line"><span class="comment"># │   ├── ordererOrg</span></span><br><span class="line"><span class="comment"># │   │   ├── IssuerPublicKey</span></span><br><span class="line"><span class="comment"># │   │   ├── IssuerRevocationPublicKey</span></span><br><span class="line"><span class="comment"># │   │   ├── ca-cert.pem</span></span><br><span class="line"><span class="comment"># │   │   ├── fabric-ca-server-config.yaml</span></span><br><span class="line"><span class="comment"># │   │   ├── fabric-ca-server.db</span></span><br><span class="line"><span class="comment"># │   │   ├── msp</span></span><br><span class="line"><span class="comment"># │   │   │   ├── cacerts</span></span><br><span class="line"><span class="comment"># │   │   │   ├── keystore</span></span><br><span class="line"><span class="comment"># │   │   │   │   ├── 8bc09ebe688b7db3b5ea6b6a093d9cac770daae995ddf5704daaabf71ed0212e_sk</span></span><br><span class="line"><span class="comment"># │   │   │   │   ├── IssuerRevocationPrivateKey</span></span><br><span class="line"><span class="comment"># │   │   │   │   ├── IssuerSecretKey</span></span><br><span class="line"><span class="comment"># │   │   │   │   └── eae356176a0695ab432782cb941f4b62ba6e59ce7ae73d9a9e5f822d04232464_sk</span></span><br><span class="line"><span class="comment"># │   │   │   ├── signcerts</span></span><br><span class="line"><span class="comment"># │   │   │   └── user</span></span><br><span class="line"><span class="comment"># │   │   └── tls-cert.pem</span></span><br><span class="line"><span class="comment"># │   ├── org1</span></span><br><span class="line"><span class="comment"># │   │   ├── IssuerPublicKey</span></span><br><span class="line"><span class="comment"># │   │   ├── IssuerRevocationPublicKey</span></span><br><span class="line"><span class="comment"># │   │   ├── ca-cert.pem</span></span><br><span class="line"><span class="comment"># │   │   ├── fabric-ca-server-config.yaml</span></span><br><span class="line"><span class="comment"># │   │   ├── fabric-ca-server.db</span></span><br><span class="line"><span class="comment"># │   │   ├── msp</span></span><br><span class="line"><span class="comment"># │   │   │   ├── cacerts</span></span><br><span class="line"><span class="comment"># │   │   │   ├── keystore</span></span><br><span class="line"><span class="comment"># │   │   │   │   ├── 230c741dd12acb5283c00790dce694e0e5ff449e15b48ecf356cc8dc5d063441_sk</span></span><br><span class="line"><span class="comment"># │   │   │   │   ├── IssuerRevocationPrivateKey</span></span><br><span class="line"><span class="comment"># │   │   │   │   ├── IssuerSecretKey</span></span><br><span class="line"><span class="comment"># │   │   │   │   └── a30524cd7016297b0d2387597657eb2d14254bf48dadca940e6487dd7600be3f_sk</span></span><br><span class="line"><span class="comment"># │   │   │   ├── signcerts</span></span><br><span class="line"><span class="comment"># │   │   │   └── user</span></span><br><span class="line"><span class="comment"># │   │   └── tls-cert.pem</span></span><br><span class="line"><span class="comment"># │   ├── org2</span></span><br><span class="line"><span class="comment"># │   │   ├── IssuerPublicKey</span></span><br><span class="line"><span class="comment"># │   │   ├── IssuerRevocationPublicKey</span></span><br><span class="line"><span class="comment"># │   │   ├── ca-cert.pem</span></span><br><span class="line"><span class="comment"># │   │   ├── fabric-ca-server-config.yaml</span></span><br><span class="line"><span class="comment"># │   │   ├── fabric-ca-server.db</span></span><br><span class="line"><span class="comment"># │   │   ├── msp</span></span><br><span class="line"><span class="comment"># │   │   │   ├── cacerts</span></span><br><span class="line"><span class="comment"># │   │   │   ├── keystore</span></span><br><span class="line"><span class="comment"># │   │   │   │   ├── 30bf6cf68bb244019e0eb8953c7d3bb3e8aa5f3c2ecd53882b3ca553cbacb896_sk</span></span><br><span class="line"><span class="comment"># │   │   │   │   ├── IssuerRevocationPrivateKey</span></span><br><span class="line"><span class="comment"># │   │   │   │   ├── IssuerSecretKey</span></span><br><span class="line"><span class="comment"># │   │   │   │   └── e870a0d645d963537e0cf25391ba6cfab1fc5ecdcacdd0a91db8d52375297021_sk</span></span><br><span class="line"><span class="comment"># │   │   │   ├── signcerts</span></span><br><span class="line"><span class="comment"># │   │   │   └── user</span></span><br><span class="line"><span class="comment"># │   │   └── tls-cert.pem</span></span><br><span class="line"><span class="comment"># │   └── registerEnroll.sh</span></span><br><span class="line"><span class="comment"># └── peerOrganizations</span></span><br><span class="line"><span class="comment">#     └── org1.example.com</span></span><br><span class="line"><span class="comment">#         ├── ca</span></span><br><span class="line"><span class="comment">#         │   └── ca.org1.example.com-cert.pem</span></span><br><span class="line"><span class="comment">#         ├── fabric-ca-client-config.yaml</span></span><br><span class="line"><span class="comment">#         ├── msp</span></span><br><span class="line"><span class="comment">#         │   ├── IssuerPublicKey</span></span><br><span class="line"><span class="comment">#         │   ├── IssuerRevocationPublicKey</span></span><br><span class="line"><span class="comment">#         │   ├── cacerts</span></span><br><span class="line"><span class="comment">#         │   │   └── localhost-7054-ca-org1.pem</span></span><br><span class="line"><span class="comment">#         │   ├── config.yaml</span></span><br><span class="line"><span class="comment">#         │   ├── keystore</span></span><br><span class="line"><span class="comment">#         │   │   ├── 88613215f7f6ad9fcc0c29b131c44c66431e3e609713f42384cc622fb2988ba4_sk</span></span><br><span class="line"><span class="comment">#         │   │   └── dcbe1485ee1f7856019c33998ea46c2a591fbb7491ff8ecc8f20f31631ac4d76_sk</span></span><br><span class="line"><span class="comment">#         │   ├── signcerts</span></span><br><span class="line"><span class="comment">#         │   │   └── cert.pem</span></span><br><span class="line"><span class="comment">#         │   ├── tlscacerts</span></span><br><span class="line"><span class="comment">#         │   │   └── ca.crt</span></span><br><span class="line"><span class="comment">#         │   └── user</span></span><br><span class="line"><span class="comment">#         ├── peers</span></span><br><span class="line"><span class="comment">#         │   └── peer0.org1.example.com</span></span><br><span class="line"><span class="comment">#         │       ├── msp</span></span><br><span class="line"><span class="comment">#         │       │   ├── IssuerPublicKey</span></span><br><span class="line"><span class="comment">#         │       │   ├── IssuerRevocationPublicKey</span></span><br><span class="line"><span class="comment">#         │       │   ├── cacerts</span></span><br><span class="line"><span class="comment">#         │       │   │   └── localhost-7054-ca-org1.pem</span></span><br><span class="line"><span class="comment">#         │       │   ├── config.yaml</span></span><br><span class="line"><span class="comment">#         │       │   ├── keystore</span></span><br><span class="line"><span class="comment">#         │       │   │   └── f45202beaef4daf7a7e528c9625076fbfc1a327a7e0a0e23b77ce1f3a797f456_sk</span></span><br><span class="line"><span class="comment">#         │       │   ├── signcerts</span></span><br><span class="line"><span class="comment">#         │       │   │   └── cert.pem</span></span><br><span class="line"><span class="comment">#         │       │   └── user</span></span><br><span class="line"><span class="comment">#         │       └── tls</span></span><br><span class="line"><span class="comment">#         │           ├── IssuerPublicKey</span></span><br><span class="line"><span class="comment">#         │           ├── IssuerRevocationPublicKey</span></span><br><span class="line"><span class="comment">#         │           ├── ca.crt</span></span><br><span class="line"><span class="comment">#         │           ├── cacerts</span></span><br><span class="line"><span class="comment">#         │           ├── keystore</span></span><br><span class="line"><span class="comment">#         │           │   └── b482a35fe5b87742dc7f04e6530d1b8f958bd86d5e47e68bf6cbc9c2ef60b041_sk</span></span><br><span class="line"><span class="comment">#         │           ├── server.crt</span></span><br><span class="line"><span class="comment">#         │           ├── server.key</span></span><br><span class="line"><span class="comment">#         │           ├── signcerts</span></span><br><span class="line"><span class="comment">#         │           │   └── cert.pem</span></span><br><span class="line"><span class="comment">#         │           ├── tlscacerts</span></span><br><span class="line"><span class="comment">#         │           │   └── tls-localhost-7054-ca-org1.pem</span></span><br><span class="line"><span class="comment">#         │           └── user</span></span><br><span class="line"><span class="comment">#         ├── tlsca</span></span><br><span class="line"><span class="comment">#         │   └── tlsca.org1.example.com-cert.pem</span></span><br><span class="line"><span class="comment">#         └── users</span></span><br><span class="line"><span class="comment">#             ├── Admin@org1.example.com</span></span><br><span class="line"><span class="comment">#             │   └── msp</span></span><br><span class="line"><span class="comment">#             │       ├── IssuerPublicKey</span></span><br><span class="line"><span class="comment">#             │       ├── IssuerRevocationPublicKey</span></span><br><span class="line"><span class="comment">#             │       ├── cacerts</span></span><br><span class="line"><span class="comment">#             │       │   └── localhost-7054-ca-org1.pem</span></span><br><span class="line"><span class="comment">#             │       ├── keystore</span></span><br><span class="line"><span class="comment">#             │       │   └── ddba9bb3e6adb11e8967c97747f3f2da5fa8e6683df36e69a4f30b714633c78a_sk</span></span><br><span class="line"><span class="comment">#             │       ├── signcerts</span></span><br><span class="line"><span class="comment">#             │       │   └── cert.pem</span></span><br><span class="line"><span class="comment">#             │       └── user</span></span><br><span class="line"><span class="comment">#             └── User1@org1.example.com</span></span><br><span class="line"><span class="comment">#                 └── msp</span></span><br><span class="line"><span class="comment">#                     ├── IssuerPublicKey</span></span><br><span class="line"><span class="comment">#                     ├── IssuerRevocationPublicKey</span></span><br><span class="line"><span class="comment">#                     ├── cacerts</span></span><br><span class="line"><span class="comment">#                     │   └── localhost-7054-ca-org1.pem</span></span><br><span class="line"><span class="comment">#                     ├── keystore</span></span><br><span class="line"><span class="comment">#                     │   └── e62b64279c20424d3ec5a4d4315ea8e0bffe7c554fd37190cd315e2eada6b390_sk</span></span><br><span class="line"><span class="comment">#                     ├── signcerts</span></span><br><span class="line"><span class="comment">#                     │   └── cert.pem</span></span><br><span class="line"><span class="comment">#                     └── user</span></span><br></pre></td></tr></table></figure>
<h5 id="生成创世区块">生成创世区块</h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">. scripts/utils.sh</span><br><span class="line">setupCommonENV</span><br><span class="line"><span class="comment"># 因为现在要配置系统通道了所以 FABRIC_CFG_PATH 要指向 configtx.yaml 所在的路径</span></span><br><span class="line"><span class="built_in">export</span> FABRIC_CFG_PATH=<span class="variable">$&#123;PWD&#125;</span>/configtx</span><br><span class="line"></span><br><span class="line">configtxgen \</span><br><span class="line">-profile TwoOrgsOrdererGenesis \</span><br><span class="line">-channelID system-channel \</span><br><span class="line">-outputBlock ./system-genesis-block/genesis.block</span><br><span class="line"></span><br><span class="line">configtxgen \</span><br><span class="line">-profile TwoOrgsChannel \</span><br><span class="line">-outputCreateChannelTx ./channel-artifacts/<span class="variable">$CHANNEL_NAME</span>.tx \</span><br><span class="line">-channelID <span class="variable">$CHANNEL_NAME</span></span><br><span class="line"></span><br><span class="line">configtxgen \</span><br><span class="line">-profile TwoOrgsChannel \</span><br><span class="line">-outputAnchorPeersUpdate ./channel-artifacts/Org1MSPanchors.tx \</span><br><span class="line">-channelID <span class="variable">$CHANNEL_NAME</span> \</span><br><span class="line">-asOrg Org1MSP</span><br><span class="line"></span><br><span class="line">configtxgen \</span><br><span class="line">-profile TwoOrgsChannel \</span><br><span class="line">-outputAnchorPeersUpdate ./channel-artifacts/Org2MSPanchors.tx \</span><br><span class="line">-channelID <span class="variable">$CHANNEL_NAME</span> \</span><br><span class="line">-asOrg Org2MSP</span><br></pre></td></tr></table></figure>
<p>具体的 <code>configtx.yaml</code> 的配置待更新。。。</p>
<h5 id="启动-Peers-和-Orderer-节点">启动 Peers 和 Orderer 节点</h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COMPOSE_FILE_BASE=docker/docker-compose-ABC.yaml COMPOSE_FILE_COUCH=docker/docker-compose-couch.yaml IMAGE_TAG=<span class="variable">$&#123;FABRIC_VERSION&#125;</span> DB_IMAGE_TAG=<span class="variable">$&#123;DB_VERSION&#125;</span> docker-compose -f <span class="variable">$&#123;COMPOSE_FILE_BASE&#125;</span> -f <span class="variable">$&#123;COMPOSE_FILE_COUCH&#125;</span> up -d</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这里不能拆行，否则变量无法在 <code>docker-compose</code> 命令中使用。命令用到的 docker-compose 文件中，用到了一些环境变量，写在了 <code>.env</code> 文件中，由于一开始没有配置这个文件，所以报错了。</p>
</blockquote>
<h5 id="创建并加入通道">创建并加入通道</h5>
<h6 id="设置环境变量">设置环境变量</h6>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Common env</span></span><br><span class="line"><span class="built_in">export</span> FABRIC_CFG_PATH=<span class="variable">$&#123;PWD&#125;</span>/fabric-bin/<span class="variable">$&#123;FABRIC_VERSION&#125;</span>/config</span><br><span class="line"><span class="built_in">export</span> ORDERER_ADDRESS=localhost:7050</span><br><span class="line"><span class="built_in">export</span> PEER0_ORG1_ADDRESS=localhost:7051</span><br><span class="line"><span class="built_in">export</span> PEER0_ORG2_ADDRESS=localhost:9051</span><br><span class="line"><span class="built_in">export</span> PEER0_ORG1_TLS_ROOTCERT_FILE=<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</span><br><span class="line"><span class="built_in">export</span> PEER0_ORG2_TLS_ROOTCERT_FILE=<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span><br><span class="line"><span class="built_in">export</span> ORDERER_CA=<span class="variable">$&#123;PWD&#125;</span>/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line"><span class="built_in">export</span> CHANNEL_NAME=mychannel</span><br><span class="line"></span><br><span class="line"><span class="comment"># Peer env 1</span></span><br><span class="line"><span class="built_in">export</span> CORE_PEER_LOCALMSPID=Org1MSP</span><br><span class="line"><span class="built_in">export</span> CORE_PEER_ADDRESS=<span class="variable">$PEER0_ORG1_ADDRESS</span></span><br><span class="line"><span class="built_in">export</span> CORE_PEER_TLS_ENABLED=<span class="literal">true</span></span><br><span class="line"><span class="built_in">export</span> CORE_PEER_TLS_CERT_FILE=<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt</span><br><span class="line"><span class="built_in">export</span> CORE_PEER_TLS_KEY_FILE=<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key</span><br><span class="line"><span class="built_in">export</span> CORE_PEER_TLS_ROOTCERT_FILE=<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</span><br><span class="line"><span class="built_in">export</span> CORE_PEER_MSPCONFIGPATH=<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</span><br><span class="line"></span><br><span class="line"><span class="comment"># Peer env 2</span></span><br><span class="line"><span class="built_in">export</span> CORE_PEER_LOCALMSPID=Org2MSP</span><br><span class="line"><span class="built_in">export</span> CORE_PEER_ADDRESS=<span class="variable">$PEER0_ORG2_ADDRESS</span></span><br><span class="line"><span class="built_in">export</span> CORE_PEER_TLS_ENABLED=<span class="literal">true</span></span><br><span class="line"><span class="built_in">export</span> CORE_PEER_TLS_CERT_FILE=<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/server.crt</span><br><span class="line"><span class="built_in">export</span> CORE_PEER_TLS_KEY_FILE=<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/server.key</span><br><span class="line"><span class="built_in">export</span> CORE_PEER_TLS_ROOTCERT_FILE=<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span><br><span class="line"><span class="built_in">export</span> CORE_PEER_MSPCONFIGPATH=<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp</span><br></pre></td></tr></table></figure>
<h6 id="创建通道">创建通道</h6>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">pushd</span> ./channel-artifacts</span><br><span class="line">peer channel create \</span><br><span class="line">-o <span class="variable">$&#123;ORDERER_ADDRESS&#125;</span> \</span><br><span class="line">-c <span class="variable">$&#123;CHANNEL_NAME&#125;</span> \</span><br><span class="line">-f <span class="variable">$&#123;CHANNEL_NAME&#125;</span>.tx \</span><br><span class="line">--tls <span class="variable">$CORE_PEER_TLS_ENABLED</span> \</span><br><span class="line">--cafile <span class="variable">$ORDERER_CA</span></span><br><span class="line"><span class="built_in">popd</span></span><br></pre></td></tr></table></figure>
<h6 id="Org1-加入通道">Org1 加入通道</h6>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">setupPeerENV1</span><br><span class="line">peer channel <span class="built_in">join</span> -b ./channel-artifacts/<span class="variable">$&#123;CHANNEL_NAME&#125;</span>.block</span><br><span class="line">setupPeerENV1</span><br><span class="line"><span class="comment"># 更新锚节点</span></span><br><span class="line">peer channel update \</span><br><span class="line">-o <span class="variable">$&#123;ORDERER_ADDRESS&#125;</span> \</span><br><span class="line">-c <span class="variable">$&#123;CHANNEL_NAME&#125;</span> \</span><br><span class="line">-f ./channel-artifacts/Org1MSPanchors.tx \</span><br><span class="line">--tls <span class="variable">$CORE_PEER_TLS_ENABLED</span> \</span><br><span class="line">--cafile <span class="variable">$ORDERER_CA</span></span><br></pre></td></tr></table></figure>
<h6 id="Org2-加入通道">Org2 加入通道</h6>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">setupPeerENV2</span><br><span class="line">peer channel <span class="built_in">join</span> -b ./channel-artifacts/<span class="variable">$&#123;CHANNEL_NAME&#125;</span>.block</span><br><span class="line"><span class="comment"># 更新锚节点</span></span><br><span class="line">peer channel update \</span><br><span class="line">-o <span class="variable">$&#123;ORDERER_ADDRESS&#125;</span> \</span><br><span class="line">-c <span class="variable">$&#123;CHANNEL_NAME&#125;</span> \</span><br><span class="line">-f ./channel-artifacts/Org2MSPanchors.tx \</span><br><span class="line">--tls <span class="variable">$CORE_PEER_TLS_ENABLED</span> \</span><br><span class="line">--cafile <span class="variable">$ORDERER_CA</span></span><br></pre></td></tr></table></figure>
<h6 id="生成连接文档">生成连接文档</h6>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./organizations/ccp-generate.sh</span><br></pre></td></tr></table></figure>
<p>如果是用 Java 开发那么还需要配置 Java 的 连接文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ ! -d <span class="string">&quot;<span class="variable">$&#123;PWD&#125;</span>/app/example01_java/profiles/Org1/tls&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">mkdir</span> -p app/example01_java/profiles/Org1/tls</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ ! -d <span class="string">&quot;<span class="variable">$&#123;PWD&#125;</span>/app/example01_java/profiles/Org2/tls&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">mkdir</span> -p app/example01_java/profiles/Org2/tls</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ ! -d <span class="string">&quot;<span class="variable">$&#123;PWD&#125;</span>/app/example02/profiles/Org1/tls&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">mkdir</span> -p app/example02_java/profiles/Org1/tls</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ ! -d <span class="string">&quot;<span class="variable">$&#123;PWD&#125;</span>/app/example02/profiles/Org2/tls&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">mkdir</span> -p app/example02_java/profiles/Org2/tls</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> ./organizations/peerOrganizations/org1.example.com/connection-org1.json app/example01_java/profiles/Org1/connection.json</span><br><span class="line"><span class="built_in">cp</span> ./organizations/peerOrganizations/org2.example.com/connection-org2.json app/example01_java/profiles/Org2/connection.json</span><br><span class="line"><span class="built_in">cp</span> ./organizations/peerOrganizations/org1.example.com/ca/ca.org1.example.com-cert.pem app/example01_java/profiles/Org1/tls/</span><br><span class="line"><span class="built_in">cp</span> ./organizations/peerOrganizations/org2.example.com/ca/ca.org2.example.com-cert.pem app/example01_java/profiles/Org2/tls/</span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> ./organizations/peerOrganizations/org1.example.com/connection-org1.json app/example02_java/profiles/Org1/connection.json</span><br><span class="line"><span class="built_in">cp</span> ./organizations/peerOrganizations/org2.example.com/connection-org2.json app/example02_java/profiles/Org2/connection.json</span><br><span class="line"><span class="built_in">cp</span> ./organizations/peerOrganizations/org1.example.com/ca/ca.org1.example.com-cert.pem app/example02_java/profiles/Org1/tls/</span><br><span class="line"><span class="built_in">cp</span> ./organizations/peerOrganizations/org2.example.com/ca/ca.org2.example.com-cert.pem app/example02_java/profiles/Org2/tls/</span><br></pre></td></tr></table></figure>
<h4 id="script-deploy-chaincode-sh"><code>. script/deploy_chaincode.sh</code></h4>
<p>首先设置环境变量：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> FABRIC_CFG_PATH=<span class="variable">$&#123;PWD&#125;</span>/fabric-bin/<span class="variable">$&#123;FABRIC_VERSION&#125;</span>/config</span><br><span class="line"><span class="built_in">export</span> ORDERER_ADDRESS=localhost:7050</span><br><span class="line"><span class="built_in">export</span> PEER0_ORG1_ADDRESS=localhost:7051</span><br><span class="line"><span class="built_in">export</span> PEER0_ORG2_ADDRESS=localhost:9051</span><br><span class="line"><span class="built_in">export</span> PEER0_ORG1_TLS_ROOTCERT_FILE=<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</span><br><span class="line"><span class="built_in">export</span> PEER0_ORG2_TLS_ROOTCERT_FILE=<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span><br><span class="line"><span class="built_in">export</span> ORDERER_CA=<span class="variable">$&#123;PWD&#125;</span>/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line"><span class="built_in">export</span> CHANNEL_NAME=mychannel</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> CC_NAME=mycc</span><br><span class="line"><span class="built_in">export</span> CC_VERSION=v1.0</span><br><span class="line"><span class="built_in">export</span> CC_SEQ=1</span><br><span class="line"><span class="built_in">export</span> CC_POLICY=<span class="string">&quot;OR(&#x27;Org1MSP.peer&#x27;, &#x27;Org2MSP.peer&#x27;)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> CC_LANG=golang</span><br><span class="line"><span class="built_in">export</span> CC_PATH=<span class="variable">$&#123;PWD&#125;</span>/chaincode/chaincode_example01/go</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">setupPeerENV1</span></span>() &#123;</span><br><span class="line">    <span class="built_in">export</span> CORE_PEER_LOCALMSPID=Org1MSP</span><br><span class="line">    <span class="built_in">export</span> CORE_PEER_ADDRESS=<span class="variable">$PEER0_ORG1_ADDRESS</span></span><br><span class="line">    <span class="built_in">export</span> CORE_PEER_TLS_ENABLED=<span class="literal">true</span></span><br><span class="line">    <span class="built_in">export</span> CORE_PEER_TLS_CERT_FILE=<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt</span><br><span class="line">    <span class="built_in">export</span> CORE_PEER_TLS_KEY_FILE=<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key</span><br><span class="line">    <span class="built_in">export</span> CORE_PEER_TLS_ROOTCERT_FILE=<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</span><br><span class="line">    <span class="built_in">export</span> CORE_PEER_MSPCONFIGPATH=<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">setupPeerENV2</span></span>() &#123;</span><br><span class="line">    <span class="built_in">export</span> CORE_PEER_LOCALMSPID=Org2MSP</span><br><span class="line">    <span class="built_in">export</span> CORE_PEER_ADDRESS=<span class="variable">$PEER0_ORG2_ADDRESS</span></span><br><span class="line">    <span class="built_in">export</span> CORE_PEER_TLS_ENABLED=<span class="literal">true</span></span><br><span class="line">    <span class="built_in">export</span> CORE_PEER_TLS_CERT_FILE=<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/server.crt</span><br><span class="line">    <span class="built_in">export</span> CORE_PEER_TLS_KEY_FILE=<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/server.key</span><br><span class="line">    <span class="built_in">export</span> CORE_PEER_TLS_ROOTCERT_FILE=<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span><br><span class="line">    <span class="built_in">export</span> CORE_PEER_MSPCONFIGPATH=<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后打包 go 语言的链码，这里有两种打包的方式：</p>
<ol>
<li>
<p>用源码目录下的 <code>build.sh</code> 脚本打包；</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">pushd</span> <span class="variable">$CC_PATH</span></span><br><span class="line">    ./build.sh</span><br><span class="line"><span class="built_in">popd</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>用 <code>peer lifecycle chaincode package</code> 命令打包；</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode package tmp/<span class="variable">$&#123;CC_LABEL&#125;</span>.tar.gz --path <span class="variable">$&#123;CC_PATH&#125;</span> --lang <span class="variable">$CC_LANG</span> --label <span class="variable">$&#123;CC_LABEL&#125;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>每个组织都要打包一次，所以需要设置两次环境变量，切换两个组织的环境分别部署一次；</p>
<h5 id="Org1-安装链码">Org1 安装链码</h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">setupPeerENV1</span><br><span class="line">peer lifecycle chaincode package tmp/<span class="variable">$&#123;CC_LABEL&#125;</span>.tar.gz --path <span class="variable">$&#123;CC_PATH&#125;</span> --lang <span class="variable">$CC_LANG</span> --label <span class="variable">$&#123;CC_LABEL&#125;</span></span><br><span class="line">peer lifecycle chaincode install tmp/<span class="variable">$&#123;CC_LABEL&#125;</span>.tar.gz</span><br></pre></td></tr></table></figure>
<h5 id="Org2-安装链码">Org2 安装链码</h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">setupPeerENV2</span><br><span class="line">peer lifecycle chaincode package tmp/<span class="variable">$&#123;CC_LABEL&#125;</span>.tar.gz --path <span class="variable">$&#123;CC_PATH&#125;</span> --lang <span class="variable">$CC_LANG</span> --label <span class="variable">$&#123;CC_LABEL&#125;</span></span><br><span class="line">peer lifecycle chaincode install tmp/<span class="variable">$&#123;CC_LABEL&#125;</span>.tar.gz</span><br></pre></td></tr></table></figure>
<h5 id="Org1-批准链码">Org1 批准链码</h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">setupPeerENV1</span><br><span class="line">PACKAGE_ID=$(peer lifecycle chaincode queryinstalled --output json | jq -r <span class="string">&#x27;.installed_chaincodes[] | select(.label == env.CC_LABEL) | .package_id&#x27;</span>)</span><br><span class="line"></span><br><span class="line">peer lifecycle chaincode approveformyorg \</span><br><span class="line">-o <span class="variable">$&#123;ORDERER_ADDRESS&#125;</span> \</span><br><span class="line">--ordererTLSHostnameOverride orderer.example.com \</span><br><span class="line">--tls <span class="variable">$CORE_PEER_TLS_ENABLED</span> \</span><br><span class="line">--cafile <span class="variable">$ORDERER_CA</span> \</span><br><span class="line">--channelID <span class="variable">$CHANNEL_NAME</span> \</span><br><span class="line">--name <span class="variable">$&#123;CC_NAME&#125;</span> \</span><br><span class="line">--version <span class="variable">$&#123;CC_VERSION&#125;</span> \</span><br><span class="line">--init-required \</span><br><span class="line">--package-id <span class="variable">$&#123;PACKAGE_ID&#125;</span> \</span><br><span class="line">--sequence <span class="variable">$CC_SEQ</span> \</span><br><span class="line">--waitForEvent \</span><br><span class="line">--signature-policy <span class="string">&quot;<span class="variable">$CC_POLICY</span>&quot;</span> \</span><br><span class="line"><span class="variable">$PRIVATE_COLLECTION_DEF</span></span><br></pre></td></tr></table></figure>
<h5 id="Org2-批准链码">Org2 批准链码</h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">setupPeerENV2</span><br><span class="line">PACKAGE_ID=$(peer lifecycle chaincode queryinstalled --output json | jq -r <span class="string">&#x27;.installed_chaincodes[] | select(.label == env.CC_LABEL) | .package_id&#x27;</span>)</span><br><span class="line"></span><br><span class="line">peer lifecycle chaincode approveformyorg \</span><br><span class="line">    -o <span class="variable">$&#123;ORDERER_ADDRESS&#125;</span> \</span><br><span class="line">    --ordererTLSHostnameOverride orderer.example.com \</span><br><span class="line">    --tls <span class="variable">$CORE_PEER_TLS_ENABLED</span> \</span><br><span class="line">    --cafile <span class="variable">$ORDERER_CA</span> \</span><br><span class="line">    --channelID <span class="variable">$CHANNEL_NAME</span> \</span><br><span class="line">    --name <span class="variable">$&#123;CC_NAME&#125;</span> \</span><br><span class="line">    --version <span class="variable">$&#123;CC_VERSION&#125;</span> \</span><br><span class="line">    --init-required \</span><br><span class="line">    --package-id <span class="variable">$&#123;PACKAGE_ID&#125;</span> \</span><br><span class="line">    --sequence <span class="variable">$CC_SEQ</span> \</span><br><span class="line">    --waitForEvent \</span><br><span class="line">    --signature-policy <span class="string">&quot;<span class="variable">$CC_POLICY</span>&quot;</span> <span class="variable">$PRIVATE_COLLECTION_DEF</span></span><br></pre></td></tr></table></figure>
<h5 id="Org1-检查链码批准">Org1 检查链码批准</h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">setupPeerENV1</span><br><span class="line"></span><br><span class="line">peer lifecycle chaincode checkcommitreadiness \</span><br><span class="line">--channelID <span class="variable">$CHANNEL_NAME</span> \</span><br><span class="line">--name <span class="variable">$&#123;CC_NAME&#125;</span> \</span><br><span class="line">--version <span class="variable">$&#123;CC_VERSION&#125;</span> \</span><br><span class="line">--sequence <span class="variable">$CC_SEQ</span> \</span><br><span class="line">--output json \</span><br><span class="line">--init-required \</span><br><span class="line">--signature-policy <span class="string">&quot;<span class="variable">$CC_POLICY</span>&quot;</span> <span class="variable">$PRIVATE_COLLECTION_DEF</span></span><br></pre></td></tr></table></figure>
<h5 id="Org1-提交链码定义">Org1 提交链码定义</h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">setupPeerENV1</span><br><span class="line"></span><br><span class="line">peer lifecycle chaincode commit \</span><br><span class="line">-o <span class="variable">$&#123;ORDERER_ADDRESS&#125;</span> \</span><br><span class="line">--ordererTLSHostnameOverride orderer.example.com \</span><br><span class="line">--tls <span class="variable">$CORE_PEER_TLS_ENABLED</span> \</span><br><span class="line">--cafile <span class="variable">$ORDERER_CA</span> \</span><br><span class="line">--peerAddresses <span class="variable">$PEER0_ORG1_ADDRESS</span> \</span><br><span class="line">--tlsRootCertFiles <span class="variable">$PEER0_ORG1_TLS_ROOTCERT_FILE</span> \</span><br><span class="line">--peerAddresses <span class="variable">$PEER0_ORG2_ADDRESS</span> \</span><br><span class="line">--tlsRootCertFiles <span class="variable">$PEER0_ORG2_TLS_ROOTCERT_FILE</span> \</span><br><span class="line">-C <span class="variable">$CHANNEL_NAME</span> \</span><br><span class="line">--name <span class="variable">$&#123;CC_NAME&#125;</span> \</span><br><span class="line">--version <span class="variable">$&#123;CC_VERSION&#125;</span> \</span><br><span class="line">--sequence <span class="variable">$CC_SEQ</span> \</span><br><span class="line">--init-required \</span><br><span class="line">--signature-policy <span class="string">&quot;<span class="variable">$CC_POLICY</span>&quot;</span> <span class="variable">$PRIVATE_COLLECTION_DEF</span></span><br></pre></td></tr></table></figure>
<h5 id="Org1-检查链码状态">Org1 检查链码状态</h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setupPeerENV1</span><br><span class="line">peer lifecycle chaincode querycommitted --channelID <span class="variable">$CHANNEL_NAME</span> --name <span class="variable">$&#123;CC_NAME&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="调用链码">调用链码</h4>
<p>首先同样的要设置环境变量，同上一步一样，用哪个组织的管理员身份去调用就设置哪个环境，这里就不贴代码了。</p>
<h5 id="初始化链码">初始化链码</h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke \</span><br><span class="line">    -o <span class="variable">$&#123;ORDERER_ADDRESS&#125;</span> \</span><br><span class="line">    --ordererTLSHostnameOverride orderer.example.com \</span><br><span class="line">    --tls <span class="variable">$CORE_PEER_TLS_ENABLED</span> \</span><br><span class="line">    --cafile <span class="variable">$ORDERER_CA</span> \</span><br><span class="line">    -C <span class="variable">$CHANNEL_NAME</span> \</span><br><span class="line">    -n <span class="variable">$&#123;CC_NAME&#125;</span>  \</span><br><span class="line">    --isInit -c <span class="string">&#x27;&#123;&quot;Function&quot;:&quot;Init&quot;,&quot;Args&quot;:[]&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<h5 id="调用函数">调用函数</h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -C <span class="variable">$CHANNEL_NAME</span> -n <span class="variable">$CC_NAME</span> -c <span class="string">&#x27;&#123;&quot;Function&quot;:&quot;Hi&quot;, &quot;Args&quot;:[]&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/02/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/python/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/python%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/02/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/python/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/python%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/" class="post-title-link" itemprop="url">python 面向对象入门</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-02 00:00:00" itemprop="dateCreated datePublished" datetime="2021-04-02T00:00:00+08:00">2021-04-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-02-01 01:54:09" itemprop="dateModified" datetime="2025-02-01T01:54:09+08:00">2025-02-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/" itemprop="url" rel="index"><span itemprop="name">article</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">计算机</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">程序设计语言</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/python/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" itemprop="url" rel="index"><span itemprop="name">面向对象</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="python-面向对象入门">python 面向对象入门</h2>
<ul>
<li>
<p><a href="#python-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8">python 面向对象入门</a></p>
<ul>
<li>
<p><a href="#%E7%B1%BB">类</a></p>
</li>
<li>
<p><a href="#%E7%A7%81%E6%9C%89%E6%96%B9%E6%B3%95">私有方法</a></p>
<ul>
<li><a href="#%E8%BF%90%E7%AE%97%E7%AC%A6%E9%87%8D%E8%BD%BD">运算符重载</a></li>
<li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%AD%E4%BB%A3%E5%99%A8">自定义迭代器</a></li>
<li><a href="#%E7%94%9F%E6%88%90%E5%99%A8">生成器</a>
<ul>
<li><a href="#%E7%94%9F%E6%88%90%E5%99%A8%E8%A1%A8%E8%BE%BE%E5%BC%8F">生成器表达式</a></li>
</ul>
</li>
</ul>
</li>
<li>
<p><a href="#%E7%B1%BB">类</a></p>
</li>
<li>
<p><a href="#%E7%A7%81%E6%9C%89%E6%96%B9%E6%B3%95">私有方法</a> - <a href="#%E8%BF%90%E7%AE%97%E7%AC%A6%E9%87%8D%E8%BD%BD">运算符重载</a> - <a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%AD%E4%BB%A3%E5%99%A8">自定义迭代器</a> - <a href="#%E7%94%9F%E6%88%90%E5%99%A8">生成器</a> - <a href="#%E7%94%9F%E6%88%90%E5%99%A8%E8%A1%A8%E8%BE%BE%E5%BC%8F">生成器表达式</a><br>
面向对象的要素：</p>
</li>
</ul>
</li>
<li>
<p>类</p>
</li>
<li>
<p>属性</p>
</li>
<li>
<p>方法</p>
</li>
<li>
<p>继承</p>
</li>
<li>
<p>封装</p>
</li>
<li>
<p>多态</p>
</li>
</ul>
<h3 id="类">类</h3>
<p>python 类对象支持两种操作：属性引用、实例化</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;A Car Class&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 类变量，在所有实例中共享</span></span><br><span class="line">    <span class="comment"># 类似于 Java 中的 static 变量</span></span><br><span class="line">    CarCount = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 私有变量，不能直接访问，也不能继承</span></span><br><span class="line">    __price = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 构造方法</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, carNo, driver</span>):</span><br><span class="line">        <span class="comment"># 实例变量，为单个实例拥有</span></span><br><span class="line">        <span class="variable language_">self</span>.carNo = carNo</span><br><span class="line">        <span class="variable language_">self</span>.driver = driver</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 成员方法</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_price</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable language_">self</span>.__price)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_driver</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable language_">self</span>.driver)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 属性引用</span></span><br><span class="line">Car.CarCount</span><br><span class="line"><span class="comment"># 内置方法，返回 &quot;A Car Class&quot;</span></span><br><span class="line">Car.__doc__</span><br><span class="line"></span><br><span class="line"><span class="comment"># 实例化</span></span><br><span class="line">car = Car(<span class="string">&quot;粤A2333&quot;</span>, <span class="string">&quot;老司机&quot;</span>)</span><br><span class="line">car.carNo <span class="comment"># 访问实例对象</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">People</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.age = age</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_driver</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable language_">self</span>.name, <span class="string">&#x27;是司机&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 私有方法，只能在类内访问</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__get_IDcard</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;这是一个私有方法&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 单继承</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BMW</span>(<span class="title class_ inherited__">Car</span>):</span><br><span class="line">    model = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, carNo, driver, model</span>):</span><br><span class="line">        <span class="comment"># 调用父类的构造函数</span></span><br><span class="line">        Car.__init__(<span class="variable language_">self</span>, carNo, driver):</span><br><span class="line">        <span class="variable language_">self</span>.model = model</span><br><span class="line">    <span class="comment"># 覆盖父类的方法</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_driver</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable language_">self</span>.driver)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 多继承</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">License</span>(<span class="params">Car, Driver</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, carNo, driver, name, age</span>):</span><br><span class="line">        Car.__init__(<span class="variable language_">self</span>, carNo, driver)</span><br><span class="line">        People.__init__(<span class="variable language_">self</span>, name, age)</span><br><span class="line"></span><br><span class="line">a = License(<span class="string">&#x27;粤A7846&#x27;</span>, <span class="string">&#x27;小明&#x27;</span>, <span class="string">&#x27;小明&#x27;</span>, <span class="number">22</span>)</span><br><span class="line">a.get_driver()</span><br><span class="line"><span class="comment"># 在遇到多继承的父类中都有同样方法的情况下，</span></span><br><span class="line"><span class="comment"># 默认执行在括号中，排前面的类的那个方法</span></span><br><span class="line"><span class="comment"># 所以输出:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 小明</span></span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure>
<h3 id="私有方法">私有方法</h3>
<p>除了可以自己定义私有方法外，这些方法都是类内可以使用的私有方法：</p>
<p><strong>init</strong> : 构造函数，在生成对象时调用<br>
<strong>del</strong> : 析构函数，释放对象时使用<br>
<strong>repr</strong> : 打印，转换<br>
<strong>setitem</strong> : 按照索引赋值<br>
<strong>getitem</strong>: 按照索引获取值<br>
<strong>next</strong>: 逐一访问容器内的下一个对象，直到触发 <code>StopIteration</code> 异常<br>
<strong>iter</strong>: for 语句会执行这个方法，返回一个定义了 <code>__next__()</code> 方法的容器对象<br>
<strong>len</strong>: 获得长度<br>
<strong>cmp</strong>: 比较运算<br>
<strong>call</strong>: 函数调用<br>
<strong>add</strong>: 加运算<br>
<strong>sub</strong>: 减运算<br>
<strong>mul</strong>: 乘运算<br>
<strong>truediv</strong>: 除运算<br>
<strong>mod</strong>: 求余运算<br>
<strong>pow</strong>: 乘方</p>
<p>类型转换相关的方法：<br>
<strong>int</strong><br>
<strong>str</strong><br>
<strong>bytes</strong><br>
…</p>
<p>此外还有很多预定义的函数，很多 python 的一些操作都可以通过重写预定义函数来定制化，比如下面的运算符重载。</p>
<h4 id="运算符重载">运算符重载</h4>
<p>通过对以上类内使用的私有方法的重新定义来达到运算符重载的效果，比如重载 <code>+</code> ：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Vector</span>:</span><br><span class="line">    x = <span class="number">0</span></span><br><span class="line">    y = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, x, y</span>):</span><br><span class="line">        <span class="variable language_">self</span>.x = x</span><br><span class="line">        <span class="variable language_">self</span>.y = y</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Vector (%d, %d)&#x27;</span> % (<span class="variable language_">self</span>.x, <span class="variable language_">self</span>.y)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__add__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> Vector(<span class="variable language_">self</span>.x + other.x, <span class="variable language_">self</span>.y + other.y)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    v1 = Vector(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    v2 = Vector(<span class="number">10</span>, -<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(v1 + v2)</span><br></pre></td></tr></table></figure>
<p>输出:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(10, -10)</span><br></pre></td></tr></table></figure>
<h4 id="自定义迭代器">自定义迭代器</h4>
<p><code>for</code> 语句会调用类的 <code>iter()</code> 方法，返回一个定义了 <code>next()</code> 函数的容器对象，然后不停调用 <code>next()</code> 方法，访问容器内的对象。直到 <code>__next__()</code> 方法触发 <code>StopIteration</code> 异常来通知 <code>for</code> 终止循环。下面定义了一个迭代器类。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Reverse</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Iterator for looping over a sequence backwards.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="variable language_">self</span>.data = data</span><br><span class="line">        <span class="variable language_">self</span>.index = <span class="built_in">len</span>(data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__next__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.index == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">raise</span> StopIteration</span><br><span class="line">        <span class="variable language_">self</span>.index = <span class="variable language_">self</span>.index - <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.data[<span class="variable language_">self</span>.index]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    r = Reverse([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> r:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line"><span class="comment"># 4</span></span><br></pre></td></tr></table></figure>
<h4 id="生成器">生成器</h4>
<p>上面实现的迭代器是通过自定义 <code>__iter__()</code> 和 <code>__next__()</code> 方法实现的，实际上要完成同样的功能，生成器也可以实现，而且生成器的语法会更加紧凑。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">reverse</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data)-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">yield</span> data[index]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> reverse(<span class="string">&#x27;golf&#x27;</span>):</span><br><span class="line">        <span class="built_in">print</span>(char)</span><br><span class="line"><span class="comment"># f</span></span><br><span class="line"><span class="comment"># l</span></span><br><span class="line"><span class="comment"># o</span></span><br><span class="line"><span class="comment"># g</span></span><br></pre></td></tr></table></figure>
<p>通过 <code>next()</code> 函数调用生成器，就会在执行到 <code>yield</code> 的时候离开函数，每执行一次 <code>next()</code> 还会从上次离开的地方继续执行。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    r = reverse([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">next</span>(r))</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">next</span>(r))</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">next</span>(r))</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">next</span>(r))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4</span></span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line"><span class="comment"># 1</span></span><br></pre></td></tr></table></figure>
<h5 id="生成器表达式">生成器表达式</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>([i <span class="keyword">for</span> i <span class="keyword">in</span> reverse(<span class="string">&#x27;abcd&#x27;</span>)])</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/30/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/chaincode_lifecycle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/03/30/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20Fabric/chaincode_lifecycle/" class="post-title-link" itemprop="url">chaincode_lifecycle</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-03-30 00:00:00" itemprop="dateCreated datePublished" datetime="2021-03-30T00:00:00+08:00">2021-03-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-02-01 01:54:07" itemprop="dateModified" datetime="2025-02-01T01:54:07+08:00">2025-02-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/" itemprop="url" rel="index"><span itemprop="name">article</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">计算机</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%8C%BA%E5%9D%97%E9%93%BE/" itemprop="url" rel="index"><span itemprop="name">区块链</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/" itemprop="url" rel="index"><span itemprop="name">Hyperledger Fabric</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Chaincode-Lifecycle">Chaincode Lifecycle</h2>
<h3 id="Environment-Varibles">Environment Varibles</h3>
<ul>
<li>
<p>FABRIC_CFG_PATH<br>
path of <code>configtx.yaml</code> file</p>
</li>
<li>
<p>CORE_PEER_LOCALMSPID<br>
ID of peer to be accessed</p>
</li>
<li>
<p>CORE_PEER_ADDRESS<br>
IP/FQDN+PORT of peer to be accessed</p>
</li>
<li>
<p>CORE_PEER_TLS_ENABLED (required only for TLS)</p>
</li>
<li>
<p>CORE_PEER_TLS_CERT_FILE</p>
</li>
<li>
<p>CORE_PEER_TLS_KEY_FILE</p>
</li>
<li>
<p>CORE_PEER_TLS_ROOTCERT_FILE</p>
</li>
<li>
<p>CORE_PEER_MSPCONFIGPATH</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> FABRIC_CFG_PATH=<span class="variable">$&#123;PWD&#125;</span>/fabric-bin/<span class="variable">$&#123;FABRIC_VERSION&#125;</span>/config</span><br><span class="line"><span class="built_in">export</span> CORE_PEER_LOCALMSPID=Org1MSP</span><br><span class="line"><span class="built_in">export</span> CORE_PEER_ADDRESS=<span class="variable">$PEER0_ORG1_ADDRESS</span></span><br><span class="line"><span class="built_in">export</span> CORE_PEER_TLS_ENABLED=<span class="literal">true</span></span><br><span class="line"><span class="built_in">export</span> CORE_PEER_TLS_CERT_FILE=<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt</span><br><span class="line"><span class="built_in">export</span> CORE_PEER_TLS_KEY_FILE=<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key</span><br><span class="line"><span class="built_in">export</span> CORE_PEER_TLS_ROOTCERT_FILE=<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</span><br><span class="line"><span class="built_in">export</span> CORE_PEER_MSPCONFIGPATH=<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="Steps">Steps</h3>
<ul>
<li>packaging chaincode （make *.tar.gz）</li>
</ul>
<p><code>peer lifecycle chaincode package</code></p>
<ul>
<li>installing chaincode （upload chaincode to peer）</li>
</ul>
<p><code>peer lifecycle chaincode install</code></p>
<ul>
<li>getting package ID</li>
</ul>
<p><code>peer lifecycle chaincode queryinstalled</code></p>
<ul>
<li>sign chaincode</li>
</ul>
<p><code>peer lifecycle chaincode approveformyorg</code></p>
<ul>
<li>check chaincode status</li>
</ul>
<p><code>peer lifecycle chaincode checkcommitreadiness</code></p>
<ul>
<li>commit chaincode<br>
<code>peer lifecycle chaincode commit</code></li>
</ul>
<h3 id="Example">Example</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.0 switch to PEER0@ORG1</span></span><br><span class="line"><span class="comment">#1.1. package</span></span><br><span class="line">peer lifecycle chaincode package tmp/<span class="variable">$&#123;CC_LABEL&#125;</span>.tar.gz --path <span class="variable">$&#123;CC_PATH&#125;</span> --lang <span class="variable">$CC_LANG</span> --label <span class="variable">$&#123;CC_LABEL&#125;</span></span><br><span class="line"><span class="comment">#1.2. install</span></span><br><span class="line">peer lifecycle chaincode install tmp/<span class="variable">$&#123;CC_LABEL&#125;</span>.tar.gz</span><br><span class="line"><span class="comment">#1.3. get packageID</span></span><br><span class="line">peer lifecycle chaincode queryinstalled --output json | jq -r <span class="string">&#x27;.installed_chaincodes[] | select(.label == env.CC_LABEL) | .package_id&#x27;</span></span><br><span class="line"><span class="comment">#1.4. sign-ORG1</span></span><br><span class="line">peer lifecycle chaincode approveformyorg \</span><br><span class="line">-o <span class="variable">$&#123;ORDERER_ADDRESS&#125;</span> --ordererTLSHostnameOverride orderer.example.com --tls <span class="variable">$CORE_PEER_TLS_ENABLED</span> --cafile <span class="variable">$ORDERER_CA</span> \</span><br><span class="line">--channelID <span class="variable">$CHANNEL_NAME</span> --name <span class="variable">$&#123;CC_NAME&#125;</span> --version <span class="variable">$&#123;CC_VERSION&#125;</span> \</span><br><span class="line">--init-required --package-id <span class="variable">$&#123;PACKAGE_ID&#125;</span> --sequence <span class="variable">$CC_SEQ</span> --waitForEvent \</span><br><span class="line">--signature-policy <span class="string">&quot;<span class="variable">$CC_POLICY</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2.0 switch to PEER0@ORG2</span></span><br><span class="line"><span class="comment">#2.1. package</span></span><br><span class="line">peer lifecycle chaincode package tmp/<span class="variable">$&#123;CC_LABEL&#125;</span>.tar.gz --path <span class="variable">$&#123;CC_PATH&#125;</span> --lang <span class="variable">$CC_LANG</span> --label <span class="variable">$&#123;CC_LABEL&#125;</span></span><br><span class="line"><span class="comment">#2.2. install</span></span><br><span class="line">peer lifecycle chaincode install tmp/<span class="variable">$&#123;CC_LABEL&#125;</span>.tar.gz</span><br><span class="line"><span class="comment">#2.3. get packageID</span></span><br><span class="line">peer lifecycle chaincode queryinstalled --output json | jq -r <span class="string">&#x27;.installed_chaincodes[] | select(.label == env.CC_LABEL) | .package_id&#x27;</span></span><br><span class="line"><span class="comment">#2.4. sign-ORG2</span></span><br><span class="line">peer lifecycle chaincode approveformyorg \</span><br><span class="line">-o <span class="variable">$&#123;ORDERER_ADDRESS&#125;</span> --ordererTLSHostnameOverride orderer.example.com --tls <span class="variable">$CORE_PEER_TLS_ENABLED</span> --cafile <span class="variable">$ORDERER_CA</span> \</span><br><span class="line">--channelID <span class="variable">$CHANNEL_NAME</span> --name <span class="variable">$&#123;CC_NAME&#125;</span> --version <span class="variable">$&#123;CC_VERSION&#125;</span> \</span><br><span class="line">--init-required --package-id <span class="variable">$&#123;PACKAGE_ID&#125;</span> --sequence <span class="variable">$CC_SEQ</span> --waitForEvent \</span><br><span class="line">--signature-policy <span class="string">&quot;<span class="variable">$CC_POLICY</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3.0. switch to PEER0@ORG1</span></span><br><span class="line"><span class="comment">#3.1. check readiness</span></span><br><span class="line">peer lifecycle chaincode checkcommitreadiness \</span><br><span class="line">--channelID <span class="variable">$CHANNEL_NAME</span> --name <span class="variable">$&#123;CC_NAME&#125;</span> \</span><br><span class="line">--version <span class="variable">$&#123;CC_VERSION&#125;</span> --sequence <span class="variable">$CC_SEQ</span> --output json --init-required \</span><br><span class="line">--signature-policy <span class="string">&quot;<span class="variable">$CC_POLICY</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#4. commit</span></span><br><span class="line">peer lifecycle chaincode commit -o <span class="variable">$&#123;ORDERER_ADDRESS&#125;</span> --ordererTLSHostnameOverride orderer.example.com --tls <span class="variable">$CORE_PEER_TLS_ENABLED</span> --cafile <span class="variable">$ORDERER_CA</span> \</span><br><span class="line">--peerAddresses <span class="variable">$PEER0_ORG1_ADDRESS</span> --tlsRootCertFiles <span class="variable">$PEER0_ORG1_TLS_ROOTCERT_FILE</span> \</span><br><span class="line">--peerAddresses <span class="variable">$PEER0_ORG2_ADDRESS</span> --tlsRootCertFiles <span class="variable">$PEER0_ORG2_TLS_ROOTCERT_FILE</span> \</span><br><span class="line">-C <span class="variable">$CHANNEL_NAME</span> --name <span class="variable">$&#123;CC_NAME&#125;</span> \</span><br><span class="line">--version <span class="variable">$&#123;CC_VERSION&#125;</span> --sequence <span class="variable">$CC_SEQ</span> --init-required \</span><br><span class="line">--signature-policy <span class="string">&quot;<span class="variable">$CC_POLICY</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#5. init</span></span><br><span class="line">peer chaincode invoke \</span><br><span class="line">-o <span class="variable">$&#123;ORDERER_ADDRESS&#125;</span> --ordererTLSHostnameOverride orderer.example.com --tls <span class="variable">$CORE_PEER_TLS_ENABLED</span> --cafile <span class="variable">$ORDERER_CA</span> \</span><br><span class="line">-C <span class="variable">$CHANNEL_NAME</span> -n <span class="variable">$&#123;CC_NAME&#125;</span>  \</span><br><span class="line">--isInit -c <span class="string">&#x27;&#123;&quot;Function&quot;:&quot;Init&quot;,&quot;Args&quot;:[]&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#6. query</span></span><br><span class="line">peer chaincode query -C <span class="variable">$CHANNEL_NAME</span> -n <span class="variable">$CC_NAME</span> -c <span class="string">&#x27;&#123;&quot;Function&quot;:&quot;XXX&quot;, &quot;Args&quot;:[]&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#7. invoke</span></span><br><span class="line">peer chaincode invoke \</span><br><span class="line">-o <span class="variable">$&#123;ORDERER_ADDRESS&#125;</span> --ordererTLSHostnameOverride orderer.example.com --tls <span class="variable">$CORE_PEER_TLS_ENABLED</span> --cafile <span class="variable">$ORDERER_CA</span> \</span><br><span class="line"><span class="variable">$CC_ENDORSERS</span> \</span><br><span class="line">-C <span class="variable">$CHANNEL_NAME</span> -n <span class="variable">$&#123;CC_NAME&#125;</span>  \</span><br><span class="line">-c <span class="string">&#x27;&#123;&quot;Function&quot;:&quot;XXX&quot;,&quot;Args&quot;:[&quot;b&quot;,&quot;a&quot;,&quot;12&quot;]&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/30/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%B7%A5%E5%85%B7/docker/docker%20ps%20%E5%91%BD%E4%BB%A4%E6%89%93%E5%8D%B0%E5%86%85%E5%AE%B9%E8%BF%87%E5%A4%9A%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/03/30/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%B7%A5%E5%85%B7/docker/docker%20ps%20%E5%91%BD%E4%BB%A4%E6%89%93%E5%8D%B0%E5%86%85%E5%AE%B9%E8%BF%87%E5%A4%9A%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3/" class="post-title-link" itemprop="url">docker ps 命令打印内容过多如何解决</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-03-30 00:00:00" itemprop="dateCreated datePublished" datetime="2021-03-30T00:00:00+08:00">2021-03-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-02-01 01:54:09" itemprop="dateModified" datetime="2025-02-01T01:54:09+08:00">2025-02-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/" itemprop="url" rel="index"><span itemprop="name">article</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">计算机</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%B7%A5%E5%85%B7/docker/" itemprop="url" rel="index"><span itemprop="name">docker</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="docker-ps-命令打印内容过多如何解决">docker ps 命令打印内容过多如何解决</h2>
<p>可以自己指定显示的模板，例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps --format <span class="string">&quot;table &#123;&#123;.ID&#125;&#125;\t&#123;&#123;.Names&#125;&#125;\t&#123;&#123;.Ports&#125;&#125;&quot;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>table</code> - 表示显示表头列名</li>
<li><code>&#123;&#123;.ID&#125;&#125;</code> - 容器 ID</li>
<li><code>&#123;&#123;.Command&#125;&#125;</code> - 启动执行的命令<br>
显示结果：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ docker ps --format <span class="string">&quot;table &#123;&#123;.ID&#125;&#125;\t&#123;&#123;.Names&#125;&#125;\t&#123;&#123;.Ports&#125;&#125;&quot;</span></span><br><span class="line">CONTAINER ID        NAMES                                   PORTS</span><br><span class="line">db3df460fe14        dev-peer0.org1.example.com-fabcar-1.0</span><br><span class="line">b6f803814cce        cli</span><br><span class="line">10724ca7364f        peer0.org1.example.com                  0.0.0.0:7051-&gt;7051/tcp, 0.0.0.0:7053-&gt;7053/tcp</span><br><span class="line">20d930e6e9f7        ca.example.com                          0.0.0.0:7054-&gt;7054/tcp</span><br></pre></td></tr></table></figure>
<p>可用的占位符</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>.ID</td>
<td>容器 ID</td>
</tr>
<tr>
<td>.Image</td>
<td>镜像 ID</td>
</tr>
<tr>
<td>.Command</td>
<td>执行的命令</td>
</tr>
<tr>
<td>.CreatedAt</td>
<td>容器创建时间</td>
</tr>
<tr>
<td>.RunningFor</td>
<td>运行时长</td>
</tr>
<tr>
<td>.Ports</td>
<td>暴露的端口</td>
</tr>
<tr>
<td>.Status</td>
<td>容器状态</td>
</tr>
<tr>
<td>.Names</td>
<td>容器名称</td>
</tr>
<tr>
<td>.Label</td>
<td>分配给容器的所有标签</td>
</tr>
<tr>
<td>.Mounts</td>
<td>容器挂载的卷</td>
</tr>
<tr>
<td>.Networks</td>
<td>容器所用的网络名称</td>
</tr>
</tbody>
</table>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/30/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/linux/Linux%20shell%20%E8%84%9A%E6%9C%AC%E6%89%A7%E8%A1%8C%E6%96%B9%E6%B3%95%E4%B9%8B%E9%97%B4%E7%9A%84%E5%BC%82%E5%90%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/03/30/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/linux/Linux%20shell%20%E8%84%9A%E6%9C%AC%E6%89%A7%E8%A1%8C%E6%96%B9%E6%B3%95%E4%B9%8B%E9%97%B4%E7%9A%84%E5%BC%82%E5%90%8C/" class="post-title-link" itemprop="url">Linux shell 脚本执行方法之间的异同</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-03-30 00:00:00" itemprop="dateCreated datePublished" datetime="2021-03-30T00:00:00+08:00">2021-03-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-02-01 01:54:09" itemprop="dateModified" datetime="2025-02-01T01:54:09+08:00">2025-02-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/" itemprop="url" rel="index"><span itemprop="name">article</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">计算机</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">操作系统</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Linux-shell-脚本执行方法之间的异同">Linux shell 脚本执行方法之间的异同</h2>
<p>Linux shell 脚本的执行方式有很多，比如 <code>source &lt;bash path&gt;</code> 、 <code>sh|bash &lt;bash path&gt;</code> 、 <code>. &lt;bash path&gt;</code> 等等。</p>
<p>这些执行方式分为两类：</p>
<ol>
<li>开启子 shell 执行脚本；</li>
<li>以当前 shell 作为环境执行脚本；</li>
</ol>
<p>如果以子 shell 的方式执行脚本，那么父 shell 脚本定义的环境变量（未 export 的）是不会被子 shell 继承的；</p>
<ul>
<li><code>./*.sh</code> 的执行方式等价于 <code>sh ./*.sh</code> 或者 <code>bash ./*.sh</code> ，此三种执行脚本的方式都是重新启动一个子 shell ，在子 shell 中执行此脚本。</li>
<li><code>source ./*.sh</code> 和 <code>. ./*.sh</code> 的执行方式是等价的，即两种执行方式都是在当前 shell 进程中执行此脚本，而不是重新启动一个 shell 而在子 shell 进程中执行此脚本。</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/29/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/linux/Linux%20%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/03/29/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/linux/Linux%20%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/" class="post-title-link" itemprop="url">Linux 环境配置</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-03-29 00:00:00" itemprop="dateCreated datePublished" datetime="2021-03-29T00:00:00+08:00">2021-03-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-02-01 01:54:09" itemprop="dateModified" datetime="2025-02-01T01:54:09+08:00">2025-02-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/" itemprop="url" rel="index"><span itemprop="name">article</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">计算机</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">操作系统</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/article/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Linux-环境配置">Linux 环境配置</h2>
<p>Linux 有两种方式来进行环境的配置：</p>
<ul>
<li>交互式 login shell ：这种方式取得 bash 命令需要登录操作，比如系统刚刚开机时候需要输入用户密码才能够取得的相关命令；</li>
<li>非交互式 non-login shell ：这种方式取得的 bash 命令则不需要进行登陆操作，比如登录系统之后执行的 <code>bash</code> 命令相当于打开了一个子 bash 环境；</li>
</ul>
<p><img src="../../../../assets/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/linux/Linux%20%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/5c04f725230db3370ca9045c2adef6263fc3056f538f89c3019727833f304dee.png" alt="picture 1"></p>
<h3 id="交互式-login-shell">交互式 login shell</h3>
<p>交互式 login shell 一般只会读取：</p>
<ol>
<li><code>/etc/profile</code> ：全局配置文件；</li>
<li><code>[~/.bash_profile | ~/.bash_login | ~/.profile]</code> ：用户自己的配置文件，这三个只读取一个，按照顺序读取，先命中的则读取；</li>
</ol>
<p>而通过打开上述的文件我们发现，他们还会判断另外一下配置文件是否存在，存在则执行；比如， <code>~/.bash_profile</code> 会去读取 <code>~/.bashrc</code> ，而 <code>~/.bashrc</code> 会去读取 <code>/etc/bashrc</code> 等等。</p>
<p>总结下来如下图所示，实线的方向是系统会自动读取的流程，虚线是文件中调用的配置文件；一般我们都会修改 <code>~/.bashrc</code> 进行用户专属的配置，方式管理混乱；</p>
<p><img src="../../../../assets/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/linux/Linux%20%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/439e6b62c3c44825587086a54f5c4439ae12663278834307f4664fad3cd13383.png" alt="picture 2"></p>
<h3 id="非交互式-non-login-shell">非交互式 non-login shell</h3>
<p>非交互式 non-login shell 只会读取 <code>~/.bashrc</code> 文件，所以和上面的其实差不多；</p>
<h3 id="通过-su-命令看到以上两者的区别">通过 su 命令看到以上两者的区别</h3>
<blockquote>
<p><code>su</code> - 运行替换用户和组标识的 shell<br>
用法： <code>su [OPTION]... [-] [USER [ARG]...]</code><br>
参数：</p>
<pre><code>-, -l, --login
      使得shell为可登录的shell

`-c`, --commmand=COMMAND
       传递单个COMMAND给-c的shell.

-f, --fast
       传递-f给shell(针对csh或tcsh)

-m, --preserve-environment
       不重置环境变量

-p     与-m同

-s, --shell=SHELL
       如果/etc/shells允许,运行SHELL.

--help 显示帮助并退出

--version
       输出版本信息并退出
</code></pre>
</blockquote>
<p>通过 <code>su root</code> 切换到 root 用户是按照 non-login shell 的方式切换到 root 的 shell 的；<br>
通过 <code>su -</code> 或 <code>su - root</code> 切换到 root 用户是按照 login shell 的方式切换到 root 用户的 shell 的；<br>
由于这两种方式加载配置文件的方式不一样，所以他们最后的 <code>env</code> 环境变量打印出来并不一样。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/5/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/21/">21</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/7/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">John Doe</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdn.bootcdn.net/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdn.bootcdn.net/ajax/libs/mermaid/11.4.0/mermaid.min.js","integrity":"sha256-G8ouPAnw4zzMbnAenHnVz6h9XpKbNdOkrqTh7AadyHs="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>





  





</body>
</html>
